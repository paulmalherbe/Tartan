=== modified file '.bzrignore'
--- .bzrignore	2015-10-03 07:36:56 +0000
+++ .bzrignore	2015-12-02 14:24:20 +0000
@@ -102,3 +102,7 @@
 wag/wg3030.new
 wag/wg3030.old
 web
+sqltab.py
+doc/Vacation.rst
+lon/rneim2.py
+lon/rneimp.py

=== modified file 'ass/ar6010.py'
--- ass/ar6010.py	2014-12-30 15:37:38 +0000
+++ ass/ar6010.py	2015-10-26 06:28:52 +0000
@@ -62,12 +62,12 @@
         fld = [
             (["T",0,0,0],"I@asm_group",0,"Old Group","Old Group",
                 "","Y",self.doOldGrp,grp,None,("notblank",)),
-            (["T",0,0,12],"I@asm_code",0,"Old Code","Old Product Code",
+            (["T",0,0,12],"IRW",7,"Old Code","Old Asset Code",
                 "","Y",self.doOldCod,asm,None,("notblank",)),
             (["T",0,0,27],"O@asm_desc",0,""),
             (["T",0,1,0],"I@asm_group",0,"New Group","New Group",
                 "","Y",self.doNewGrp,grp,None,("notblank",)),
-            (["T",0,1,12],"I@asm_code",0,"New Code","New Product Code",
+            (["T",0,1,12],"I@asm_code",0,"New Code","New Asset Code",
                 "","Y",self.doNewCod,None,None,("notblank",))]
         tnd = ((self.doProcess,"y"), )
         txt = (self.doExit, )

=== modified file 'bkm/bk1020.py'
--- bkm/bk1020.py	2015-10-25 09:33:02 +0000
+++ bkm/bk1020.py	2015-12-03 06:53:07 +0000
@@ -177,7 +177,7 @@
                 "","N",None,None,None,("efld",)),
             (("T",2,6,0),"ITX",30,"Address Line 3","",
                 "","N",None,None,None,("efld",)),
-            (("T",2,7,0),"IUI",4,"Postal Code","",
+            (("T",2,7,0),"ITX",4,"Postal Code","",
                 "","N",None,None,None,("efld",)),
             (("T",2,8,0),"ITX",20,"Telephone Number","",
                 "","N",None,None,None,("efld",)),
@@ -1045,25 +1045,34 @@
                     break
             self.df.loadEntry("T", 2, 0, data=self.ccode)
         changed = False
-        data = [self.opts["conum"]]
+        condat = [self.opts["conum"]]
         trdt = long("%04i%02i%02i%02i%02i%02i" % time.localtime()[:-3])
         for x in xrange(len(self.df.t_work[2][0])):
-            data.append(self.df.t_work[2][0][x])
+            condat.append(self.df.t_work[2][0][x])
         if self.newcon:
             changed = True
-            self.sql.insRec("bkmcon", data=data)
+            self.sql.insRec("bkmcon", data=condat)
             self.newcon = False
-        elif data != self.oldcon:
+        elif condat != self.oldcon:
             changed = True
-            self.sql.updRec("bkmcon", data=data, where=[("bkc_cono", "=",
+            self.sql.updRec("bkmcon", data=condat, where=[("bkc_cono", "=",
                 self.opts["conum"]), ("bkc_ccode", "=", self.ccode)])
             for num, dat in enumerate(self.oldcon):
-                if dat != data[num]:
+                if dat != condat[num]:
                     self.sql.insRec("chglog", data=["bkmcon", "U",
                         "%03i%-7s" % (self.opts["conum"], self.ccode),
                         self.sql.bkmcon_col[num], trdt, self.opts["capnm"],
-                        str(dat), str(data[num]), 0])
-        if not self.number:
+                        str(dat), str(condat[num]), 0])
+        mstdat = [self.opts["conum"]]
+        for x in xrange(len(self.df.t_work[1][0])):
+            if x in (6, 13):
+                continue
+            if self.df.topf[1][x][1][1:] == "Tv":
+                mstdat.append(self.df.t_work[1][0][x].strip())
+            else:
+                mstdat.append(self.df.t_work[1][0][x])
+        mstdat.append(self.ccode)
+        if self.newmst:
             changed = True
             acc = self.sql.getRec(tables="bkmmst", cols=["max(bkm_number)"],
                 where=[("bkm_cono", "=", self.opts["conum"])], limit=1)
@@ -1071,36 +1080,25 @@
                 self.number = 1001
             else:
                 self.number = int(acc[0]) + 1
-            self.df.loadEntry("T", 1, 0, data=self.number)
+            mstdat[1] = self.number
+            self.sql.insRec("bkmmst", data=mstdat)
             self.sql.updRec("bkmrtt", cols=["brt_number"], data=[self.number],
                 where=[("brt_cono", "=", self.opts["conum"]), ("brt_number",
                 "=", 0)])
-            data = [self.opts["conum"], self.number, 1, self.getRef(),
-                self.batno, self.sysdtw, 0, 0, self.curdt, "Booking Enquiry",
-                "", "", self.opts["capnm"], self.sysdtw, 0]
-            self.sql.insRec("bkmtrn", data=data)
-        data = [self.opts["conum"]]
-        for x in xrange(len(self.df.t_work[1][0])):
-            if x in (6, 13):
-                continue
-            if self.df.topf[1][x][1][1:] == "Tv":
-                data.append(self.df.t_work[1][0][x].strip())
-            else:
-                data.append(self.df.t_work[1][0][x])
-        data.append(self.ccode)
-        if self.newmst:
-            changed = True
-            self.sql.insRec("bkmmst", data=data)
-        elif data != self.oldmst:
-            changed = True
-            self.sql.updRec("bkmmst", data=data, where=[("bkm_cono", "=",
+            self.sql.insRec("bkmtrn", data=[self.opts["conum"], self.number, 1,
+                self.getRef(), self.batno, self.sysdtw, 0, 0, self.curdt,
+                "Booking Enquiry", "", "", self.opts["capnm"], self.sysdtw, 0])
+            self.df.loadEntry("T", 1, 0, data=self.number)
+        elif mstdat != self.oldmst:
+            changed = True
+            self.sql.updRec("bkmmst", data=mstdat, where=[("bkm_cono", "=",
                 self.opts["conum"]), ("bkm_number", "=", self.number)])
             for num, dat in enumerate(self.oldmst):
-                if dat != data[num]:
+                if dat != mstdat[num]:
                     self.sql.insRec("chglog", data=["bkmmst", "U",
                         "%03i%7s" % (self.opts["conum"], self.number),
                         self.sql.bkmmst_col[num], trdt, self.opts["capnm"],
-                        str(dat), str(data[num]), 0])
+                        str(dat), str(mstdat[num]), 0])
         self.opts["mf"].dbm.commitDbase()
         if self.rev:
             self.df.setWidget(self.df.mstFrame, state="hide")
@@ -1459,7 +1457,7 @@
         if self.ttype == 4 and self.rev:
             recs = self.sql.getRec(tables="bkmrtt", where=[("brt_cono",
                 "=", self.opts["conum"]), ("brt_number", "=", self.number),
-                ("brt_crnno", "=", 0)])
+                ("brt_invno", "<>", 0), ("brt_crnno", "=", 0)])
             if recs:
                 self.doCreditNote(recs)
         # Balance
@@ -1824,12 +1822,22 @@
             nd["%s_T%02i" % (t, s)][tc.index("tpd_text")] = txt
             if u[0] == "A" and u[3]:
                 u[2] = "%-s Room %3s" % (u[2], u[3])
+            bas = CCD(u[4], "UA", 1)
             qty = CCD(u[5], "UI", 3)
             per = CCD(u[6], "UI", 3)
             rte = CCD(u[7], "UD", 10.2)
             if rte.work:
-                txt = "%-35s %-3s x %-3s @ R%10s" % (u[2], qty.disp,
-                    per.disp, rte.disp)
+                if bas == "A":
+                    txt = "%-35s %-3s x %-3s @ R%10s" % (u[2], qty.disp,
+                        per.disp, rte.disp)
+                elif bas == "B":
+                    txt = "%-35s %-3s x       R%10s" % (u[2], qty.disp,
+                        rte.disp)
+                elif bas == "C":
+                    txt = "%-35s       %-3s @ R%10s" % (u[2], per.disp,
+                        rte.disp)
+                else:
+                    txt = "%-35s           @ R%10s" % (u[2], rte.disp)
             else:
                 txt = "%-35s" % u[2]
             nd["%s_C%02i" % (t, s)][tc.index("tpd_text")] = txt

=== modified file 'bkm/bk3070.py'
--- bkm/bk3070.py	2015-10-03 07:36:56 +0000
+++ bkm/bk3070.py	2015-12-08 09:52:08 +0000
@@ -230,10 +230,10 @@
                 con[ccc.index("bkc_title")],
                 con[ccc.index("bkc_names")],
                 con[ccc.index("bkc_sname")])
-            dat = "%1s\n%1s" % (dat, con[ccc.index("bkc_addr1")])
-            dat = "%1s\n%1s" % (dat, con[ccc.index("bkc_addr2")])
-            dat = "%1s\n%1s" % (dat, con[ccc.index("bkc_addr3")])
-            dat = "%1s\n%1s" % (dat, con[ccc.index("bkc_pcode")])
+            if bkm[bmc.index("bkm_group")]:
+                dat = "%s\n%s" % (dat, bkm[bmc.index("bkm_group")][:40])
+            for fld in ("addr1", "addr2", "addr3", "pcode"):
+                dat = "%1s\n%s" % (dat, con[ccc.index("bkc_%s" % fld)])
             self.form.newdic["contact_details_C00"][tdc.index("tpd_text")] = dat
         for col in bmc:
             d = "%s_C00" % col
@@ -261,7 +261,7 @@
             ext="pdf")
         self.form.output(pdfnam, "F")
         doPrinter(mf=self.opts["mf"], conum=self.opts["conum"], pdfnam=pdfnam,
-            head="%s STATEMENT at %s" % (self.opts["conam"], self.sysdtd),
+            head="%s Statement at %s" % (self.opts["conam"], self.sysdtd),
             repprt=self.repprt, repeml=self.repeml)
         if self.repeml[1] == "Y":
             self.form = DrawForm(self.opts["mf"].dbm, self.tname,
@@ -287,7 +287,7 @@
                 if cod == "bkt_desc":
                     des = self.form.doSplitText("bkt_desc_C00",
                         trans[btc.index(cod)])
-                    if not des[-1]:
+                    if len(des) > 1 and not des[-1]:
                         del des[-1]
                 else:
                     ldic[cod] = CCD(trans[btc.index(cod)],

=== modified file 'bkm/bk3090.py'
--- bkm/bk3090.py	2015-08-25 15:02:35 +0000
+++ bkm/bk3090.py	2015-10-26 15:51:06 +0000
@@ -38,11 +38,14 @@
     def mainProcess(self):
         tit = ("%03i %s" % (self.opts["conum"], self.opts["conam"]),
             "Bookings's Occupancy by Status Summary")
+        r1s = (("Beds","B"), ("Value","V"))
         fld = (
             (("T",0,0,0),"ID2",7,"Starting Period","",
                 "","N",self.doStartPer,None,None,("efld",)),
             (("T",0,1,0),"ID2",7,"Ending   Period","",
-                "","N",self.doEndPer,None,None,("efld",)))
+                "","N",self.doEndPer,None,None,("efld",)),
+            (("T",0,2,0),("IRB",r1s),0,"Report by","",
+                "B","N",self.doRepTyp,None,None,None))
         tnd = ((self.doEnd,"y"),)
         txt = (self.doExit,)
         self.df = TartanDialog(self.opts["mf"], tops=False, title=tit,
@@ -65,12 +68,21 @@
         if dateDiff(self.sdate, self.edate, "months") > 11:
             return "More than 12 month period"
 
+    def doRepTyp(self, frt, pag, r, c, p, i, w):
+        self.reptyp = w
+
     def doEnd(self):
         self.df.closeProcess()
-        rec = self.sql.getRec(tables="bkmmst", cols=["bkm_state", "bkm_guests",
-            "bkm_arrive", "bkm_depart"], where=[("bkm_btype", "=", "A"),
-            ("bkm_arrive", "between", self.sdate, self.edate, "or",
-            "bkm_depart", "between", self.sdate, self.edate)])
+        if self.reptyp == "B":
+            col = ["bkm_state", "bkm_guests", "bkm_arrive", "bkm_depart"]
+            whr = [("bkm_btype", "=", "A"), ("bkm_arrive", ">=", self.sdate,
+                "and", "bkm_depart", "<=", self.edate)]
+        else:
+            col = ["bkm_state", "bkm_value", "bkm_arrive", "bkm_depart"]
+            whr = [("bkm_btype", "=", "A"), ("bkm_arrive", "between",
+                self.sdate, self.edate, "or", "bkm_depart", "between",
+                self.sdate, self.edate)]
+        rec = self.sql.getRec(tables="bkmmst", cols=col, where=whr)
         num = 1
         lookup = {}
         mth = (self.sdate / 100) % 100
@@ -83,21 +95,26 @@
             num += 1
             lookup[mth] = num
         for r in rec:
-            if r[2] / 100 == r[3] / 100:
-                days = dateDiff(r[2], r[3], "days")
-                mth = (r[2] / 100) % 100
-                self.desc[r[0]][lookup[mth]] += (days * r[1])
-                self.desc["T"][lookup[mth]] += (days * r[1])
+            if self.reptyp == "D":
+                if r[2] / 100 == r[3] / 100:
+                    days = dateDiff(r[2], r[3], "days")
+                    mth = (r[2] / 100) % 100
+                    self.desc[r[0]][lookup[mth]] += (days * r[1])
+                    self.desc["T"][lookup[mth]] += (days * r[1])
+                else:
+                    mnd = mthendDate(r[2])
+                    days = dateDiff(r[2], mnd, "days")
+                    mth = (r[2] / 100) % 100
+                    self.desc[r[0]][lookup[mth]] += (days * r[1])
+                    self.desc["T"][lookup[mth]] += (days * r[1])
+                    mth = (r[3] / 100) % 100
+                    days = dateDiff((((r[3]/100)*100)+1), r[3], "days")
+                    self.desc[r[0]][lookup[mth]] += (days * r[1])
+                    self.desc["T"][lookup[mth]] += (days * r[1])
             else:
-                mnd = mthendDate(r[2])
-                days = dateDiff(r[2], mnd, "days")
                 mth = (r[2] / 100) % 100
-                self.desc[r[0]][lookup[mth]] += (days * r[1])
-                self.desc["T"][lookup[mth]] += (days * r[1])
-                mth = (r[3] / 100) % 100
-                days = dateDiff((((r[3]/100)*100)+1), r[3], "days")
-                self.desc[r[0]][lookup[mth]] += (days * r[1])
-                self.desc["T"][lookup[mth]] += (days * r[1])
+                self.desc[r[0]][lookup[mth]] += r[1]
+                self.desc["T"][lookup[mth]] += r[1]
         achart = []
         bchart = []
         for s in self.desc:
@@ -105,9 +122,13 @@
             if s in ("T", "X"):
                 continue
             achart.append([s] + self.desc[s])
+        if self.reptyp == "B":
+            typ = "Beds"
+        else:
+            typ = "Value"
         CreateChart(self.opts["mf"], self.opts["conum"], self.opts["conam"],
             [self.sdate/100, self.edate/100], [[self.opts["conam"],
-            "Status Summary"], "Beds"], achart, bchart)
+            "Status Summary"], typ], achart, bchart)
         self.opts["mf"].closeLoop()
 
     def doExit(self):

=== modified file 'bkm/bkc510.py'
--- bkm/bkc510.py	2015-08-25 15:02:35 +0000
+++ bkm/bkc510.py	2015-11-28 14:31:46 +0000
@@ -65,7 +65,7 @@
                 "","N",None,None,None,("efld",)),
             (("T",0,6,0),"ITX",30,"Address Line 3","",
                 "","N",None,None,None,("efld",)),
-            (("T",0,7,0),"IUI",4,"Postal Code","",
+            (("T",0,7,0),"ITX",4,"Postal Code","",
                 "","N",None,None,None,("efld",)),
             (("T",0,8,0),"ITX",20,"Telephone Number","",
                 "","N",None,None,None,("efld",)),

=== modified file 'bwl/bc1040.py'
--- bwl/bc1040.py	2014-12-30 15:37:38 +0000
+++ bwl/bc1040.py	2015-12-11 16:11:56 +0000
@@ -14,7 +14,7 @@
 """
 
 from TartanClasses import TartanDialog, Sql
-from tartanFunctions import getNextCode
+from tartanFunctions import askQuestion, callModule, getNextCode
 
 class bc1040:
     def __init__(self, **opts):
@@ -24,7 +24,7 @@
             self.opts["mf"].startLoop()
 
     def setVariables(self):
-        self.sql = Sql(self.opts["mf"].dbm, ["bwltyp", "bwlcmp"],
+        self.sql = Sql(self.opts["mf"].dbm, ["bwltyp", "bwlpts", "bwlcmp"],
             prog=__name__)
         if self.sql.error:
             return
@@ -46,13 +46,13 @@
             (("T",0,0,0),"I@bct_code",0,"","",
                 0,"Y",self.doTypCod,typ,None,("efld",)),
             (("T",0,1,0),"I@bct_desc",0,"","",
-                "","N",None,None,self.doDelete,("notblank",)),
+                "","N",self.doDesc,None,self.doDelete,("notblank",)),
             (("T",0,2,0),("IRB",r1s),0,"Competition Format","",
                 "T","N",self.doCFmat,None,None,None),
             (("T",0,3,0),"I@bct_tsize",0,"","",
                 4,"N",self.doTSize,None,None,("notzero",)),
             (("T",0,4,0),"I@bct_games",0,"","",
-                0,"N",None,None,None,("notzero",)),
+                0,"N",self.doGames,None,None,("notzero",)),
             (("T",0,5,0),"I@bct_ends",0,"","",
                 21,"N",self.doEnds,None,None,("notzero",)),
             (("T",0,6,0),("IRB",r2s),0,"Groups by Position","",
@@ -72,48 +72,23 @@
                 1,"N",self.doDrawn,None,None,("efld",)),
             (("T",0,12,0),("IRB",r2s),0,"Strict S v S",
                 "Strict Strength v Strength",
-                "N","N",None,None,None,None,None,
+                "N","N",self.doSvS,None,None,None,None,
                 "Yes means that teams could play against each other, again, "\
                 "in ANY game. No means that teams could only play against "\
                 "each other, again, in the Final game."),
-            (("T",0,13,0),("IRB",r2s),0,"Skins","",
-                "N","N",self.doSkins,None,None,None),
-            (("T",0,14,0),"I@bct_sends",0,"","",
-                0,"N",self.doEndsPerSkin,None,None,("efld",)),
-            (("T",0,15,0),("IRB",r2s),0,"Points Only","",
-                "N","N",self.doOnly,None,None,None,None,
-                "Yes means that No Shots are to be captured and that only "\
-                "Points will be used to determine positions. No means that "\
-                "Shots and Points are to be captured and used to determine "\
-                "positions."),
-            (("T",0,16,0),"I@bct_e_points",0,"","",
-                0,"N",self.doPoints,None,None,("efld",)),
-            (("T",0,17,0),"I@bct_s_points",0,"","",
-                0,"N",None,None,None,("efld",)),
-            (("T",0,18,0),"I@bct_g_points",0,"","",
-                0,"N",None,None,None,("efld",)),
-            (("T",0,19,0),("IRB",r2s),0,"Bonus Points","",
-                "N","N",self.doBonus,None,None,None),
-            (("T",0,20,0),"I@bct_win_by",0,"","",
-                0,"N",None,None,None,("efld",)),
-            (("T",0,21,0),"I@bct_lose_by",0,"","",
-                0,"N",None,None,None,("efld",)))
+            (("T",0,13,0),("IRB",r2s),0,"Different Drawn Games Scoring","",
+                "N","N",self.doDiff,None,None,None,None,
+                "Yes means that Drawn Games have a Different Scoring Format "\
+                "from Strength V Strength Games."))
+        but = (
+            ("Print", None, self.doPrint,0,("T",0,2),None),
+            ("Quit", None, self.doExit,1,None,None))
         tnd = ((self.doEnd,"y"),)
         txt = (self.doExit,)
         self.df = TartanDialog(self.opts["mf"], tops=False, title=tit,
-            eflds=fld, tend=tnd, txit=txt, clicks=self.doClick)
-
-    def doClick(self, *opts):
-        if self.df.col == 1:
-            return
-        if self.click:
-            self.df.loadEntry("T", self.click[0], self.click[1],
-                data=self.df.t_work[self.click[0]][0][self.click[1]])
-        self.click = opts[0]
-        self.df.focusField("T", opts[0][0], opts[0][1] + 1)
+            eflds=fld, butt=but, tend=tnd, txit=txt)
 
     def doTypCod(self, frt, pag, r, c, p, i, w):
-        self.click = []
         if not w:
             self.ctype = getNextCode(self.sql, "bwltyp", "bct_code",
                 where=[("bct_cono", "=", self.opts["conum"])], last=99)
@@ -126,29 +101,42 @@
             self.newtyp = True
         else:
             self.newtyp = False
+            self.cdesc = chk[self.sql.bwltyp_col.index("bct_desc")]
             self.cfmat = chk[self.sql.bwltyp_col.index("bct_cfmat")]
+            self.tsize = chk[self.sql.bwltyp_col.index("bct_tsize")]
+            self.ends = chk[self.sql.bwltyp_col.index("bct_ends")]
+            self.groups = chk[self.sql.bwltyp_col.index("bct_groups")]
+            self.adjust = chk[self.sql.bwltyp_col.index("bct_adjust")]
             for num, fld in enumerate(chk[1:]):
                 self.df.loadEntry(frt, pag, num, data=fld)
         chk = self.sql.getRec(tables="bwlcmp", where=[("bcm_cono", "=",
             self.opts["conum"]), ("bcm_type", "=", self.ctype)], limit=1)
         if chk:
-            self.games = True
+            self.exist = True
         else:
-            self.games = False
+            self.exist = False
 
     def doDelete(self, widget=None):
         if self.newtyp:
             return
-        if self.games:
-            return "There are Games of this Type, Not Deleted"
+        if self.exist:
+            return "There are Competitions Using this Type, Not Deleted"
         self.sql.delRec("bwltyp", where=[("bct_cono", "=", self.opts["conum"]),
             ("bct_code", "=", self.ctype)])
         self.opts["mf"].dbm.commitDbase()
 
+    def doDesc(self, frt, pag, r, c, p, i, w):
+        if self.exist:
+            ok = askQuestion(self.opts["mf"].body, "Games exist",
+                """There are Competitions Using this Type.
+
+Changes Could Adversely Affect them.
+
+Are you Sure this is what you Want to Do?""", default="no")
+            if ok == "no":
+                return "ff1"
+
     def doCFmat(self, frt, pag, r, c, p, i, w):
-        if self.games:
-            self.df.loadEntry(frt, pag, p, data=self.cfmat)
-            return "There are Games of this Type, No Changes Allowed"
         self.cfmat = w
 
     def doTSize(self, frt, pag, r, c, p, i, w):
@@ -157,17 +145,18 @@
             self.df.loadEntry(frt, pag, p+1, data=0)
             return "sk1"
 
+    def doGames(self, frt, pag, r, c, p, i, w):
+        self.games = w
+
     def doEnds(self, frt, pag, r, c, p, i, w):
         self.ends = w
         if self.cfmat in ("K", "R"):
-            self.doClearFields(p+1)
+            defaults = ["N",0,"N","",0,0,"N","N"]
+            for num, dat in enumerate(defaults):
+                self.df.loadEntry("T", 0, p+num+1, data=dat)
+            self.pdiff = "N"
             return "nd"
 
-    def doClearFields(self, start):
-        defaults = [0,"",0,0,0,21,"N",0,"N","",0,0,"N",0,0,0,0,"N",0,0]
-        for p in xrange(start, len(defaults)):
-            self.df.loadEntry("T", 0, p, data=defaults[p])
-
     def doGroups(self, frt, pag, r, c, p, i, w):
         self.groups = w
         if self.groups == "N":
@@ -185,15 +174,106 @@
     def doAdjust(self, frt, pag, r, c, p, i, w):
         self.adjust = w
         if self.adjust == "N":
-            self.df.loadEntry(frt, pag, p+1, data=0)
+            self.df.loadEntry(frt, pag, p+1, data="")
             self.df.loadEntry(frt, pag, p+2, data=0)
             return "sk2"
 
     def doDrawn(self, frt, pag, r, c, p, i, w):
-        if w == self.df.t_work[0][0][4]:
+        self.drawn = w
+        if self.drawn == self.games:
+            # All drawn games
+            self.pdiff = "N"
+            self.df.loadEntry(frt, pag, p+1, data="N")
+            self.df.loadEntry(frt, pag, p+2, data="N")
+            return "sk2"
+
+    def doSvS(self, frt, pag, r, c, p, i, w):
+        if not self.drawn:
+            self.pdiff = "N"
             self.df.loadEntry(frt, pag, p+1, data="N")
             return "sk1"
 
+    def doDiff(self, frt, pag, r, c, p, i, w):
+        self.pdiff = w
+
+    def doEnd(self):
+        data = [self.opts["conum"]] + self.df.t_work[0][0]
+        if self.newtyp:
+            self.sql.insRec("bwltyp", data=data)
+        else:
+            self.sql.updRec("bwltyp", data=data, where=[("bct_cono", "=",
+                self.opts["conum"]), ("bct_code", "=", self.ctype)])
+        self.df.setWidget(self.df.mstFrame, state="hide")
+        self.perr = False
+        if self.pdiff == "Y":
+            self.doPtsFmt("D")
+        if not self.perr:
+            if self.pdiff == "Y":
+                self.doPtsFmt("S")
+            else:
+                self.doPtsFmt("B")
+        self.df.setWidget(self.df.mstFrame, state="show")
+        if self.perr:
+            self.opts["mf"].dbm.rollbackDbase()
+            self.df.focusField(self.df.frt, self.df.pag, self.df.col)
+        else:
+            self.opts["mf"].dbm.commitDbase()
+            self.df.focusField("T", 0, 1)
+
+    def doPtsFmt(self, flag=None):
+        self.flag = flag
+        if flag == "D":
+            txt = "Points Format for Drawn Games"
+        elif flag == "S":
+            txt = "Points Format for SvS Games"
+        else:
+            txt = "Points Format"
+        tit = (txt,)
+        r1s = (("Yes", "Y"), ("No", "N"))
+        fld = (
+            (("T",0,0,0),("IRB",r1s),0,"Skins","",
+                "N","N",self.doSkins,None,None,None),
+            (("T",0,1,0),"I@bcp_sends",0,"","",
+                0,"N",self.doEndsPerSkin,None,None,("efld",)),
+            (("T",0,2,0),("IRB",r1s),0,"Points Only","",
+                "N","N",self.doOnly,None,None,None,None,
+                "Yes means that No Shots are to be captured and that only "\
+                "Points will be used to determine positions. No means that "\
+                "Shots and Points are to be captured and used to determine "\
+                "positions."),
+            (("T",0,3,0),"I@bcp_e_points",0,"","",
+                0,"N",self.doPoints,None,None,("efld",)),
+            (("T",0,4,0),"I@bcp_s_points",0,"","",
+                0,"N",None,None,None,("efld",)),
+            (("T",0,5,0),"I@bcp_g_points",0,"","",
+                0,"N",None,None,None,("efld",)),
+            (("T",0,6,0),("IRB",r1s),0,"Bonus Points","",
+                "N","N",self.doBonus,None,None,None),
+            (("T",0,7,0),"I@bcp_win_by",0,"","",
+                0,"N",None,None,None,("efld",)),
+            (("T",0,8,0),"I@bcp_lose_by",0,"","",
+                0,"N",None,None,None,("efld",)))
+        but = (("Quit", None, self.doPExit,1,None,None),)
+        tnd = ((self.doPEnd,"y"),)
+        txt = (self.doPExit,)
+        self.pf = TartanDialog(self.opts["mf"], tops=True, title=tit,
+            eflds=fld, butt=but, tend=tnd, txit=txt)
+        if self.flag in ("D", "S"):
+            ptyp = self.flag
+        else:
+            ptyp = "D"
+        acc = self.sql.getRec(tables="bwlpts", where=[("bcp_cono",
+            "=", self.opts["conum"]), ("bcp_code", "=", self.ctype),
+            ("bcp_ptyp", "=", ptyp)], limit=1)
+        if acc:
+            self.newpts = False
+            for num, dat in enumerate(acc[3:]):
+                self.pf.loadEntry("T", 0, num, data=dat)
+        else:
+            self.newpts = True
+        self.pf.focusField("T", 0, 1, clr=False)
+        self.opts["mf"].startLoop()
+
     def doSkins(self, frt, pag, r, c, p, i, w):
         self.skins = w
         if self.skins == "N":
@@ -205,7 +285,7 @@
             return "Invalid Ends per Skin, Not Divisible"
 
     def doOnly(self, frt, pag, r, c, p, i, w):
-        self.only = w
+        self.ponly = w
 
     def doPoints(self, frt, pag, r, c, p, i, w):
         if self.skins == "N":
@@ -218,20 +298,38 @@
             self.df.loadEntry(frt, pag, p+2, data=0)
             return "nd"
 
-    def doEnd(self, widget=None):
-        if widget:
-            frt, pag, col, mes = self.df.doCheckFields()
-            if mes:
-                self.df.focusField(frt, pag, (col+1), err=mes)
-                return
-        data = [self.opts["conum"]] + self.df.t_work[0][0]
-        if self.newtyp:
-            self.sql.insRec("bwltyp", data=data)
+    def doPEnd(self):
+        self.pf.closeProcess()
+        data = [self.opts["conum"], self.ctype, ""]
+        data.extend(self.pf.t_work[0][0])
+        if self.flag == "B":
+            if not self.newpts:
+                self.sql.delRec("bwlpts", where=[("bcp_cono", "=",
+                    self.opts["conum"]), ("bcp_code", "=", self.ctype)])
+            data[2] = "D"
+            self.sql.insRec("bwlpts", data=data)
+            data[2] = "S"
+            self.sql.insRec("bwlpts", data=data)
         else:
-            self.sql.updRec("bwltyp", data=data, where=[("bct_cono", "=",
-                self.opts["conum"]), ("bct_code", "=", self.ctype)])
-        self.opts["mf"].dbm.commitDbase()
-        self.df.focusField("T", 0, 1)
+            if not self.newpts:
+                self.sql.delRec("bwlpts", where=[("bcp_cono", "=",
+                    self.opts["conum"]), ("bcp_code", "=", self.ctype),
+                    ("bcp_ptyp", "=", self.flag)])
+            data[2] = self.flag
+            self.sql.insRec("bwlpts", data=data)
+        self.opts["mf"].closeLoop()
+
+    def doPExit(self):
+        self.perr = True
+        self.pf.closeProcess()
+        self.opts["mf"].closeLoop()
+
+    def doPrint(self):
+        if not self.newtyp:
+            callModule(self.opts["mf"], None, "bc3080",
+                coy=[self.opts["conum"], self.opts["conam"]],
+                args=[self.ctype, self.cdesc])
+            self.df.focusField(self.df.frt, self.df.pag, self.df.col)
 
     def doExit(self):
         self.df.closeProcess()

=== modified file 'bwl/bc2050.py'
--- bwl/bc2050.py	2015-10-03 07:36:56 +0000
+++ bwl/bc2050.py	2015-12-03 10:22:31 +0000
@@ -41,7 +41,7 @@
         t = time.localtime()
         self.today = ((t[0] * 10000) + (t[1] * 100) + t[2])
         self.sql = Sql(self.opts["mf"].dbm, ["bwlcmp", "bwlgme", "bwltab",
-            "bwltyp", "bwlrnd", "bwlent", "tplmst"], prog=__name__)
+            "bwltyp", "bwlpts", "bwlrnd", "bwlent", "tplmst"], prog=__name__)
         if self.sql.error:
             return
         self.game = 0
@@ -117,9 +117,9 @@
         self.cdes = bwlcmp[self.sql.bwlcmp_col.index("bcm_name")]
         self.df.loadEntry(frt, pag, p+1, data=self.cdes)
         self.sdat = bwlcmp[self.sql.bwlcmp_col.index("bcm_date")]
-        ctyp = bwlcmp[self.sql.bwlcmp_col.index("bcm_type")]
+        self.ctyp = bwlcmp[self.sql.bwlcmp_col.index("bcm_type")]
         bwltyp = self.sql.getRec(tables="bwltyp", where=[("bct_cono", "=",
-            self.opts["conum"]), ("bct_code", "=", ctyp)], limit=1)
+            self.opts["conum"]), ("bct_code", "=", self.ctyp)], limit=1)
         self.cfmat = bwltyp[self.sql.bwltyp_col.index("bct_cfmat")]
         self.tsize = bwltyp[self.sql.bwltyp_col.index("bct_tsize")]
         teams = self.sql.getRec(tables="bwlent", cols=["bce_scod"],
@@ -156,8 +156,6 @@
                 self.expunge.append(int(ex))
         self.strict = bwltyp[self.sql.bwltyp_col.index("bct_strict")]
         self.percent = bwltyp[self.sql.bwltyp_col.index("bct_percent")]
-        self.skins = bwltyp[self.sql.bwltyp_col.index("bct_skins")]
-        self.sends = bwltyp[self.sql.bwltyp_col.index("bct_sends")]
         self.drawall = False
         self.reprint = False
         self.opts["mf"].dbm.rollbackDbase()
@@ -428,6 +426,8 @@
             start = 0
             for grpcod in xrange(1, grpcnt + 1):
                 qty = totskp / grpcnt
+                if totskp % grpcnt:
+                    qty += 1
                 if qty % 2:
                     qty += 1
                 totskp -= qty
@@ -524,9 +524,9 @@
             groups = self.sql.getRec(tables="bwlgme", cols=["bcg_group"],
                 where=[("bcg_cono", "=", self.opts["conum"]), ("bcg_ccod", "=",
                 self.ccod), ("bcg_group", "<>", 0)], group="bcg_group")
-            num = len(groups)
-            lst = None
-            cnt = 0
+            num = len(groups)                   # Number of groups
+            lst = None                          # Last group processed
+            cnt = 0                             # Number of rinks allocated
             for x in xrange(0, len(self.skips), 2):
                 one = self.skips[x]
                 two = self.skips[x+1]
@@ -1409,6 +1409,11 @@
 
     def printCards(self):
         recs = []
+        bwlpts = self.sql.getRec(tables="bwlpts", where=[("bcp_cono",
+            "=", self.opts["conum"]), ("bcp_code", "=", self.ctyp),
+            ("bcp_ptyp", "=", self.gtyp)], limit=1)
+        skins = bwlpts[self.sql.bwlpts_col.index("bcp_skins")]
+        sends = bwlpts[self.sql.bwlpts_col.index("bcp_sends")]
         if self.allcards == "N":
             gme = getSingleRecords(self.opts["mf"], "bwlgme", ("bcg_rink",
                 "bcg_scod", "bcg_ocod"), where=[("bcg_cono", "=",
@@ -1453,7 +1458,7 @@
                 y4 = 145
             else:
                 end = x + 1
-                if (self.skins == "Y" and not end % self.sends):
+                if (skins == "Y" and not end % sends):
                     fill = True
                 dat = end
             for nam in self.form.body:

=== modified file 'bwl/bc2070.py'
--- bwl/bc2070.py	2015-10-03 07:36:56 +0000
+++ bwl/bc2070.py	2015-12-03 11:00:33 +0000
@@ -25,7 +25,7 @@
 
     def setVariables(self):
         self.sql = Sql(self.opts["mf"].dbm, ["bwlcmp", "bwltab", "bwlent",
-            "bwltyp", "bwlgme"], prog=__name__)
+            "bwltyp", "bwlpts", "bwlgme"], prog=__name__)
         if self.sql.error:
             return
         return True
@@ -111,6 +111,7 @@
         if not com:
             return "Invalid Competition Code"
         self.ccod = w
+        self.code = com[1]
         self.df.loadEntry(frt, pag, p + 1, data=com[0])
         bwltyp = self.sql.getRec(tables="bwltyp", where=[("bct_cono", "=",
             self.opts["conum"]), ("bct_code", "=", com[1])], limit=1)
@@ -124,17 +125,6 @@
         else:
             self.games = bwltyp[self.sql.bwltyp_col.index("bct_games")]
         self.ends = bwltyp[self.sql.bwltyp_col.index("bct_ends")]
-        self.skins = bwltyp[self.sql.bwltyp_col.index("bct_skins")]
-        self.sends = bwltyp[self.sql.bwltyp_col.index("bct_sends")]
-        self.only = bwltyp[self.sql.bwltyp_col.index("bct_p_only")]
-        self.epts = bwltyp[self.sql.bwltyp_col.index("bct_e_points")]
-        self.spts = bwltyp[self.sql.bwltyp_col.index("bct_s_points")]
-        self.gpts = bwltyp[self.sql.bwltyp_col.index("bct_g_points")]
-        self.bpts = bwltyp[self.sql.bwltyp_col.index("bct_bonus")]
-        dif = bwltyp[self.sql.bwltyp_col.index("bct_win_by")]
-        self.win_by = [dif, dif * -1]
-        dif = bwltyp[self.sql.bwltyp_col.index("bct_lose_by")]
-        self.lose_by = [dif, dif * -1]
         chk = self.sql.getRec(tables="bwlgme", cols=["bcg_game",
             "sum(bcg_points)"], where=[("bcg_cono", "=", self.opts["conum"]),
             ("bcg_ccod", "=", self.ccod), ("bcg_aflag", "in", ("", "D"))],
@@ -167,6 +157,23 @@
         elif chk[0] in ("A", "S"):
             return "Invalid Game Number, Abandoned or Skipped"
         self.gcod = w
+        gtyp = self.sql.getRec(tables="bwlgme", cols=["bcg_type"],
+            where=[("bcg_cono", "=", self.opts["conum"]), ("bcg_ccod",
+            "=", self.ccod), ("bcg_game", "=", w)], limit=1)[0]
+        bwlpts = self.sql.getRec(tables="bwlpts", where=[("bcp_cono",
+            "=", self.opts["conum"]), ("bcp_code", "=", self.code),
+            ("bcp_ptyp", "=", gtyp)], limit=1)
+        self.skins = bwlpts[self.sql.bwlpts_col.index("bcp_skins")]
+        self.sends = bwlpts[self.sql.bwlpts_col.index("bcp_sends")]
+        self.ponly = bwlpts[self.sql.bwlpts_col.index("bcp_p_only")]
+        self.epts = bwlpts[self.sql.bwlpts_col.index("bcp_e_points")]
+        self.spts = bwlpts[self.sql.bwlpts_col.index("bcp_s_points")]
+        self.gpts = bwlpts[self.sql.bwlpts_col.index("bcp_g_points")]
+        self.bpts = bwlpts[self.sql.bwlpts_col.index("bcp_bonus")]
+        dif = bwlpts[self.sql.bwlpts_col.index("bcp_win_by")]
+        self.win_by = [dif, dif * -1]
+        dif = bwlpts[self.sql.bwlpts_col.index("bcp_lose_by")]
+        self.lose_by = [dif, dif * -1]
 
     def doEndsFin(self, frt, pag, r, c, p, i, w):
         self.bonus = self.bpts
@@ -215,7 +222,11 @@
             return "Invalid Skip Code"
         if chk[3] or chk[4] or chk[5]:
             ok = askQuestion(self.opts["mf"].body, head="Already Entered",
-                mess="This Card Has Already Been Entered, Re-Enter?",
+                mess="""This Card Has Already Been Entered, Re-Enter?
+
+            Shots For:        %s
+            Shots Against:    %s
+            Points:            %s""" % (chk[3], chk[4], chk[5]),
                 default="no")
             if ok == "no":
                 return "rf"
@@ -231,7 +242,7 @@
         else:
             name = chk[0]
         self.df.loadEntry(frt, pag, p + 1, data=name)
-        if self.only == "N":
+        if self.ponly == "N":
             self.df.loadEntry(frt, pag, p + 2, data=chk[3])
         self.df.loadEntry(frt, pag, p + 3, data=chk[5])
         self.df.loadEntry(frt, pag, p + 4, data=self.opp)
@@ -245,10 +256,10 @@
         else:
             name = chk[0]
         self.df.loadEntry(frt, pag, p + 5, data=name)
-        if self.only == "N":
+        if self.ponly == "N":
             self.df.loadEntry(frt, pag, p + 6, data=chk[2])
         self.df.loadEntry(frt, pag, p + 7, data=chk[4])
-        if self.only == "Y":
+        if self.ponly == "Y":
             self.mpts = self.totpts
             self.s_for = self.s_agt = 0
             return "sk2"
@@ -291,7 +302,7 @@
             else:
                 name = chk[0]
             self.df.loadEntry(frt, pag, p + 2, data=name)
-            if self.only == "Y":
+            if self.ponly == "Y":
                 return "sk3"
             else:
                 return "sk2"
@@ -309,9 +320,9 @@
             self.df.focusField("C", 0, 1)
             self.doLoadCards()
         else:
-            if self.only == "Y" and not self.p_for and not self.p_agt:
+            if self.ponly == "Y" and not self.p_for and not self.p_agt:
                 aflag = "S"
-            elif self.only == "N" and not self.s_for and not self.s_agt:
+            elif self.ponly == "N" and not self.s_for and not self.s_agt:
                 aflag = "S"
             else:
                 aflag = ""
@@ -340,7 +351,7 @@
             ("bcg_cono", "=", self.opts["conum"]),
             ("bcg_ccod", "=", self.ccod),
             ("bcg_game", "=", self.gcod)]
-        if self.only:
+        if self.ponly:
             whr.append(("bcg_points", ">", 0))
         else:
             whr.append(("(", "bcg_shots_for", ">", 0, "or",
@@ -398,7 +409,7 @@
                 ocod = c[self.sql.bwlgme_col.index("bcg_ocod")]
                 if scod > 900000 or ocod > 900000:
                     continue
-                if self.only == "Y":
+                if self.ponly == "Y":
                     fors = c[self.sql.bwlgme_col.index("bcg_points")]
                     agts = self.sql.getRec(tables="bwlgme",
                         cols=["bcg_points"], where=[("bcg_cono", "=",

=== modified file 'bwl/bc3070.py'
--- bwl/bc3070.py	2015-10-03 07:36:56 +0000
+++ bwl/bc3070.py	2015-12-03 20:16:37 +0000
@@ -14,7 +14,7 @@
 """
 
 import os, time
-from TartanClasses import MyFpdf, Sql, TartanDialog
+from TartanClasses import CCD, MyFpdf, Sql, TartanDialog
 from tartanFunctions import getModName, doPrinter
 
 class bc3070:
@@ -64,7 +64,7 @@
 
     def doEnd(self):
         self.df.closeProcess()
-        col = ["btb_surname", "btb_names", "btb_cell", "btb_mail"]
+        col = ["btb_tab", "btb_surname", "btb_names", "btb_cell", "btb_mail"]
         whr = [
             ("bce_cono", "=", self.opts["conum"]),
             ("bce_ccod", "=", self.ccod),
@@ -80,12 +80,14 @@
             self.fpdf.set_font("Courier","",9)
             cwth = self.fpdf.get_string_width("X")
             for num, rec in enumerate(recs):
-                nm = rec[0].strip()
-                if rec[1]:
-                    nm += ", %s" % rec[1].split()[0].upper()
+                tab = CCD(rec[0], "UI", 6).disp
+                self.fpdf.drawText(txt=tab, w=cwth*7, h=5, ln=0)
+                nm = rec[1].strip()
+                if rec[2]:
+                    nm += ", %s" % rec[2].split()[0].upper()
                 self.fpdf.drawText(txt=nm, w=cwth*31, h=5, ln=0)
-                self.fpdf.drawText(txt=rec[2], w=cwth*16, h=5, ln=0)
-                self.fpdf.drawText(txt=rec[3], w=cwth*41, h=5, ln=1)
+                self.fpdf.drawText(txt=rec[3], w=cwth*16, h=5, ln=0)
+                self.fpdf.drawText(txt=rec[4], w=cwth*41, h=5, ln=1)
             pdfnam = getModName(self.opts["mf"].rcdic["wrkdir"], __name__,
                 self.opts["conum"], ext="pdf")
             self.fpdf.output(pdfnam, "F")
@@ -103,8 +105,8 @@
         self.fpdf.cell(0,10,"Players Entered in the %s" % self.cnam,1,0,"C")
         self.fpdf.ln(20)
         self.fpdf.set_font("Courier","B",9)
-        self.fpdf.cell(0, 5, "%-30s %-15s %-40s" % \
-            ("Name", "Mobile", "Email"), "B")
+        self.fpdf.cell(0, 5, "%-6s %-30s %-15s %-40s" % \
+            ("Number", "Name", "Mobile", "Email"), "B")
         self.fpdf.ln(5)
 
     def doExit(self):

=== modified file 'bwl/bc3080.py'
--- bwl/bc3080.py	2015-10-03 07:36:56 +0000
+++ bwl/bc3080.py	2015-12-05 06:49:03 +0000
@@ -15,29 +15,36 @@
 
 import os, time
 from TartanClasses import MyFpdf, Sql, TartanDialog
-from tartanFunctions import getModName, doPrinter
+from tartanFunctions import copyList, getModName, doPrinter
 
 class bc3080:
-    def __init__(self, mf, conum, conam):
-        self.mf = mf
-        self.conum = conum
-        self.conam = conam
+    def __init__(self, **opts):
+        self.opts = opts
         self.setVariables()
-        self.mainProcess()
-        self.mf.startLoop()
+        if "args" in self.opts:
+            self.ctyp = self.opts["args"][0]
+            self.cnam = self.opts["args"][1]
+            self.card = False
+            self.qty = 1
+            self.doEnd()
+        else:
+            self.mainProcess()
+            self.opts["mf"].startLoop()
 
     def setVariables(self):
-        self.sql = Sql(self.mf.dbm, ["bwlcmp", "bwltyp"],
+        self.sql = Sql(self.opts["mf"].dbm, ["bwlcmp", "bwltyp", "bwlpts"],
             prog=__name__)
         t = time.localtime()
         self.sysdt = time.strftime("%d %B %Y %H:%M:%S", t)
-        self.image = os.path.join(self.mf.rcdic["prgdir"], "img", "bowls.png")
+        self.image = os.path.join(self.opts["mf"].rcdic["prgdir"],
+            "img", "bowls.png")
         if not os.path.isfile(self.image):
             self.image = None
         self.card = True
 
     def mainProcess(self):
-        tit = ("%03i %s" % (self.conum, self.conam), "Competition Format")
+        tit = ("%03i %s" % (self.opts["conum"], self.opts["conam"]),
+            "Competition Format")
         com = {
             "stype": "R",
             "tables": ("bwlcmp",),
@@ -45,7 +52,7 @@
                 ("bcm_code", "", 0, "Cod"),
                 ("bcm_name", "", 0, "Name", "Y"),
                 ("bcm_date", "", 0, "Date")),
-            "where": [("bcm_cono", "=", self.conum)]}
+            "where": [("bcm_cono", "=", self.opts["conum"])]}
         r1s = (("A4 Page", "P"), ("A6 Card", "C"))
         fld = (
             (("T",0,0,0),"I@bcm_code",0,"","",
@@ -57,16 +64,15 @@
                 1,"N",self.doQty,None,None,("notzero",)))
         tnd = ((self.doEnd,"y"),)
         txt = (self.doExit,)
-        self.df = TartanDialog(self.mf, tops=False, title=tit, eflds=fld,
-            tend=tnd, txit=txt, view=("N","V"))
+        self.df = TartanDialog(self.opts["mf"], tops=False, title=tit,
+            eflds=fld, tend=tnd, txit=txt, view=("N","V"))
 
     def doCmpCod(self, frt, pag, r, c, p, i, w):
         chk = self.sql.getRec(tables="bwlcmp", cols=["bcm_name", "bcm_type"],
-            where=[("bcm_cono", "=", self.conum), ("bcm_code", "=", w)],
+            where=[("bcm_cono", "=", self.opts["conum"]), ("bcm_code", "=", w)],
             limit=1)
         if not chk:
             return "Invalid Competition Code"
-        self.ccod = w
         self.cnam = chk[0]
         self.ctyp = chk[1]
         self.df.loadEntry(frt, pag, p+1, data=self.cnam)
@@ -81,36 +87,56 @@
         self.qty = w
 
     def doEnd(self):
-        self.df.closeProcess()
+        if not "args" in self.opts:
+            prt = copyList(self.df.repprt)
+            eml = copyList(self.df.repeml)
+            self.df.closeProcess()
+        else:
+            prt = ["Y", "V", "view"]
+            eml = None
         self.drawFormat()
-        pdfnam = getModName(self.mf.rcdic["wrkdir"], __name__, self.conum,
-            ext="pdf")
+        pdfnam = getModName(self.opts["mf"].rcdic["wrkdir"], __name__,
+            self.opts["conum"], ext="pdf")
         self.fpdf.output(pdfnam, "F")
-        doPrinter(mf=self.mf, pdfnam=pdfnam, repprt=self.df.repprt,
-            repeml=self.df.repeml)
-        self.mf.closeLoop()
+        doPrinter(mf=self.opts["mf"], pdfnam=pdfnam, repprt=prt, repeml=eml)
+        if not "args" in self.opts:
+            self.opts["mf"].closeLoop()
 
     def drawFormat(self):
-        whr = [("bct_cono", "=", self.conum), ("bct_code", "=", self.ctyp)]
+        whr = [
+            ("bct_cono", "=", self.opts["conum"]),
+            ("bct_code", "=", self.ctyp)]
         rec = self.sql.getRec(tables="bwltyp", where=whr, limit=1)
         ldic = {}
         for col in self.sql.bwltyp_col[3:]:
             ldic[col] = rec[self.sql.bwltyp_col.index(col)]
+        whr = [
+            ("bcp_cono", "=", self.opts["conum"]),
+            ("bcp_code", "=", self.ctyp)]
+        rec = self.sql.getRec(tables="bwlpts", where=whr)
+        for r in rec:
+            if r[self.sql.bwlpts_col.index("bcp_ptyp")] == "D":
+                ptyp = "drawn"
+            else:
+                ptyp = "svs"
+            ldic[ptyp] = {}
+            for col in self.sql.bwlpts_col[3:]:
+                ldic[ptyp][col] = r[self.sql.bwlpts_col.index(col)]
         if self.card:
             self.fpdf = MyFpdf()
             self.fpdf.set_margins(55, 5, 55)
             self.fpdf.c_margin = self.fpdf.c_margin * 2
-            self.fpdf.set_font("Arial","",9)
-            h = 4
+            self.fpdf.set_font("Arial","",8)
+            h = 3.5
         else:
             self.fpdf = MyFpdf(prog=__name__)
             self.fpdf.set_font("Arial","",14)
-            h = 8
+            h = 6
         self.fpdf.header = self.header
         self.fpdf.alias_nb_pages()
         cwth = self.fpdf.get_string_width("X")
-        x1 = self.fpdf.l_margin + (cwth * 25)
-        x2 = self.fpdf.l_margin + (cwth * 27)
+        x1 = self.fpdf.l_margin + (cwth * 20)
+        x2 = self.fpdf.l_margin + (cwth * 22)
         for page in xrange(self.qty):
             self.fpdf.add_page()
             self.fpdf.drawText(txt=self.sql.bwltyp_dic["bct_cfmat"][4],
@@ -170,46 +196,63 @@
                         txt = "%s will Retain %s%s of their score." % (txt,
                             ldic["bct_percent"], "%")
                         self.fpdf.drawText(txt=txt, x=x2, h=h, ctyp="M")
-            self.fpdf.drawText(h=4)
-            if ldic["bct_sends"]:
-                self.fpdf.drawText(txt="Skins", h=h, ln=0)
-                self.fpdf.drawText(txt="Each Set of %s Ends will Constitute "\
-                    "a Skin." % ldic["bct_sends"], x=x1, h=h, ctyp="M")
-            self.fpdf.drawText(txt="Points", h=h, ln=0)
-            txt = ""
-            pts = 0
-            if ldic["bct_e_points"]:
-                if ldic["bct_e_points"] == 1:
-                    txt = "%s Point per End" % ldic["bct_e_points"]
-                else:
-                    txt = "%s Points per End" % ldic["bct_e_points"]
-                self.fpdf.drawText(txt=txt, x=x1, h=h, ctyp="M")
-                pts += (ldic["bct_e_points"] * ldic["bct_ends"])
-            if ldic["bct_s_points"]:
-                if ldic["bct_s_points"] == 1:
-                    txt = "%s Point per Skin" % ldic["bct_s_points"]
-                else:
-                    txt = "%s Points per Skin" % ldic["bct_s_points"]
-                self.fpdf.drawText(txt=txt, x=x1, h=h, ctyp="M")
-                pts += (ldic["bct_s_points"] * (ldic["bct_ends"] /
-                    ldic["bct_sends"]))
-            if ldic["bct_g_points"]:
-                if ldic["bct_g_points"] == 1:
-                    txt = "%s Point per Game" % ldic["bct_g_points"]
-                else:
-                    txt = "%s Points per Game" % ldic["bct_g_points"]
-                self.fpdf.drawText(txt=txt, x=x1, h=h, ctyp="M")
-                pts += ldic["bct_g_points"]
-            if ldic["bct_bonus"] == "Y":
-                txt = "1 Bonus Point will be Awarded as Follows:"
-                self.fpdf.drawText(txt=txt, x=x1, h=h, ctyp="M")
-                txt = "Winning by %s or More Shots or" % (ldic["bct_win_by"]+1)
-                self.fpdf.drawText(txt=txt, x=x2, h=h, ctyp="M")
-                txt = "Losing by %s or Less Shots" % (ldic["bct_lose_by"]-1)
-                self.fpdf.drawText(txt=txt, x=x2, h=h, ctyp="M")
-                pts += 1
-            txt = "Therefore a Maximum of %s Points per Game." % pts
-            self.fpdf.drawText(txt=txt, x=x1, h=h, ctyp="M")
+            # Points
+            self.fpdf.drawText(h=h)
+            if ldic["bct_pdiff"] == "Y":
+                nums = ["drawn", "svs"]
+            else:
+                nums = ["drawn"]
+            for ptyp in nums:
+                if ldic["bct_pdiff"] == "N":
+                    txt = "Scoring for All Games"
+                elif ptyp == "drawn":
+                    txt = "Scoring for Drawn Games"
+                else:
+                    txt = "Scoring for S v S Games"
+                self.fpdf.drawText(txt=txt, h=h)
+                self.fpdf.underLine(h=h, txt="Points for Drawn Games")
+                if ldic[ptyp]["bcp_sends"]:
+                    self.fpdf.drawText(txt="Skins", h=h, ln=0)
+                    self.fpdf.drawText(txt="Each Set of %s Ends will "\
+                        "Constitute a Skin." % ldic[ptyp]["bcp_sends"], x=x1,
+                        h=h, ctyp="M")
+                self.fpdf.drawText(txt="Points", h=h, ln=0)
+                txt = ""
+                pts = 0
+                if ldic[ptyp]["bcp_e_points"]:
+                    if ldic[ptyp]["bcp_e_points"] == 1:
+                        txt = "%s Point per End" % ldic[ptyp]["bcp_e_points"]
+                    else:
+                        txt = "%s Points per End" % ldic[ptyp]["bcp_e_points"]
+                    self.fpdf.drawText(txt=txt, x=x1, h=h, ctyp="M")
+                    pts += (ldic[ptyp]["bcp_e_points"] * ldic["bct_ends"])
+                if ldic[ptyp]["bcp_s_points"]:
+                    if ldic[ptyp]["bcp_s_points"] == 1:
+                        txt = "%s Point per Skin" % ldic[ptyp]["bcp_s_points"]
+                    else:
+                        txt = "%s Points per Skin" % ldic[ptyp]["bcp_s_points"]
+                    self.fpdf.drawText(txt=txt, x=x1, h=h, ctyp="M")
+                    pts += (ldic[ptyp]["bcp_s_points"] *
+                        (ldic["bct_ends"] / ldic[ptyp]["bcp_sends"]))
+                if ldic[ptyp]["bcp_g_points"]:
+                    if ldic[ptyp]["bcp_g_points"] == 1:
+                        txt = "%s Point per Game" % ldic[ptyp]["bcp_g_points"]
+                    else:
+                        txt = "%s Points per Game" % ldic[ptyp]["bcp_g_points"]
+                    self.fpdf.drawText(txt=txt, x=x1, h=h, ctyp="M")
+                    pts += ldic[ptyp]["bcp_g_points"]
+                if ldic[ptyp]["bcp_bonus"] == "Y":
+                    txt = "1 Bonus Point will be Awarded as Follows:"
+                    self.fpdf.drawText(txt=txt, x=x1, h=h, ctyp="M")
+                    txt = "Winning by %s or More Shots or" % \
+                        (ldic[ptyp]["bcp_win_by"] + 11)
+                    self.fpdf.drawText(txt=txt, x=x2, h=h, ctyp="M")
+                    txt = "Losing by %s or Less Shots" % \
+                        (ldic[ptyp]["bcp_lose_by"] - 1)
+                    self.fpdf.drawText(txt=txt, x=x2, h=h, ctyp="M")
+                    pts += 1
+                txt = "Therefore a Maximum of %s Points per Game." % pts
+                self.fpdf.drawText(txt=txt, x=x1, h=h, ctyp="M")
 
     def header(self):
         if self.card:
@@ -220,7 +263,7 @@
             self.fpdf.set_line_width(1)
             self.fpdf.rect(self.fpdf.l_margin, self.fpdf.t_margin, 100, 140)
             self.fpdf.set_line_width(0)
-            self.fpdf.ln(5)
+            self.fpdf.ln(4)
             return
         if self.image:
             if self.card:
@@ -234,6 +277,6 @@
 
     def doExit(self):
         self.df.closeProcess()
-        self.mf.closeLoop()
+        self.opts["mf"].closeLoop()
 
 # vim:set ts=4 sw=4 sts=4 expandtab:

=== modified file 'bwl/bc3100.py'
--- bwl/bc3100.py	2015-10-03 07:36:56 +0000
+++ bwl/bc3100.py	2015-12-03 15:28:16 +0000
@@ -14,7 +14,7 @@
 """
 
 from TartanClasses import CCD, MyFpdf, TartanDialog, Sql
-from tartanFunctions import doPrinter, getModName, copyList
+from tartanFunctions import doPrinter, copyList, getModName
 
 class bc3100:
     def __init__(self, **opts):
@@ -25,7 +25,7 @@
 
     def setVariables(self):
         self.sql = Sql(self.opts["mf"].dbm, ["bwlcmp", "bwlgme", "bwltab",
-            "bwltyp", "bwlent"], prog=__name__)
+            "bwltyp", "bwlpts", "bwlent"], prog=__name__)
         if self.sql.error:
             return
         self.groups = ["None", "A", "B", "C", "D", "E"]
@@ -66,9 +66,9 @@
             return "Invalid Competition Code"
         self.ccod = w
         self.cdes = chk[self.sql.bwlcmp_col.index("bcm_name")]
-        ctyp = chk[self.sql.bwlcmp_col.index("bcm_type")]
+        self.ctyp = chk[self.sql.bwlcmp_col.index("bcm_type")]
         chk = self.sql.getRec(tables="bwltyp", where=[("bct_cono", "=",
-            self.opts["conum"]), ("bct_code", "=", ctyp)], limit=1)
+            self.opts["conum"]), ("bct_code", "=", self.ctyp)], limit=1)
         self.grgame = chk[self.sql.bwltyp_col.index("bct_grgame")]
         game = self.sql.getRec(tables="bwlgme", cols=["bcg_game", "bcg_aflag",
             "sum(bcg_points)"], where=[("bcg_cono", "=", self.opts["conum"]),
@@ -104,17 +104,41 @@
             self.game = w
         chk = self.sql.getRec(tables="bwlgme", cols=["count(*)"],
             where=[("bcg_cono", "=", self.opts["conum"]), ("bcg_ccod",
-            "=", self.ccod), ("bcg_game", "=", self.game),
-            ("bcg_points", "=", 0), ("bcg_aflag", "=", "")],
-            group="bcg_game", limit=1)
-        if chk and chk[0]:
-            return "%s Result(s) Not Yet Entered" % (chk[0] / 2)
-        chk = self.sql.getRec(tables="bwlgme", cols=["count(*)"],
-            where=[("bcg_cono", "=", self.opts["conum"]), ("bcg_ccod",
             "=", self.ccod), ("bcg_game", "=", self.game), ("bcg_aflag",
             "=", "A")], group="bcg_aflag", limit=1)
         if chk and chk[0]:
             return "Game Abandoned"
+        chk = self.sql.getRec(tables="bwlgme", where=[("bcg_cono", "=",
+            self.opts["conum"]), ("bcg_ccod", "=", self.ccod), ("bcg_game",
+            "=", self.game), ("bcg_aflag", "in", ("", "D"))])
+        if not chk:
+            return "Invalid Game Number"
+        ptyp = chk[0][self.sql.bwlgme_col.index("bcg_type")]
+        pts = self.sql.getRec(tables="bwlpts", where=[("bcp_cono",
+            "=", self.opts["conum"]), ("bcp_code", "=", self.ctyp),
+            ("bcp_ptyp", "=", ptyp)], limit=1)
+        ponly = pts[self.sql.bwlpts_col.index("bcp_p_only")]
+        non = []
+        for c in chk:
+            scod = c[self.sql.bwlgme_col.index("bcg_scod")]
+            ocod = c[self.sql.bwlgme_col.index("bcg_ocod")]
+            #if scod > 900000 or ocod > 900000:
+            #    continue
+            if ponly == "Y":
+                fors = c[self.sql.bwlgme_col.index("bcg_points")]
+                agts = self.sql.getRec(tables="bwlgme",
+                    cols=["bcg_points"], where=[("bcg_cono", "=",
+                    self.opts["conum"]), ("bcg_ccod", "=", self.ccod),
+                    ("bcg_game", "=", self.game), ("bcg_scod",
+                    "=", ocod)], limit=1)[0]
+            else:
+                fors = c[self.sql.bwlgme_col.index("bcg_shots_for")]
+                agts = c[self.sql.bwlgme_col.index("bcg_shots_agt")]
+            if not fors and not agts:
+                if not scod in non:
+                    non.append(scod)
+        if non:
+            return "%s Result(s) Not Yet Entered" % (len(non) / 2)
 
     def doEnd(self):
         self.df.closeProcess()

=== modified file 'bwl/bc3110.py'
--- bwl/bc3110.py	2015-10-03 07:36:56 +0000
+++ bwl/bc3110.py	2015-12-03 15:28:08 +0000
@@ -15,7 +15,7 @@
 
 import os
 from TartanClasses import CCD, MyFpdf, TartanDialog, Sql
-from tartanFunctions import askQuestion, doPrinter, getModName, copyList
+from tartanFunctions import askQuestion, copyList, doPrinter, getModName
 
 class bc3110:
     def __init__(self, **opts):
@@ -26,7 +26,7 @@
 
     def setVariables(self):
         self.sql = Sql(self.opts["mf"].dbm, ["bwlcmp", "bwlgme", "bwltab",
-            "bwltyp", "bwlent"], prog=__name__)
+            "bwltyp", "bwlpts", "bwlent"], prog=__name__)
         if self.sql.error:
             return
         self.grpcod = ["", "A", "B", "C"]
@@ -70,9 +70,9 @@
             return "Invalid Competition Code"
         self.ccod = w
         self.cdes = chk[self.sql.bwlcmp_col.index("bcm_name")]
-        ctyp = chk[self.sql.bwlcmp_col.index("bcm_type")]
+        self.ctyp = chk[self.sql.bwlcmp_col.index("bcm_type")]
         chk = self.sql.getRec(tables="bwltyp", where=[("bct_cono", "=",
-            self.opts["conum"]), ("bct_code", "=", ctyp)], limit=1)
+            self.opts["conum"]), ("bct_code", "=", self.ctyp)], limit=1)
         self.cfmat = chk[self.sql.bwltyp_col.index("bct_cfmat")]
         self.tsize = chk[self.sql.bwltyp_col.index("bct_tsize")]
         if self.cfmat in ("K", "R"):
@@ -83,7 +83,6 @@
             self.games = chk[self.sql.bwltyp_col.index("bct_games")]
         self.groups = chk[self.sql.bwltyp_col.index("bct_groups")]
         self.grgame = chk[self.sql.bwltyp_col.index("bct_grgame")]
-        self.only = chk[self.sql.bwltyp_col.index("bct_p_only")]
         game = self.sql.getRec(tables="bwlgme", cols=["bcg_game", "bcg_aflag",
             "sum(bcg_points)"], where=[("bcg_cono", "=", self.opts["conum"]),
             ("bcg_ccod", "=", self.ccod)], group="bcg_game, bcg_aflag",
@@ -99,17 +98,59 @@
         self.df.loadEntry(frt, pag, p+2, data=self.game)
 
     def doLstGam(self, frt, pag, r, c, p, i, w):
+        if not w:
+            chk = self.sql.getRec(tables="bwlgme", cols=["bcg_game",
+                "sum(bcg_points)"], where=[("bcg_cono", "=",
+                self.opts["conum"]), ("bcg_ccod", "=", self.ccod)],
+                group="bcg_game", order="bcg_game")
+            self.game = 0
+            for g in chk:
+                if g[1]:
+                    self.game = g[0]
+                else:
+                    break
+            if not self.game:
+                return "No Completed Games"
+            self.df.loadEntry(frt, pag, p, data=self.game)
+        else:
+            self.game = w
         chk = self.sql.getRec(tables="bwlgme", cols=["count(*)"],
             where=[("bcg_cono", "=", self.opts["conum"]), ("bcg_ccod",
-            "=", self.ccod), ("bcg_game", "=", w), ("bcg_aflag", "=", "A")],
-            limit=1)
-        if not chk[0]:
-            chk = self.sql.getRec(tables="bwlgme", cols=["count(*)"],
-                where=[("bcg_cono", "=", self.opts["conum"]), ("bcg_ccod",
-                "=", self.ccod), ("bcg_game", "=", w), ("bcg_points", "=",
-                0), ("bcg_aflag", "<>", "S")], limit=1)
-            if chk[0]:
-                return "%s Game Result(s) Not Yet Entered" % (chk[0] / 2)
+            "=", self.ccod), ("bcg_game", "=", self.game), ("bcg_aflag",
+            "=", "A")], group="bcg_aflag", limit=1)
+        if chk and chk[0]:
+            return "Game Abandoned"
+        chk = self.sql.getRec(tables="bwlgme", where=[("bcg_cono", "=",
+            self.opts["conum"]), ("bcg_ccod", "=", self.ccod), ("bcg_game",
+            "=", self.game), ("bcg_aflag", "in", ("", "D"))])
+        if not chk:
+            return "Invalid Game Number"
+        ptyp = chk[0][self.sql.bwlgme_col.index("bcg_type")]
+        pts = self.sql.getRec(tables="bwlpts", where=[("bcp_cono",
+            "=", self.opts["conum"]), ("bcp_code", "=", self.ctyp),
+            ("bcp_ptyp", "=", ptyp)], limit=1)
+        self.ponly = pts[self.sql.bwlpts_col.index("bcp_p_only")]
+        non = []
+        for c in chk:
+            scod = c[self.sql.bwlgme_col.index("bcg_scod")]
+            ocod = c[self.sql.bwlgme_col.index("bcg_ocod")]
+            #if scod > 900000 or ocod > 900000:
+            #    continue
+            if self.ponly == "Y":
+                fors = c[self.sql.bwlgme_col.index("bcg_points")]
+                agts = self.sql.getRec(tables="bwlgme",
+                    cols=["bcg_points"], where=[("bcg_cono", "=",
+                    self.opts["conum"]), ("bcg_ccod", "=", self.ccod),
+                    ("bcg_game", "=", self.game), ("bcg_scod",
+                    "=", ocod)], limit=1)[0]
+            else:
+                fors = c[self.sql.bwlgme_col.index("bcg_shots_for")]
+                agts = c[self.sql.bwlgme_col.index("bcg_shots_agt")]
+            if not fors and not agts:
+                if not scod in non:
+                    non.append(scod)
+        if non:
+            return "%s Result(s) Not Yet Entered" % (len(non) / 2)
         self.lastgam = w
         if self.lastgam == self.games and self.groups == "Y":
             return
@@ -251,9 +292,9 @@
                     if gpc == done:
                         continue
                     ign = False
-                    if self.only == "Y" and not rec[6]:
+                    if self.ponly == "Y" and not rec[6]:
                         break
-                    if self.only == "N" and (not rec[3] and not rec[4]):
+                    if self.ponly == "N" and (not rec[3] and not rec[4]):
                         break
                     for grp in xrange(gqty):
                         if self.groups == "Y":

=== modified file 'bwl/bcc210.py'
--- bwl/bcc210.py	2014-12-30 15:37:38 +0000
+++ bwl/bcc210.py	2015-11-28 07:14:42 +0000
@@ -71,8 +71,8 @@
                 self.df.loadEntry(frt, pag, num, data=fld)
 
     def doName(self, frt, pag, r, c, p, i, w):
-        if self.newclb and self.sql.getRec(tables="bwlclb", where=[("bcc_name",
-                                                                "ilike", w)]):
+        if self.newclb and self.sql.getRec(
+                tables="bwlclb", where=[("bcc_name", "ilike", w)]):
             return "A Club with this Name Already Exists"
 
     def doDelete(self, widget=None):

=== modified file 'crs/cr1010_rne.py'
--- crs/cr1010_rne.py	2015-05-20 16:03:01 +0000
+++ crs/cr1010_rne.py	2015-12-02 07:31:13 +0000
@@ -47,6 +47,7 @@
             ("Basic-_C",None,("T",1,1),("T",0,1)))
         r1s = (("Monthly","M"),("Daily","D"))
         r2s = (("Yes","Y"),("No","N"))
+        r3s = (("Flat","F"),("Diminishing","D"))
         self.fld = (
             (("T",0,0,0),"INA",7,"Acc-Num","Account Number",
                 "","Y",self.doAcno,crm,None,("notblank",)),
@@ -101,33 +102,35 @@
             (("T",2,9,0),"INA",16,"Bank Account","",
                 "","N",None,None,None,("efld",)),
             (("T",2,10,0),"OUI",7,"G/L Account"),
-            (("T",3,0,0),"IUD",5.2,"Advert Discount","Advertising Discount",
-                0,"N",None,None,None,("efld",)),
-            (("T",3,1,0),"IUD",5.2,"Incent Discount","Incentive Discount",
-                0,"N",None,None,None,("efld",)),
-            (("T",3,2,0),"IUD",5.2,"Incentive From","",
-                0,"N",None,None,None,("efld",)),
-            (("T",3,3,0),"IUD",5.2,"Incentive To","",
-                0,"N",None,None,None,("efld",)),
-            (("T",3,4,0),"IUA",1,"Rebate Period","Rebate Period (Q,B,A)",
-                "","N",self.doPeriod,None,None,None),
-            (("T",3,5,0),"IUD",5.2,"Rebate Rate","",
-                0,"N",None,None,None,("efld",)),
-            (("T",3,6,0),"INA",30,"Targeted","",
-                0,"N",None,None,None,("efld",)),
-            (("T",3,7,0),"IUA",1,"Advert Period","Advert Period (Q,B,A)",
-                "","N",self.doPeriod,None,None,None),
-            (("T",3,8,0),"IUD",5.2,"Advert Rate","",
-                0,"N",None,None,None,("efld",)),
-            (("T",3,9,0),"IUD",9.2,"ADHOC Amount","",
-                0,"N",None,None,None,("efld",)),
-            (("T",3,10,0),"IUD",5.2,"SWELL Rate","",
-                0,"N",None,None,None,("efld",)),
-            (("T",3,11,0),"Id2",7,"Period Start","",
-                0,"N",None,None,None,("efld",)),
-            (("T",3,12,0),"Id2",7,"Period End","",
-                0,"N",None,None,None,("efld",)),
-            (("T",3,13,0),"INA",10,"EFT Reference","",
+            (("T",3,0,0),("IRB",r3s),0,"Discount Base","",
+                "F","N",None,None,None,None),
+            (("T",3,1,0),"IUD",5.2,"Advert Discount","Advertising Discount",
+                0,"N",None,None,None,("efld",)),
+            (("T",3,2,0),"IUD",5.2,"Incent Discount","Incentive Discount",
+                0,"N",None,None,None,("efld",)),
+            (("T",3,3,0),"IUD",5.2,"Incentive From","",
+                0,"N",None,None,None,("efld",)),
+            (("T",3,4,0),"IUD",5.2,"Incentive To","",
+                0,"N",None,None,None,("efld",)),
+            (("T",3,5,0),"IUA",1,"Rebate Period","Rebate Period (Q,B,A)",
+                "","N",self.doPeriod,None,None,None),
+            (("T",3,6,0),"IUD",5.2,"Rebate Rate","",
+                0,"N",None,None,None,("efld",)),
+            (("T",3,7,0),"INA",30,"Targeted","",
+                0,"N",None,None,None,("efld",)),
+            (("T",3,8,0),"IUA",1,"Advert Period","Advert Period (Q,B,A)",
+                "","N",self.doPeriod,None,None,None),
+            (("T",3,9,0),"IUD",5.2,"Advert Rate","",
+                0,"N",None,None,None,("efld",)),
+            (("T",3,10,0),"IUD",9.2,"ADHOC Amount","",
+                0,"N",None,None,None,("efld",)),
+            (("T",3,11,0),"IUD",5.2,"SWELL Rate","",
+                0,"N",None,None,None,("efld",)),
+            (("T",3,12,0),"Id2",7,"Period Start","",
+                0,"N",None,None,None,("efld",)),
+            (("T",3,13,0),"Id2",7,"Period End","",
+                0,"N",None,None,None,("efld",)),
+            (("T",3,14,0),"INA",10,"EFT Reference","",
                 "","N",None,None,None,("efld",)))
         but = (
             ("Accept",None,self.doAccept,0,("T",0,2),("T",3,0)),
@@ -287,7 +290,8 @@
                 if pag == 0 and x == 0:
                     tables.append(["",""])
         heads = ["Creditors File Maintenance"]
-        cols = [["a","NA",30.0,"Field Name"],
+        cols = [
+            ["a","NA",30.0,"Field Name"],
             ["b","NA",30.0,"Values"]]
         state = self.df.disableButtonsTags()
         RepPrt(self.opts["mf"], name=__name__, tables=tables, heads=heads,

=== modified file 'crs/cr2010.py'
--- crs/cr2010.py	2015-10-25 09:33:02 +0000
+++ crs/cr2010.py	2015-11-06 11:39:55 +0000
@@ -62,7 +62,9 @@
                 self.incoac = False
         # Get Enabled Modules
         self.lonmod = False
+        self.lonpag = None
         self.slnmod = False
+        self.slnpag = None
         for x in xrange(0, len(ctlmst["ctm_modules"].rstrip()), 2):
             if ctlmst["ctm_modules"][x:x+2] == "LN":
                 self.lonmod = True
@@ -646,9 +648,9 @@
             row = int((self.df.last[1][1] - 1) / self.df.colq[1])
             col = (row * self.df.colq[1]) + 1
             self.df.focusField("C", 1, col)
-            if self.lonmod and pag == self.lonpag:
+            if self.lonpag and pag == self.lonpag:
                 self.opts["mf"].closeLoop()
-            elif self.slnmod and pag == self.slnpag:
+            elif self.slnpag and pag == self.slnpag:
                 self.opts["mf"].closeLoop()
 
     def endPage2(self):

=== modified file 'crs/cr2010_rne.py'
--- crs/cr2010_rne.py	2015-10-03 07:36:56 +0000
+++ crs/cr2010_rne.py	2015-11-10 02:25:07 +0000
@@ -312,8 +312,7 @@
             self.opts["capnm"], self.sysdtw, 0]
         self.sql.insRec("crstrn", data=data)
         data = [self.opts["conum"], self.cracno, self.opts["rtn"], self.ref1,
-            self.trnbch, 0, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0, 0, 0, 0, 0,
-            0]
+            self.trnbch, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
         self.sql.insRec("crsrtf", data=data)
 
     def updateBatch(self, rev=False):

=== modified file 'crs/cr2020_rne.py'
--- crs/cr2020_rne.py	2015-10-03 07:36:56 +0000
+++ crs/cr2020_rne.py	2015-12-02 07:37:13 +0000
@@ -113,7 +113,7 @@
         tnd = ((self.doEnd,"Y"), )
         txt = (self.doExit, )
         self.df = TartanDialog(self.opts["mf"], title=tit, eflds=fld,
-            tend=tnd, txit=txt, view=("N","P"), mail=("N","N"))
+            tend=tnd, txit=txt, view=("N","P"), mail=("N","Y"))
 
     def doTplNam(self, frt, pag, r, c, p, i, w):
         acc = self.sql.getRec(tables="tplmst", where=[("tpm_tname", "=", w),
@@ -222,7 +222,7 @@
                 p.displayProgress(num)
                 self.doProcess(rec)
             p.closeProgress()
-            if self.repeml[1] == "N":
+            if self.df.repeml[1] == "N":
                 self.doPrint()
         self.opts["mf"].closeLoop()
 
@@ -410,6 +410,7 @@
                 "The crsrmf file does not exist for this supplier, %s" % \
                 self.acno.disp)
             return
+        self.dbase = rmf[rmc.index("rmf_dbase")]
         self.incper = CCD(rmf[rmc.index("rmf_icdis")], "UD", 5.2)
         self.advper = CCD(rmf[rmc.index("rmf_avdis")], "UD", 5.2)
         self.eftref = rmf[rmc.index("rmf_eftref")]
@@ -483,14 +484,16 @@
                     distax = 0.00
                 else:
                     disamt = round(((amt * disper.work) / 100.0), 2)
-                amt = float(ASD(amt) - ASD(disamt))
+                if self.dbase == "D":
+                    amt = float(ASD(amt) - ASD(disamt))
                 incper = CCD(self.incper.work, "UD", 5.2)
                 if not amt or not incper.work:
                     incamt = 0.00
                     inctax = 0.00
                 else:
                     incamt = round(((amt * incper.work) / 100.0), 2)
-                amt = float(ASD(amt) - ASD(incamt))
+                if self.dbase == "D":
+                    amt = float(ASD(amt) - ASD(incamt))
                 advper = CCD(self.advper.work, "UD", 5.2)
                 if not amt or not advper.work:
                     advamt = 0.00
@@ -550,7 +553,7 @@
             for cod in self.form.body:
                 d = "%s_C%02i" % (cod, count)
                 if cod == "dep_pj_code":
-                    self.form.newdic[d][text] = "%-2s%03i" % (depno, pjno)
+                    self.form.newdic[d][text] = "%-3s%05i" % (depno, pjno)
                 elif cod == "document_type":
                     ttyp = tr[ctc.index("crt_type")]
                     self.form.newdic[d][text] = crtrtp[ttyp - 1][0]
@@ -594,8 +597,8 @@
                 self.form.doDrawDetail(self.form.newdic[d])
         if self.doTotal(tdc):
             self.doTail(tdc)
-            if self.email == "Y":
-                self.repeml[2] = self.emlto
+            if self.df.repeml[1] == "Y":
+                self.df.repeml[2] = self.emlto
                 self.doPrint()
         else:
             self.form.page = self.pgsve
@@ -755,7 +758,7 @@
         self.opts["mf"].dbm.commitDbase()
 
     def doPrint(self):
-        if self.repeml[1] == "N":
+        if self.df.repeml[1] == "N":
             key = "%s_all_all" % self.opts["conum"]
         elif self.elec:
             key = "%03i_%s_EFT%06i" % (self.opts["conum"], self.acno.work,
@@ -775,9 +778,9 @@
             ext="pdf")
         self.form.output(pdfnam, "F")
         doPrinter(mf=self.opts["mf"], conum=self.opts["conum"], pdfnam=pdfnam,
-            head="%s REMITTANCE ADVICE" % self.opts["conam"],
+            head="%s Remittance Advice" % self.opts["conam"],
             repprt=self.df.repprt, repeml=self.df.repeml, fromad=fromad)
-        if self.repeml[1] == "Y":
+        if self.df.repeml[1] == "Y":
             self.form = DrawForm(self.opts["mf"].dbm, self.tname,
                 wrkdir=self.opts["mf"].rcdic["wrkdir"])
             self.doLoadStatic()

=== modified file 'crs/cr3030_rne.py'
--- crs/cr3030_rne.py	2015-10-03 07:36:56 +0000
+++ crs/cr3030_rne.py	2015-12-02 09:34:03 +0000
@@ -102,10 +102,12 @@
             rmf = self.sql.getRec(tables="crsrmf", where=[("rmf_cono", "=",
                 self.opts["conum"]), ("rmf_acno", "=", acno.work)], limit=1)
             if not rmf:
+                self.dbase = "F"
                 self.incper = CCD(0, "UD", 5.2)
                 self.advper = CCD(0, "UD", 5.2)
             else:
                 rmc = self.sql.crsrmf_col
+                self.dbase = rmf[rmc.index("rmf_dbase")]
                 self.incper = CCD(rmf[rmc.index("rmf_icdis")], "UD", 5.2)
                 self.advper = CCD(rmf[rmc.index("rmf_avdis")], "UD", 5.2)
             if rec[2] and rec[3] and rec[4]:
@@ -132,38 +134,53 @@
                 paid = CCD(rec[col.index("paid")], "SD", 13.2)
                 trbal = CCD(rec[col.index("balance")], "SD", 13.2)
                 if trtp in (2, 3, 5, 6):
-                    sett = CCD(0, "SD", 13.2)
+                    totd = CCD(0, "SD", 13.2)
                     nett = trbal
                 else:
+                    # Settlement discount
                     disa = round((trbal.work * disper.work / 100.0), 2)
                     disa = CCD(disa, "SD", 13.2)
-                    sett = disa.work
-                    nett = CCD(float(ASD(trbal.work)-ASD(disa.work)),"SD",13.2)
+                    totd = disa.work
+                    if self.dbase == "F":
+                        nett = trbal.work
+                    else:
+                        nett = float(ASD(trbal.work) - ASD(disa.work))
+                    nett = CCD(nett, "SD", 13.2)
+                    # Incentive discount
                     disa = round((nett.work * self.incper.work / 100.0), 2)
                     disa = CCD(disa, "SD", 13.2)
-                    sett = float(ASD(sett) + ASD(disa.work))
-                    nett = CCD(float(ASD(nett.work)-ASD(disa.work)),"SD",13.2)
+                    totd = float(ASD(totd) + ASD(disa.work))
+                    if self.dbase == "F":
+                        nett = trbal.work
+                    else:
+                        nett = float(ASD(nett.work) - ASD(disa.work))
+                    nett = CCD(nett, "SD", 13.2)
+                    # Advertising discount
                     disa = round((nett.work * self.advper.work / 100.0), 2)
                     disa = CCD(disa, "SD", 13.2)
-                    sett = float(ASD(sett) + ASD(disa.work))
-                    sett = CCD(sett, "SD", 13.2)
-                    nett = CCD(float(ASD(nett.work)-ASD(disa.work)),"SD",13.2)
+                    totd = float(ASD(totd) + ASD(disa.work))
+                    totd = CCD(totd, "SD", 13.2)
+                    if self.dbase == "F":
+                        nett = float(ASD(trbal.work) - ASD(totd.work))
+                    else:
+                        nett = float(ASD(nett.work) - ASD(disa.work))
+                    nett = CCD(nett, "SD", 13.2)
                 if self.pglin > self.fpdf.lpp:
                     self.pageHeading(acno.disp, name.disp, ptyp)
                 self.fpdf.drawText("%s %s %s %s %s %s %s %s %s %s" % \
                     (ref1.disp, ref2.disp, crtrtp[trtp.work-1][0], trdt.disp,
-                    disper.disp, tramt.disp, paid.disp, trbal.disp, sett.disp,
+                    disper.disp, tramt.disp, paid.disp, trbal.disp, totd.disp,
                     nett.disp))
                 self.pglin += 1
                 self.ctots[0] = float(ASD(self.ctots[0]) + ASD(tramt.work))
                 self.ctots[1] = float(ASD(self.ctots[1]) + ASD(paid.work))
                 self.ctots[2] = float(ASD(self.ctots[2]) + ASD(trbal.work))
-                self.ctots[3] = float(ASD(self.ctots[3]) + ASD(sett.work))
+                self.ctots[3] = float(ASD(self.ctots[3]) + ASD(totd.work))
                 self.ctots[4] = float(ASD(self.ctots[4]) + ASD(nett.work))
                 self.gtots[0] = float(ASD(self.gtots[0]) + ASD(tramt.work))
                 self.gtots[1] = float(ASD(self.gtots[1]) + ASD(paid.work))
                 self.gtots[2] = float(ASD(self.gtots[2]) + ASD(trbal.work))
-                self.gtots[3] = float(ASD(self.gtots[3]) + ASD(sett.work))
+                self.gtots[3] = float(ASD(self.gtots[3]) + ASD(totd.work))
                 self.gtots[4] = float(ASD(self.gtots[4]) + ASD(nett.work))
             if self.fpdf.page:
                 self.accountTotal()

=== modified file 'crs/cr3080.py'
--- crs/cr3080.py	2015-10-03 07:36:56 +0000
+++ crs/cr3080.py	2015-12-11 19:17:56 +0000
@@ -451,7 +451,7 @@
             ext="pdf")
         self.form.output(pdfnam, "F")
         doPrinter(mf=self.opts["mf"], conum=self.opts["conum"], pdfnam=pdfnam,
-            head="%s REMITTANCE ADVICE" % self.opts["conam"],
+            head="%s Remittance Advice" % self.opts["conam"],
             repprt=self.df.repprt, repeml=self.df.repeml)
         if self.df.repeml[1] == "Y":
             self.form = DrawForm(self.opts["mf"].dbm, self.tname,

=== modified file 'crs/cr3310_rne.py'
--- crs/cr3310_rne.py	2015-10-03 07:36:56 +0000
+++ crs/cr3310_rne.py	2015-12-02 08:30:53 +0000
@@ -34,13 +34,13 @@
         self.sysdtd = "%i/%02i/%02i" % (t[0], t[1], t[2])
         self.sysdttm = "(Printed on: %i/%02i/%02i at %02i:%02i) %6s" % (t[0],
             t[1], t[2], t[3], t[4], __name__)
-        self.colsh = ["Acc-Num", "Name", "Trm", "B", "Dy", "Set-%", "Adv-%",
-            "Inc-%", "I-Frm", "I-To", "P", "Reb-%", "Targeted", "P", "Adv-R",
-            "ADHOC-Amt", "SWL-%", "Sta-Per", "End-Per"]
+        self.colsh = ["Acc-Num", "Name", "Trm", "B", "Dy", "D", "Set-%",
+            "Adv-%", "Inc-%", "I-Frm", "I-To", "P", "Reb-%", "Targeted",
+            "P", "Adv-R", "ADHOC-Amt", "SWL-%", "Sta-Per", "End-Per"]
         self.forms = [("NA", 7), ("NA", 30), ("UI", 3), ("NA", 1), ("UI", 2),
-            ("UD", 5.2), ("UD", 5.2), ("UD", 5.2), ("UD", 5.2), ("UD", 5.2),
-            ("UA", 1), ("UD", 5.2), ("Targeted", 30), ("UA", 1), ("UD", 5.2),
-            ("UD", 9.2), ("UD", 5.2), ("D2", 7), ("D2", 7)]
+            ("UA", 1), ("UD", 5.2), ("UD", 5.2), ("UD", 5.2), ("UD", 5.2),
+            ("UD", 5.2), ("UA", 1), ("UD", 5.2), ("Targeted", 30), ("UA", 1),
+            ("UD", 5.2), ("UD", 9.2), ("UD", 5.2), ("D2", 7), ("D2", 7)]
         return True
 
     def mainProcess(self):
@@ -77,10 +77,10 @@
             odr = "crm_acno"
         else:
             odr = "crm_name"
-        col = ["crm_acno, crm_name, crm_terms, crm_termsb, crm_stday, " \
-            "crm_pydis, rmf_avdis, rmf_icdis, rmf_icfrom, rmf_icto, "\
-            "rmf_rbper, rmf_rbrte, rmf_target, rmf_avper, rmf_avrte, "\
-            "rmf_adhoc, rmf_swell, rmf_start, rmf_end"]
+        col = ["crm_acno", "crm_name", "crm_terms", "crm_termsb", "crm_stday",
+            "crm_pydis", "rmf_dbase", "rmf_avdis", "rmf_icdis", "rmf_icfrom",
+            "rmf_icto", "rmf_rbper", "rmf_rbrte", "rmf_target", "rmf_avper",
+            "rmf_avrte", "rmf_adhoc", "rmf_swell", "rmf_start", "rmf_end"]
         recs = self.sql.getRec(tables=tab, cols=col, where=whr, order=odr)
         if not recs:
             showError(self.opts["mf"].body, "Transaction Error",
@@ -124,7 +124,7 @@
 
     def printReport(self, recs):
         p = ProgressBar(self.opts["mf"].body, mxs=len(recs), esc=True)
-        self.head = ("%03u %-30s %110s %10s" % \
+        self.head = ("%03u %-30s %112s %10s" % \
             (self.opts["conum"], self.opts["conam"], self.sysdttm, __name__))
         self.fpdf = MyFpdf(name=__name__, head=self.head)
         self.pgnum = 0
@@ -137,19 +137,20 @@
             if self.pglin > self.fpdf.lpp:
                 self.pageHeading()
             self.fpdf.drawText("%s %s %s %s %s %s %s %s %s %s %s %s %s %s "\
-                "%s %s %s %s %s" % (vals[0].disp, vals[1].disp, vals[2].disp,
-                vals[3].disp, vals[4].disp, vals[5].disp, vals[6].disp,
-                vals[7].disp, vals[8].disp, vals[9].disp, vals[10].disp,
-                vals[11].disp, vals[12].disp, vals[13].disp, vals[14].disp,
-                vals[15].disp, vals[16].disp, vals[17].disp, vals[18].disp))
+                "%s %s %s %s %s %s" % (vals[0].disp, vals[1].disp,
+                vals[2].disp, vals[3].disp, vals[4].disp, vals[5].disp,
+                vals[6].disp, vals[7].disp, vals[8].disp, vals[9].disp,
+                vals[10].disp, vals[11].disp, vals[12].disp, vals[13].disp,
+                vals[14].disp, vals[15].disp, vals[16].disp, vals[17].disp,
+                vals[18].disp, vals[19].disp))
             self.pglin += 1
         p.closeProgress()
         if self.fpdf.page and not p.quit:
             pdfnam = getModName(self.opts["mf"].rcdic["wrkdir"], __name__,
                 self.opts["conum"], ext="pdf")
             self.fpdf.output(pdfnam, "F")
-            doPrinter(mf=self.opts["mf"], conum=self.opts["conum"], pdfnam=pdfnam,
-                head=self.tit, repprt=self.df.repprt,
+            doPrinter(mf=self.opts["mf"], conum=self.opts["conum"],
+                pdfnam=pdfnam, head=self.tit, repprt=self.df.repprt,
                 repeml=self.df.repeml)
         self.closeProcess()
 
@@ -160,21 +161,23 @@
         termsb = CCD(data[3], "NA", 1)
         stday = CCD(data[4], "UI", 2)
         pydis = CCD(data[5], "UD", 5.2)
-        avdis = CCD(data[6], "UD", 5.2)
-        icdis = CCD(data[7], "UD", 5.2)
-        icfrom = CCD(data[8], "UD", 5.2)
-        icto = CCD(data[9], "UD", 5.2)
-        rbper = CCD(data[10], "UA", 1)
-        rbrte = CCD(data[11], "UD", 5.2)
-        target = CCD(data[12], "NA", 30)
-        avper = CCD(data[13], "UA", 1)
-        avrte = CCD(data[14], "UD", 5.2)
-        adhoc = CCD(data[15], "UD", 9.2)
-        swell = CCD(data[16], "UD", 5.2)
-        start = CCD(data[17], "d2", 7)
-        end = CCD(data[18], "d2", 7)
-        return (acno, name, terms, termsb, stday, pydis, avdis, icdis, icfrom,
-            icto, rbper, rbrte, target, avper, avrte, adhoc, swell, start, end)
+        dbase = CCD(data[6], "UA", 1)
+        avdis = CCD(data[7], "UD", 5.2)
+        icdis = CCD(data[8], "UD", 5.2)
+        icfrom = CCD(data[9], "UD", 5.2)
+        icto = CCD(data[10], "UD", 5.2)
+        rbper = CCD(data[11], "UA", 1)
+        rbrte = CCD(data[12], "UD", 5.2)
+        target = CCD(data[13], "NA", 30)
+        avper = CCD(data[14], "UA", 1)
+        avrte = CCD(data[15], "UD", 5.2)
+        adhoc = CCD(data[16], "UD", 9.2)
+        swell = CCD(data[17], "UD", 5.2)
+        start = CCD(data[18], "d2", 7)
+        end = CCD(data[19], "d2", 7)
+        return (acno, name, terms, termsb, stday, dbase, pydis, avdis, icdis,
+            icfrom, icto, rbper, rbrte, target, avper, avrte, adhoc, swell,
+            start, end)
 
     def pageHeading(self):
         self.fpdf.add_page()
@@ -182,17 +185,17 @@
         self.pgnum += 1
         self.fpdf.drawText(self.head)
         self.fpdf.drawText()
-        self.fpdf.drawText("%-36s %-10s %100s %5s" % ("Creditors Ledger "\
+        self.fpdf.drawText("%-36s %-10s %104s %5s" % ("Creditors Ledger "\
             "Terms Listing as at", self.sysdtd, "Page", self.pgnum))
         self.fpdf.drawText()
         self.fpdf.drawText("%-15s%-1s%-1s" % ("(Options: Sort-",
             self.df.t_disp[0][0][0], ")"))
         self.fpdf.drawText()
-        self.fpdf.drawText("%-7s %-30s %-3s %-1s %-2s %-5s %-5s %-5s %-5s "\
-            "%-5s %-1s %-5s %-30s %-1s %-5s %-9s %-5s %-7s %-7s" % ("Acc-Num",
-            "Name", "Trm", "B", "Dy", "Set-%", "Adv_%", "Inc-%", "I-Frm",
-            "I-To", "R", "Rbt-%", "Targeted", "P", "Adv-R", "ADHOC-Amt",
-            "SWL-%", "Start-P", "End-Per"))
+        self.fpdf.drawText("%-7s %-30s %-3s %-1s %-2s %1s %-5s %-5s %-5s "\
+            "%-5s %-5s %-1s %-5s %-30s %-1s %-5s %-9s %-5s %-7s %-7s" %
+            ("Acc-Num", "Name", "Trm", "B", "Dy", "D", "Set-%", "Adv_%",
+            "Inc-%", "I-Frm", "I-To", "R", "Rbt-%", "Targeted", "P", "Adv-R",
+            "ADHOC-Amt", "SWL-%", "Start-P", "End-Per"))
         self.fpdf.underLine(txt=self.head)
         self.fpdf.setFont()
         self.pglin = 8

=== modified file 'crs/cr3320_rne.py'
--- crs/cr3320_rne.py	2015-10-03 07:36:56 +0000
+++ crs/cr3320_rne.py	2015-12-10 14:23:32 +0000
@@ -17,7 +17,6 @@
 from TartanClasses import ASD, CCD, MyFpdf, ProgressBar, SplashScreen, Sql
 from TartanClasses import TartanDialog
 from tartanFunctions import doPrinter, getModName, getSingleRecords, showError
-from tartanFunctions import showInfo
 from tartanWork import crtrtp
 
 class cr3320:
@@ -42,6 +41,7 @@
         self.totvat = 0
         self.totnet = 0
         self.totdis = 0
+        self.deptot = {}
         self.pgnum = 0
         self.pglin = 999
         self.head = ("%03u %-30s %87s %10s" % \
@@ -59,18 +59,21 @@
                 ("ctm_cono", "", 0, "Bch"),
                 ("ctm_name", "", 0, "Name", "Y"))}
         r1s = (("Yes", "Y"), ("No", "N"))
+        r2s = (("All", "A"), ("Select", "S"))
         fld = (
             (("T",0,0,0),("IRB",r1s),0,"Reprints","",
                 "N","N",self.doReprint,None,None,None),
-            (("T",0,1,0),("IRB",r1s),0,"Preview Only","",
+            (("T",0,1,0),("IRB",r2s),0,"Batches","",
+                "A","N",self.doBatches,None,None,None),
+            (("T",0,2,0),("IRB",r1s),0,"Preview Only","",
                 "Y","N",self.doPreview,None,None,None),
-            (("T",0,2,0),"IUI",3,"Branch Code","",
+            (("T",0,3,0),"IUI",3,"Branch Code","",
                 "","N",self.doBranch,bch,None,("efld",)),
-            (("T",0,3,0),"IUI",4,"Start Number","",
+            (("T",0,4,0),"IUI",4,"Start Number","",
                 "","N",self.doStartN,None,None,("efld",)),
-            (("T",0,4,0),"IUI",4,"End Number","",
+            (("T",0,5,0),"IUI",4,"End Number","",
                 "","N",self.doEndN,None,None,("efld",)),
-            (("T",0,5,0),"ID1",10,"Start Date","",
+            (("T",0,6,0),"ID1",10,"Start Date","",
                 self.sysdtw,"N",self.doStartD,None,None,("efld",)),
             (("T",0,6,0),"ID1",10,"End Date","",
                 self.sysdtw,"N",self.doEndD,None,None,("efld",)))
@@ -94,6 +97,25 @@
                 self.branch.append(b[0])
             return "sk2"
 
+    def doBatches(self, frt, pag, r, c, p, i, w):
+        if w == "A":
+            self.batches = []
+        else:
+            recs = self.sql.getRec(tables=["crsrtf", "crstrn"],
+                cols=["crt_batch"], where=[("rtf_cono", "=",
+                self.opts["conum"]), ("rtf_type", "<>", 5),
+                ("rtf_depno", "<>", 0), ("rtf_pjno", "=", 0),
+                ("crt_cono=rtf_cono",), ("crt_acno=rtf_acno",),
+                ("crt_type=rtf_type",), ("crt_ref1=rtf_ref1",)],
+                group="crt_batch", order="crt_batch")
+            bats = getSingleRecords(self.opts["mf"], "ctlbat",
+                ("btm_batno",), where=recs, ttype="D")
+            self.batches = []
+            for bat in bats:
+                self.batches.append(bat[0])
+            if not self.batches:
+                return "No Batches Selected"
+
     def doPreview(self, frt, pag, r, c, p, i, w):
         self.preview = w
         self.branch = [0]
@@ -131,15 +153,18 @@
         self.df.closeProcess()
         col = ["rtf_depno", "rtf_acno", "rtf_ref1", "rtf_type", "rtf_pjno",
             "rtf_prtdte"]
-        whr = [("rtf_cono", "=", self.opts["conum"]), ("rtf_type", "<>", 5)]
-        odr = "rtf_depno, rtf_pjno, crt_seq"
+        whr = [("rtf_cono", "=", self.opts["conum"])]
+        whr.append(("rtf_type", "<>", 5))
         if self.reprint == "N":
             whr.extend([("rtf_depno", "<>", 0), ("rtf_pjno", "=", 0)])
+            if self.batches:
+                whr.append(("crt_batch", "in", self.batches))
         else:
             if self.startn:
                 whr.append(("rtf_pjno", "between", self.startn, self.endn))
             if self.startd:
                 whr.append(("rtf_prtdte", "between", self.startd, self.endd))
+        odr = "rtf_depno, rtf_pjno, crt_seq"
         for branch in self.branch:
             sp = SplashScreen(self.opts["mf"].body,
                 "Generating Report for Branch %s\n\nPlease Wait..." % branch)
@@ -159,28 +184,57 @@
                         "No Transactions Selected")
             else:
                 self.printReport(recs)
-        pdfnam = getModName(self.opts["mf"].rcdic["wrkdir"], __name__,
-            self.opts["conum"], ext="pdf")
-        self.fpdf.output(pdfnam, "F")
-        doPrinter(mf=self.opts["mf"], conum=self.opts["conum"],
-            pdfnam=pdfnam, head=self.tit, repprt=self.df.repprt,
-            repeml=self.df.repeml)
-        if self.preview == "N":
-            self.opts["mf"].dbm.commitDbase(ask=True)
-            if self.opts["mf"].dbm.commit == "no":
-                showInfo(self.opts["mf"].body, "Not Saved",
-                    "These Purchase Journals Have NOT Been Saved!")
+        if self.reprint == "N" and self.preview == "N":
+            self.opts["mf"].dbm.commitDbase()
+        if self.fpdf.page:
+            keys = self.deptot.keys()
+            keys.sort()
+            self.pglin = 99
+            tots = [0, 0, 0, 0]
+            for key in keys:
+                if self.pglin > self.fpdf.lpp:
+                    self.doTotHead()
+                a = self.deptot[key][0]
+                b = CCD(self.deptot[key][1], "SD", 13.2)
+                c = CCD(self.deptot[key][2], "SD", 13.2)
+                d = CCD(self.deptot[key][3], "SD", 13.2)
+                e = CCD(self.deptot[key][4], "SD", 13.2)
+                self.fpdf.drawText("Totals for Branch %3s %-30s %s %s %s %s" %
+                    (key, a, b.disp, c.disp, d.disp, e.disp))
+                tots[0] = float(ASD(tots[0]) + ASD(b.work))
+                tots[1] = float(ASD(tots[1]) + ASD(c.work))
+                tots[2] = float(ASD(tots[2]) + ASD(d.work))
+                tots[3] = float(ASD(tots[3]) + ASD(e.work))
+                self.pglin += 1
+            a = CCD(tots[0], "SD", 13.2).disp
+            b = CCD(tots[1], "SD", 13.2).disp
+            c = CCD(tots[2], "SD", 13.2).disp
+            d = CCD(tots[3], "SD", 13.2).disp
+            txt = "%-52s %s %s %s %s" % ("Grand Totals", a, b, c, d)
+            self.fpdf.underLine(txt=txt)
+            self.fpdf.drawText(txt)
+            pdfnam = getModName(self.opts["mf"].rcdic["wrkdir"], __name__,
+                self.opts["conum"], ext="pdf")
+            self.fpdf.output(pdfnam, "F")
+            doPrinter(mf=self.opts["mf"], conum=self.opts["conum"],
+                pdfnam=pdfnam, head=self.tit, repprt=self.df.repprt,
+                repeml=self.df.repeml)
         self.opts["mf"].closeLoop()
 
+    def doTotHead(self):
+        self.fpdf.add_page()
+        self.fpdf.setFont(style="B")
+        self.pgnum += 1
+        txt = "%-52s %13s %13s %13s %13s" % ("Summary of Branch Totals",
+            "Exc-Amount ", "V.A.T. ", "Tot-Amount ", "Dis-Amount ")
+        self.fpdf.drawText(txt)
+        self.fpdf.underLine(txt=txt)
+        self.pglin = 2
+
     def printReport(self, recs):
-        if self.preview == "N":
-            p = ProgressBar(self.opts["mf"].body, mxs=len(recs))
-        else:
-            p = ProgressBar(self.opts["mf"].body, mxs=len(recs), esc=True)
+        p = ProgressBar(self.opts["mf"].body, mxs=len(recs))
         for num, dat in enumerate(recs):
             p.displayProgress(num)
-            if self.preview == "Y" and p.quit:
-                break
             depno = CCD(dat[0], "UI", 3)
             acno = CCD(dat[1], "NA", 7)
             ref1 = CCD(dat[2], "Na", 9)
@@ -189,8 +243,8 @@
             self.pjnum = CCD(dat[4], "UI", 5)
             self.pjdat = CCD(dat[5], "d1", 10)
             acc = self.sql.getRec(tables="crsmst", cols=["crm_name"],
-                where=[("crm_cono", "=", self.opts["conum"]), ("crm_acno", "=",
-                acno.work)], limit=1)
+                where=[("crm_cono", "=", self.opts["conum"]),
+                ("crm_acno", "=", acno.work)], limit=1)
             if acc:
                 name = CCD(acc[0], "NA", 30)
             else:
@@ -207,8 +261,8 @@
             taxamt = CCD(acc[2], "SD", 13.2)
             disper = CCD(acc[3], "SD", 6.2)
             if disper.work:
-                disamt = CCD(round((tramt.work * disper.work / 100), 2),
-                    "SD", 13.2)
+                disamt = CCD(
+                    round((tramt.work * disper.work / 100), 2), "SD", 13.2)
             else:
                 disamt = CCD(0, "SD", 13.2)
             acc = self.sql.getRec(tables="crsrmf", cols=["rmf_icdis",
@@ -235,23 +289,23 @@
                 if self.reprint == "N":
                     self.branchTotal(fullpg=True)
                 self.pageHeading()
-            self.fpdf.drawText("%7s %30s %9s %3s %10s %13s %13s %13s %13s "\
-                "%6s %6s" % (acno.disp, name.disp, ref1.disp, trtp,
-                trdt.disp, net.disp, taxamt.disp, tramt.disp, disamt.disp,
-                incper.disp, advper.disp))
             if self.preview == "N":
                 self.sql.updRec("crsrtf", cols=["rtf_pjno", "rtf_prtdte"],
                     data=[self.pjno, self.sysdtw], where=[("rtf_cono", "=",
                     self.opts["conum"]), ("rtf_acno", "=", acno.work),
                     ("rtf_type", "=", rtyp.work), ("rtf_ref1", "=",
                     ref1.work)])
-            self.pglin += 1
             self.totamt = float(ASD(self.totamt) + ASD(net.work))
             self.totvat = float(ASD(self.totvat) + ASD(taxamt.work))
             self.totnet = float(ASD(self.totnet) + ASD(tramt.work))
             self.totdis = float(ASD(self.totdis) + ASD(disamt.work))
+            self.fpdf.drawText("%7s %30s %9s %3s %10s %13s %13s %13s %13s "\
+                "%6s %6s" % (acno.disp, name.disp, ref1.disp, trtp,
+                trdt.disp, net.disp, taxamt.disp, tramt.disp, disamt.disp,
+                incper.disp, advper.disp))
+            self.pglin += 1
         p.closeProgress()
-        if self.fpdf.page and not p.quit:
+        if self.fpdf.page:
             self.branchTotal()
 
     def pageHeading(self):
@@ -293,6 +347,16 @@
         totvat = CCD(self.totvat, "SD", 13.2)
         totnet = CCD(self.totnet, "SD", 13.2)
         totdis = CCD(self.totdis, "SD", 13.2)
+        if not self.depno in self.deptot:
+            self.deptot[self.depno] = [self.bname, 0, 0, 0, 0]
+        self.deptot[self.depno][1] = float(
+            ASD(self.deptot[self.depno][1]) + ASD(totamt.work))
+        self.deptot[self.depno][2] = float(
+            ASD(self.deptot[self.depno][2]) + ASD(totvat.work))
+        self.deptot[self.depno][3] = float(
+            ASD(self.deptot[self.depno][3]) + ASD(totnet.work))
+        self.deptot[self.depno][4] = float(
+            ASD(self.deptot[self.depno][4]) + ASD(totdis.work))
         self.fpdf.drawText(self.fpdf.suc * len(self.head))
         self.fpdf.drawText("%7s %-55s %13s %13s %13s %13s" % ("", "Totals",
             totamt.disp, totvat.disp, totnet.disp, totdis.disp))

=== modified file 'crs/cr3360_rne.py'
--- crs/cr3360_rne.py	2015-10-03 07:36:56 +0000
+++ crs/cr3360_rne.py	2015-12-01 16:03:36 +0000
@@ -46,24 +46,6 @@
         self.trtypes.append("Dsc")
         return True
 
-    def buildHead(self):
-        self.head = []
-        ctl = self.sql.getRec(tables="ctlmst", cols=["ctm_name", "ctm_add1",
-            "ctm_add2", "ctm_add3", "ctm_pcode", "ctm_regno", "ctm_taxno",
-            "ctm_tel", "ctm_fax"], where=[("ctm_cono", "=",
-            self.opts["conum"])],
-            limit=1)
-        mess = "%1s%-30s%2s%10s" % ("", ctl[0], "", "REMITTANCE")
-        self.head.append(mess)
-        mess = "%2s%-30s%2s%-30s" % ("", ctl[1], "", ("RegNo: " + ctl[5]))
-        self.head.append(mess)
-        mess = "%2s%-30s%2s%-30s" % ("", ctl[2], "", ("TaxNo: " + ctl[6]))
-        self.head.append(mess)
-        mess = "%2s%-30s%2s%-30s" % ("", ctl[3], "", ("TelNo: " + ctl[7]))
-        self.head.append(mess)
-        mess = "%2s%-30s%2s%-30s" % ("", ctl[4], "", ("FaxNo: " + ctl[8]))
-        self.head.append(mess)
-
     def mainProcess(self):
         self.tit = ("%03i %s" % (self.opts["conum"], self.opts["conam"]),
             "Creditors Remittance Advices (%s)" % __name__)
@@ -102,7 +84,7 @@
         tnd = ((self.doEnd,"Y"), )
         txt = (self.doExit, )
         self.df = TartanDialog(self.opts["mf"], title=self.tit, eflds=fld,
-            tend=tnd, txit=txt, view=("N","V"), mail=("N","Y"))
+            tend=tnd, txit=txt, view=("N","V"), mail=("B","Y"))
 
     def doTplNam(self, frt, pag, r, c, p, i, w):
         acc = self.sql.getRec(tables="tplmst", where=[("tpm_tname", "=", w),
@@ -127,6 +109,7 @@
             self.enum = w
 
     def doEnd(self):
+        self.emadd = self.df.repeml[2]
         recs = self.sql.getRec(tables="crstrn", cols=["crt_acno", "crt_ref1",
             "crt_trdt"], where=[("crt_cono", "=", self.opts["conum"]),
             ("crt_type", "=", 5), ("crt_ref1", "between", self.snum,
@@ -145,7 +128,8 @@
                 self.doProcess(rec)
             p.closeProgress()
             self.df.setWidget(self.df.mstFrame, state="show")
-            if self.df.repeml[1] == "N":
+            if self.df.repeml[1] == "N" or self.emadd:
+                self.df.repeml[2] = self.emadd
                 self.doPrint()
         self.df.focusField("T", 0, 1)
 
@@ -206,7 +190,7 @@
         self.doBody()
         self.doTotal()
         self.doTail()
-        if self.df.repeml[1] == "Y":
+        if self.df.repeml[1] == "Y" and not self.emadd:
             self.df.repeml[2] = emlto
             self.doPrint()
 

=== modified file 'crs/cr6010.py'
--- crs/cr6010.py	2014-12-30 15:37:38 +0000
+++ crs/cr6010.py	2015-10-26 06:29:37 +0000
@@ -2,7 +2,7 @@
 
 """
 SYNOPSIS
-    Creditor's Ledger Key Change.
+    Creditor's Ledger Account Code Change.
 
     This file is part of Tartan Systems (TARTAN).
 
@@ -57,7 +57,7 @@
                 ("crm_name", "", 0, "Name", "Y")),
             "where": [("crm_cono", "=", self.opts["conum"])]}
         fld = [
-            (["T",0,0,0],"I@crm_acno",0,"Old Account","Old Account Number",
+            (["T",0,0,0],"IRW",7,"Old Account","Old Account Number",
                 "","Y",self.doOldAcc,crm,None,("notblank",)),
             (["T",0,0,18],"O@crm_name",0,""),
             (["T",0,1,0],"I@crm_acno",0,"New Account","New Account Number",

=== added file 'csv/bwlpts_fld.csv'
--- csv/bwlpts_fld.csv	1970-01-01 00:00:00 +0000
+++ csv/bwlpts_fld.csv	2015-12-03 10:27:22 +0000
@@ -0,0 +1,12 @@
+0,"bcp_cono","UI","3.0","Company Number","Coy"
+1,"bcp_code","UI","2.0","Type Code","CD"
+2,"bcp_ptyp","UA","1.0","Game Type (D/S)","T"
+3,"bcp_skins","UA","1.0","Skins (Y/N)","S"
+4,"bcp_sends","UI","2.0","Number of Ends per Skin","ES"
+5,"bcp_p_only","UA","1.0","Points Only (Y/N)","P"
+6,"bcp_e_points","UI","2.0","Points per End","PE"
+7,"bcp_s_points","UI","2.0","Points per Skin","PS"
+8,"bcp_g_points","UI","2.0","Points per Game","PG"
+9,"bcp_bonus","UA","1.0","Bonus Points (Y/N)","B"
+10,"bcp_win_by","UI","2.0","Win By More Than","WB"
+11,"bcp_lose_by","UI","2.0","Lose by Less Than","LB"

=== added file 'csv/bwlpts_idx.csv'
--- csv/bwlpts_idx.csv	1970-01-01 00:00:00 +0000
+++ csv/bwlpts_idx.csv	2015-12-03 10:27:22 +0000
@@ -0,0 +1,1 @@
+"Types of Points",1,"U","bcp_cono","bcp_code","bcp_ptyp"

=== modified file 'csv/bwlsys.py'
--- csv/bwlsys.py	2015-08-25 15:02:35 +0000
+++ csv/bwlsys.py	2015-12-03 10:32:50 +0000
@@ -2,7 +2,7 @@
     # Bowls
     "bwlclb", "bwlcmp", "bwlctl", "bwldrm", "bwldrt", "bwlent", "bwlflf",
         "bwlflm", "bwlflo", "bwlfls", "bwlflt", "bwlgme", "bwlrnd", "bwltab",
-        "bwltyp",
+        "bwltyp", "bwlpts",
     # Controls
     "ctllog", "ctlmst", "ctlnot", "ctlpwm", "ctlpwr", "ctlpwu", "ctlsys",
     # Reports

=== modified file 'csv/bwltyp_fld.csv'
--- csv/bwltyp_fld.csv	2014-03-28 07:32:49 +0000
+++ csv/bwltyp_fld.csv	2015-12-03 10:31:55 +0000
@@ -12,12 +12,4 @@
 11,"bct_percent","UI","3.0","Retain Percentage","RP"
 12,"bct_drawn","UI","2.0","Number of Drawn Games","DG"
 13,"bct_strict","UA","1.0","Strict S v S ","V"
-14,"bct_skins","UA","1.0","Skins (Y/N)","S"
-15,"bct_sends","UI","2.0","Number of Ends per Skin","ES"
-16,"bct_p_only","UA","1.0","Points Only (Y/N)","P"
-17,"bct_e_points","UI","2.0","Points per End","PE"
-18,"bct_s_points","UI","2.0","Points per Skin","PS"
-19,"bct_g_points","UI","2.0","Points per Game","PG"
-20,"bct_bonus","UA","1.0","Bonus Points (Y/N)","B"
-21,"bct_win_by","UI","2.0","Win By More Than","WB"
-22,"bct_lose_by","UI","2.0","Lose by Less Than","LB"
+14,"bct_pdiff","UA","1.0","Drawn Games Differ","D"

=== modified file 'csv/crsrmf_fld.csv'
--- csv/crsrmf_fld.csv	2015-05-20 16:03:01 +0000
+++ csv/crsrmf_fld.csv	2015-12-02 07:25:10 +0000
@@ -1,16 +1,17 @@
 0,"rmf_cono","UI","3.0","Company Number","Coy"
 1,"rmf_acno","NA","7.0","Account Number","Acc-Num"
-2,"rmf_avdis","UD","5.2","Advertising Discount","A-Dis"
-3,"rmf_icdis","UD","5.2","Incentive Discount","I-Dis"
-4,"rmf_icfrom","UD","5.2","I-Range From","I-Frm"
-5,"rmf_icto","UD","5.2","I-Range To","I-To"
-6,"rmf_rbper","UA","1.0","Rebate Period","R"
-7,"rmf_rbrte","UD","5.2","Rebate Rate","R-Rte"
-8,"rmf_target","NA","30.0","Targeted","Targeted"
-9,"rmf_avper","UA","1.0","Advert Period","A"
-10,"rmf_avrte","UD","5.2","Advert Rate","A-Rte"
-11,"rmf_adhoc","UD","9.2","ADHOC Amount","ADHOC"
-12,"rmf_swell","UD","5.2","SWELL Rate","SWELL"
-13,"rmf_start","d2","7.0","Period Start","P-Start"
-14,"rmf_end","d2","7.0","Period End","P-Finis"
-15,"rmf_eftref","NA","10.0","EFT Reference End","EFT-RefNum"
+2,"rmf_dbase","UA","1.0","Discount Base","B"
+3,"rmf_avdis","UD","5.2","Advertising Discount","A-Dis"
+4,"rmf_icdis","UD","5.2","Incentive Discount","I-Dis"
+5,"rmf_icfrom","UD","5.2","I-Range From","I-Frm"
+6,"rmf_icto","UD","5.2","I-Range To","I-To"
+7,"rmf_rbper","UA","1.0","Rebate Period","R"
+8,"rmf_rbrte","UD","5.2","Rebate Rate","R-Rte"
+9,"rmf_target","NA","30.0","Targeted","Targeted"
+10,"rmf_avper","UA","1.0","Advert Period","A"
+11,"rmf_avrte","UD","5.2","Advert Rate","A-Rte"
+12,"rmf_adhoc","UD","9.2","ADHOC Amount","ADHOC"
+13,"rmf_swell","UD","5.2","SWELL Rate","SWELL"
+14,"rmf_start","d2","7.0","Period Start","P-Start"
+15,"rmf_end","d2","7.0","Period End","P-Finis"
+16,"rmf_eftref","NA","10.0","EFT Reference","EFT-RefNum"

=== modified file 'csv/lonctl_fld.csv'
--- csv/lonctl_fld.csv	2015-10-03 07:36:56 +0000
+++ csv/lonctl_fld.csv	2015-11-28 15:02:28 +0000
@@ -6,3 +6,4 @@
 5,"cln_drte","UD","6.2","Debit Rate","DRte-%"
 6,"cln_crte","UD","6.2","Credit Rate","CRte-%"
 7,"cln_last","D1","10.0","Last Interest Date","Last-IntDt"
+8,"cln_tplnam","NA","20.0","Statement Template","Template-Name"

=== modified file 'csv/rnesys.py'
--- csv/rnesys.py	2015-10-25 09:33:02 +0000
+++ csv/rnesys.py	2015-12-03 10:27:34 +0000
@@ -14,6 +14,8 @@
     # General Ledger
     "genbal", "genbud", "gendtm", "gendtt", "genint", "genjlm", "genjlt",
     "genmst", "genrcc", "genrct", "genrpc", "genrpt", "genstr", "gentrn",
+    # Loans
+    "lonctl", "lonmf1", "lonmf2", "lonrte", "lontrn",
     # Rental
     "rtlcon", "rtlctl", "rtlmst", "rtlprm", "rtltrn",
     # Reports

=== modified file 'csv/stdsys.py'
--- csv/stdsys.py	2015-10-25 09:33:02 +0000
+++ csv/stdsys.py	2015-12-03 10:33:01 +0000
@@ -7,7 +7,7 @@
     # Bowls
     "bwlclb", "bwlcmp", "bwlctl", "bwldrm", "bwldrt", "bwlent", "bwlflf",
     "bwlflm", "bwlflo", "bwlfls", "bwlflt", "bwlgme", "bwlrnd", "bwltab",
-    "bwltyp",
+    "bwltyp", "bwlpts",
     # Controls
     "ctlbat", "ctlctl", "ctldep", "ctllog", "ctlmes", "ctlmst", "ctlnot",
     "ctlpwm", "ctlpwr", "ctlpwu", "ctlrep", "ctlsys", "ctlvmf", "ctlvrf",

=== modified file 'csv/tpldet.dat'
--- csv/tpldet.dat	2015-10-03 07:36:56 +0000
+++ csv/tpldet.dat	2015-12-01 08:19:26 +0000
@@ -70,7 +70,7 @@
 booking_statement|9.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_pcode|courier|10|#000000|Y|N|N|L||N|15.0|4|23.0|33.0|37.0|1|1
 booking_statement|10.0|C|A|L|FaxNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|33.0|37.0|0.0|ctm_fax|courier|10|#000000|Y|N|N|L||N|100.0|15|132.0|33.0|37.0|1|1
 booking_statement|11.0|T|A||STATEMENT|courier|14|#000000|Y|N|N|R|TLRB|N|148.0|9|178.0|15.0|20.0|0.0|||0||||||||0.0|0|0.0|0.0|0.0|0|0
-booking_statement|12.0|C|A|H|Contact:|courier|10|#000000|Y|N|N|L|TLRB|Y|15.0|30|81.0|45.0|50.0|0.0|contact_details|courier|10|#000000|N|N|N|L|TLRB|N|15.0|30|81.0|50.0|54.0|5|1
+booking_statement|12.0|C|A|H|Contact:|courier|10|#000000|Y|N|N|L|TLRB|Y|15.0|40|102.0|45.0|50.0|0.0|contact_details|courier|10|#000000|N|N|N|L|TLRB|N|15.0|40|102.0|50.0|54.0|6|1
 booking_statement|13.0|C|A|H|Booking|courier|10|#000000|Y|N|N|C|TLRB|Y|148.0|13|178.0|65.0|70.0|0.0|bkm_number|courier|10|#000000|N|N|N|C|TLRB|N|148.0|13|178.0|70.0|74.0|1|1
 booking_statement|14.0|C|A|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|148.0|13|178.0|74.0|79.0|0.0|document_date|courier|10|#000000|N|N|N|C|TLRB|N|148.0|13|178.0|79.0|83.0|1|1
 booking_statement|15.0|C|B|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|15.0|10|38.0|85.0|90.0|0.0|bkt_date|courier|10|#000000|N|N|N|C|LR|N|15.0|10|38.0|90.0|94.0|1|38
@@ -241,33 +241,35 @@
 sales_document|41.0|C|D|L|Code:|courier|10|Y|N|N|L|L|N|111.0|8|130.0|176.0|180.0|0.0|ctm_b_ibt|courier|10|N|N|N|L|R|N|130.0|30|196.0|176.0|180.0|1|1
 sales_document|42.0|C|D|L|Account:|courier|10|Y|N|N|L|LB|N|111.0|8|130.0|180.0|184.0|0.0|ctm_b_acno|courier|10|N|N|N|L|RB|N|130.0|30|196.0|180.0|184.0|1|1
 sales_document|43.0|C|D|H|Terms and Conditions:|courier|10|Y|N|N|L|TLRB|Y|212.0|30|278.0|163.0|168.0|0.0|terms|courier|10|N|N|N|L|LRB|N|212.0|30|278.0|168.0|172.0|5|1
-statement_loan|1.0|I|A||||0|#000000|||||||15.0|0|130.0|15.0|35.0|0.0|ctm_logo||0|#000000|||||||0.0|0|0.0|0.0|0.0|0|0
-statement_loan|2.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_name|courier|18|#000000|Y|N|N|L||N|15.0|30|129.0|15.0|20.0|1|1
-statement_loan|3.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add1|courier|10|#000000|Y|N|N|L||N|15.0|30|78.0|21.0|25.0|1|1
+statement_loan|1.0|I|A||||0|#000000|||||||10.0|0|130.0|15.0|35.0|0.0|ctm_logo||0|#000000|||||||0.0|0|0.0|0.0|0.0|0|0
+statement_loan|2.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_name|courier|18|#000000|Y|N|N|L||N|10.0|30|129.0|15.0|20.0|1|1
+statement_loan|3.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add1|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|21.0|25.0|1|1
 statement_loan|4.0|C|A|L|RegNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|21.0|25.0|0.0|ctm_regno|courier|10|#000000|Y|N|N|L||N|100.0|20|142.0|21.0|25.0|1|1
-statement_loan|5.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add2|courier|10|#000000|Y|N|N|L||N|15.0|30|78.0|25.0|28.0|1|1
+statement_loan|5.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add2|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|25.0|28.0|1|1
 statement_loan|6.0|C|A|L|TaxNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|25.0|29.0|0.0|ctm_taxno|courier|10|#000000|Y|N|N|L||N|100.0|20|142.0|25.0|29.0|1|1
-statement_loan|7.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add3|courier|10|#000000|Y|N|N|L||N|15.0|30|78.0|29.0|33.0|1|1
-statement_loan|8.0|C|A|L|TelNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|29.0|33.0|0.0|ctm_tel|courier|10|#000000|Y|N|N|L||N|100.0|15|132.0|29.0|33.0|1|1
-statement_loan|9.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_pcode|courier|10|#000000|Y|N|N|L||N|15.0|4|23.0|33.0|37.0|1|1
-statement_loan|10.0|C|A|L|FaxNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|33.0|37.0|0.0|ctm_fax|courier|10|#000000|Y|N|N|L||N|100.0|15|132.0|33.0|37.0|1|1
-statement_loan|11.0|T|A||STATEMENT & INVOICE|courier|14|#000000|Y|N|N|R|TLRB|N|148.0|9|178.0|15.0|20.0|0.0|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0|0
-statement_loan|12.0|C|A|H|Account:|courier|10|#000000|Y|N|N|L|TLRB|Y|15.0|30|81.0|45.0|50.0|0.0|account_details|courier|10|#000000|N|N|N|L|TLRB|N|15.0|30|81.0|50.0|54.0|5|1
-statement_loan|13.0|C|A|H|Acc-Num|courier|10|#000000|Y|N|N|C|TLRB|Y|148.0|13|178.0|47.0|52.0|0.0|lm1_acno|courier|10|#000000|N|N|N|C|TLRB|N|148.0|13|178.0|52.0|56.0|1|1
-statement_loan|14.0|C|A|H|Loan|courier|10|#000000|Y|N|N|C|TLRB|Y|148.0|13|178.0|56.0|61.0|0.0|lm2_loan|courier|10|#000000|N|N|N|C|TLRB|N|148.0|13|178.0|61.0|65.0|1|1
-statement_loan|15.0|C|A|H|Page|courier|10|#000000|Y|N|N|C|TLRB|Y|148.0|13|178.0|65.0|70.0|0.0|page_number|courier|10|#000000|N|N|N|C|TLRB|N|148.0|13|178.0|70.0|74.0|1|1
-statement_loan|16.0|C|A|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|148.0|13|178.0|74.0|79.0|0.0|document_date|courier|10|#000000|N|N|N|C|TLRB|N|148.0|13|178.0|79.0|83.0|1|1
-statement_loan|17.0|C|B|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|15.0|10|38.0|85.0|90.0|0.0|lnt_trdt|courier|10|#000000|N|N|N|C|LR|N|15.0|10|38.0|90.0|94.0|1|38
-statement_loan|18.0|C|B|H|Reference|courier|10|#000000|Y|N|N|C|TLRB|Y|38.0|9|59.0|85.0|90.0|0.0|lnt_refno|courier|10|#000000|N|N|N|L|R|N|38.0|9|59.0|90.0|94.0|1|38
-statement_loan|19.0|C|B|H|Typ|courier|10|#000000|Y|N|N|C|TLRB|Y|59.0|3|67.0|85.0|90.0|0.0|type_code|courier|10|#000000|N|N|N|C|R|N|59.0|3|67.0|90.0|94.0|1|38
-statement_loan|20.0|C|B|H|Details|courier|10|#000000|Y|N|N|C|TLRB|Y|67.0|30|148.0|85.0|90.0|0.0|lnt_desc|courier|10|#000000|N|N|N|L|R|N|67.0|30|148.0|90.0|94.0|1|38
-statement_loan|21.0|C|B|H|Amount|courier|10|#000000|Y|N|N|R|TLRB|Y|148.0|13|178.0|85.0|90.0|0.0|lnt_tramt|courier|10|#000000|N|N|N|R|R|N|148.0|13|178.0|90.0|94.0|1|38
-statement_loan|22.0|C|C|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|carried_forward|courier|10|#000000|Y|N|N|R|LRB|N|129.0|22|178.0|244.0|249.0|1|1
-statement_loan|23.0|C|C|H|Balance|courier|10|#000000|Y|N|N|R|TLRB|Y|148.0|13|178.0|244.0|249.0|0.0|total_balance|courier|10|#000000|Y|N|N|R|TLRB|N|148.0|13|178.0|249.0|253.0|1|1
-statement_loan|24.0|T|D||Banking Details:|courier|10|#000000|Y|N|N|L|TLRB|Y|15.0|30|178.0|255.0|260.0|0.0|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0|0
-statement_loan|25.0|C|D|L|Bank:|courier|10|#000000|Y|N|N|L|LB|N|15.0|5|28.0|260.0|264.0|0.0|ctm_b_name|courier|10|#000000|N|N|N|L|B|N|28.0|27|87.0|260.0|264.0|1|1
-statement_loan|26.0|C|D|L|Branch:|courier|10|#000000|Y|N|N|L|B|N|87.0|7|104.0|260.0|264.0|0.0|ctm_b_ibt|courier|10|#000000|N|N|N|L|B|N|104.0|8|123.0|260.0|264.0|1|1
-statement_loan|27.0|C|D|L|Account:|courier|10|#000000|Y|N|N|L|B|N|123.0|8|142.0|260.0|264.0|0.0|ctm_b_acno|courier|10|#000000|N|N|N|L|RB|N|142.0|16|178.0|260.0|264.0|1|1
+statement_loan|7.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add3|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|29.0|33.0|1|1
+statement_loan|8.0|C|A|L|TelNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|29.0|33.0|0.0|ctm_tel|courier|10|#000000|Y|N|N|L||N|100.0|10|132.0|29.0|33.0|1|1
+statement_loan|9.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_pcode|courier|10|#000000|Y|N|N|L||N|10.0|4|23.0|33.0|37.0|1|1
+statement_loan|10.0|C|A|L|FaxNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|33.0|37.0|0.0|ctm_fax|courier|10|#000000|Y|N|N|L||N|100.0|10|132.0|33.0|37.0|1|1
+statement_loan|11.0|T|A||STATEMENT & INVOICE|courier|14|#000000|Y|N|N|R|TLRB|N|173.0|9|203.0|10.0|20.0|0.0|||0||||||||0.0|0|0.0|0.0|0.0|0|0
+statement_loan|12.0|C|A|H|Account:|courier|10|#000000|Y|N|N|L|TLRB|Y|10.0|30|76.0|45.0|50.0|0.0|account_details|courier|10|#000000|N|N|N|L|TLRB|N|10.0|30|76.0|50.0|54.0|5|1
+statement_loan|13.0|C|A|H|Acc-Num|courier|10|#000000|Y|N|N|C|TLRB|Y|178.0|11|203.0|47.0|52.0|0.0|lm1_acno|courier|10|#000000|N|N|N|C|TLRB|N|178.0|11|203.0|52.0|56.0|1|1
+statement_loan|14.0|C|A|H|Loan|courier|10|#000000|Y|N|N|C|TLRB|Y|178.0|11|203.0|56.0|61.0|0.0|lm2_loan|courier|10|#000000|N|N|N|C|TLRB|N|178.0|11|203.0|61.0|65.0|1|1
+statement_loan|15.0|C|A|H|Page|courier|10|#000000|Y|N|N|C|TLRB|Y|178.0|11|203.0|65.0|70.0|0.0|page_number|courier|10|#000000|N|N|N|C|TLRB|N|178.0|11|203.0|70.0|74.0|1|1
+statement_loan|16.0|C|A|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|178.0|11|203.0|74.0|79.0|0.0|document_date|courier|10|#000000|N|N|N|C|TLRB|N|178.0|11|203.0|79.0|83.0|1|1
+statement_loan|17.0|C|B|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|10.0|10|33.0|85.0|90.0|0.0|lnt_trdt|courier|10|#000000|N|N|N|C|LR|N|10.0|10|33.0|90.0|94.0|1|38
+statement_loan|18.0|C|B|H|Reference|courier|10|#000000|Y|N|N|C|TLRB|Y|33.0|9|54.0|85.0|90.0|0.0|lnt_refno|courier|10|#000000|N|N|N|L|R|N|33.0|9|54.0|90.0|94.0|1|38
+statement_loan|19.0|C|B|H|Typ|courier|10|#000000|Y|N|N|C|TLRB|Y|54.0|3|62.0|85.0|90.0|0.0|type_code|courier|10|#000000|N|N|N|C|R|N|54.0|3|62.0|90.0|94.0|1|38
+statement_loan|20.0|C|B|H|Details|courier|10|#000000|Y|N|N|C|TLRB|Y|62.0|30|128.0|85.0|90.0|0.0|lnt_desc|courier|10|#000000|N|N|N|L|R|N|62.0|30|128.0|90.0|94.0|1|38
+statement_loan|21.0|C|B|H|Debit|courier|10|#000000|Y|N|N|R|TLRB|Y|128.0|11|153.0|85.0|90.0|0.0|line_debit|courier|10|#000000|N|N|N|R|R|N|128.0|11|153.0|90.0|94.0|1|38
+statement_loan|22.0|C|B|H|Credit|courier|10|#000000|Y|N|N|R|TLRB|Y|153.0|11|178.0|85.0|90.0|0.0|line_credit|courier|10|#000000|N|N|N|R|R|N|153.0|11|178.0|90.0|94.0|1|38
+statement_loan|23.0|C|B|H|Balance|courier|10|#000000|Y|N|N|R|TLRB|Y|178.0|11|203.0|85.0|90.0|0.0|line_balance|courier|10|#000000|N|N|N|R|R|N|178.0|11|203.0|90.0|94.0|1|38
+statement_loan|24.0|C|C|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|carried_forward|courier|10|#000000|Y|N|N|R|LRB|N|153.0|22|203.0|242.0|247.0|1|1
+statement_loan|25.0|C|C|H|Balance|courier|10|#000000|Y|N|N|R|TLRB|Y|178.0|11|203.0|244.0|249.0|0.0|total_balance|courier|10|#000000|Y|N|N|R|TLRB|N|178.0|11|203.0|249.0|253.0|1|1
+statement_loan|26.0|T|D||Banking Details:|courier|10|#000000|Y|N|N|L|TLRB|Y|10.0|90|203.0|255.0|260.0|0.0|||0||||||||0.0|0|0.0|0.0|0.0|0|0
+statement_loan|27.0|C|D|L|Bank:|courier|10|#000000|Y|N|N|L|LB|N|10.0|6|25.0|260.0|264.0|0.0|ctm_b_name|courier|10|#000000|N|N|N|L|B|N|25.0|35|101.0|260.0|264.0|1|1
+statement_loan|28.0|C|D|L|Branch:|courier|10|#000000|Y|N|N|L|B|N|101.0|8|120.0|260.0|264.0|0.0|ctm_b_ibt|courier|10|#000000|N|N|N|L|B|N|120.0|12|148.0|260.0|264.0|1|1
+statement_loan|29.0|C|D|L|Account:|courier|10|#000000|Y|N|N|L|B|N|148.0|8|167.0|260.0|264.0|0.0|ctm_b_acno|courier|10|#000000|N|N|N|L|RB|N|167.0|16|203.0|260.0|264.0|1|1
 statement_member|1.0|I|A||||0|||||||15.0|0|130.0|15.0|35.0|0.0|ctm_logo||0|||||||0.0|0|0.0|0.0|0.0|0|0
 statement_member|2.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_name|courier|18|Y|N|N|L||N|15.0|30|129.0|15.0|20.0|1|1
 statement_member|3.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add1|courier|10|Y|N|N|L||N|15.0|30|78.0|21.0|25.0|1|1
@@ -390,42 +392,44 @@
 statement_owner|25.0|C|C|H|Deposit|courier|10|Y|N|N|R|TLRB|Y|118.0|13|148.0|244.0|249.0|0.0|total_deposit|courier|10|Y|N|N|R|RB|N|118.0|13|148.0|249.0|253.0|1|1
 statement_owner|26.0|C|C|H|Total Due|courier|10|Y|N|N|R|TLRB|Y|148.0|13|178.0|244.0|249.0|0.0|total_balance|courier|10|Y|N|N|R|RB|N|148.0|13|178.0|249.0|253.0|1|1
 statement_owner|27.0|C|D|H|Message:|courier|10|Y|N|N|L|TLRB|Y|15.0|76|178.0|266.0|271.0|0.0|message|courier|10|N|N|N|L|TLRB|N|15.0|76|178.0|271.0|275.0|2|1
-statement_rental|1.0|I|A||||0|||||||15.0|0|130.0|15.0|35.0|0.0|ctm_logo||0|||||||0.0|0|0.0|0.0|0.0|0|0
-statement_rental|2.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_name|courier|18|Y|N|N|L||N|15.0|30|129.0|15.0|20.0|1|1
-statement_rental|3.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add1|courier|10|Y|N|N|L||N|15.0|30|78.0|21.0|25.0|1|1
-statement_rental|4.0|C|A|L|RegNo:|courier|10|Y|N|N|L||N|85.0|7|100.0|21.0|25.0|0.0|ctm_regno|courier|10|Y|N|N|L||N|100.0|20|142.0|21.0|25.0|1|1
-statement_rental|5.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add2|courier|10|Y|N|N|L||N|15.0|30|78.0|25.0|28.0|1|1
-statement_rental|6.0|C|A|L|TaxNo:|courier|10|Y|N|N|L||N|85.0|7|100.0|25.0|29.0|0.0|ctm_taxno|courier|10|Y|N|N|L||N|100.0|20|142.0|25.0|29.0|1|1
-statement_rental|7.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add3|courier|10|Y|N|N|L||N|15.0|30|78.0|29.0|33.0|1|1
-statement_rental|8.0|C|A|L|TelNo:|courier|10|Y|N|N|L||N|85.0|7|100.0|29.0|33.0|0.0|ctm_tel|courier|10|Y|N|N|L||N|100.0|15|132.0|29.0|33.0|1|1
-statement_rental|9.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_pcode|courier|10|Y|N|N|L||N|15.0|4|23.0|33.0|37.0|1|1
-statement_rental|10.0|C|A|L|FaxNo:|courier|10|Y|N|N|L||N|85.0|7|100.0|33.0|37.0|0.0|ctm_fax|courier|10|Y|N|N|L||N|100.0|15|132.0|33.0|37.0|1|1
-statement_rental|11.0|T|A||STATEMENT|courier|14|Y|N|N|R|TLRB|N|148.0|9|178.0|15.0|20.0|0.0|||0|||||||0.0|0|0.0|0.0|0.0|0|0
-statement_rental|12.0|C|A|H|Account:|courier|10|Y|N|N|L|TLRB|Y|15.0|30|81.0|45.0|50.0|0.0|account_details|courier|10|N|N|N|L|TLRB|N|15.0|30|81.0|50.0|54.0|5|1
-statement_rental|13.0|C|A|H|Premises|courier|10|Y|N|N|C|TLRB|Y|148.0|13|178.0|56.0|61.0|0.0|rtm_code|courier|10|N|N|N|C|LRB|N|148.0|13|178.0|61.0|65.0|1|1
-statement_rental|14.0|C|A|H|Tenant|courier|10|Y|N|N|C|TLRB|Y|148.0|13|178.0|65.0|70.0|0.0|rtm_acno|courier|10|N|N|N|C|TLRB|N|148.0|13|178.0|70.0|74.0|1|1
-statement_rental|15.0|C|A|H|Date|courier|10|Y|N|N|C|TLRB|Y|148.0|13|178.0|74.0|79.0|0.0|document_date|courier|10|N|N|N|C|TLRB|N|148.0|13|178.0|79.0|83.0|1|1
-statement_rental|16.0|C|B|H|Date|courier|10|Y|N|N|C|TLRB|Y|15.0|10|38.0|85.0|90.0|0.0|rtt_trdt|courier|10|N|N|N|C|LR|N|15.0|10|38.0|90.0|94.0|1|38
-statement_rental|17.0|C|B|H|Reference|courier|10|Y|N|N|C|TLRB|Y|38.0|9|59.0|85.0|90.0|0.0|rtt_refno|courier|10|N|N|N|L|R|N|38.0|9|59.0|90.0|94.0|1|38
-statement_rental|18.0|C|B|H|Typ|courier|10|Y|N|N|C|TLRB|Y|59.0|3|67.0|85.0|90.0|0.0|type_code|courier|10|N|N|N|C|R|N|59.0|3|67.0|90.0|94.0|1|38
-statement_rental|19.0|C|B|H|Details|courier|10|Y|N|N|C|TLRB|Y|67.0|30|140.0|85.0|90.0|0.0|rtt_desc|courier|10|N|N|N|L|R|N|67.0|30|140.0|90.0|94.0|1|38
-statement_rental|20.0|C|B|H|CCC|courier|10|Y|N|N|C|TLRB|Y|140.0|3|148.0|85.0|90.0|0.0|rtt_cnum|courier|10|N|N|N|R|R|N|140.0|3|148.0|90.0|94.0|1|38
-statement_rental|21.0|C|B|H|Amount|courier|10|Y|N|N|R|TLRB|Y|148.0|13|178.0|85.0|90.0|0.0|rtt_tramt|courier|10|N|N|N|R|R|N|148.0|13|178.0|90.0|94.0|1|38
-statement_rental|22.0|C|C|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|carried_forward|courier|10|Y|N|N|R|LRB|N|129.0|22|178.0|244.0|249.0|1|1
-statement_rental|23.0|C|C|H|Rental|courier|10|Y|N|N|R|TLRB|Y|15.0|11|40.0|244.0|249.0|0.0|period_rental|courier|10|Y|N|N|R|LRB|N|15.0|11|40.0|249.0|253.0|1|1
-statement_rental|24.0|C|C|H|V.A.T.|courier|10|Y|N|N|R|TLRB|Y|40.0|11|65.0|244.0|249.0|0.0|period_vat|courier|10|Y|N|N|R|RB|N|40.0|11|65.0|249.0|253.0|1|1
-statement_rental|25.0|C|C|H|Tot-Rental|courier|10|Y|N|N|R|TLRB|Y|65.0|11|90.0|244.0|249.0|0.0|total_rental|courier|10|Y|N|N|R|RB|N|65.0|11|90.0|249.0|253.0|1|1
-statement_rental|26.0|C|C|H|Arrears|courier|10|Y|N|N|R|TLRB|Y|90.0|12|118.0|244.0|249.0|0.0|total_arrears|courier|10|Y|N|N|R|RB|N|90.0|12|118.0|249.0|253.0|1|1
-statement_rental|27.0|C|C|H|Interest|courier|10|Y|N|N|R|TLRB|Y|118.0|13|148.0|244.0|249.0|0.0|interest|courier|10|Y|N|N|R|RB|N|118.0|13|148.0|249.0|253.0|1|1
-statement_rental|28.0|C|C|H|Total Due|courier|10|Y|N|N|R|TLRB|Y|148.0|13|178.0|244.0|249.0|0.0|total_balance|courier|10|Y|N|N|R|RB|N|148.0|13|178.0|249.0|253.0|1|1
-statement_rental|29.0|T|D||Property and Banking Details:|courier|10|Y|N|N|L|TLRB|Y|15.0|76|178.0|255.0|260.0|0.0|||0|||||||0.0|0|0.0|0.0|0.0|0|0
-statement_rental|30.0|C|D|L|Bank:|courier|10|Y|N|N|L|L|N|15.0|5|28.0|260.0|264.0|0.0|ctm_b_name|courier|10|N|N|N|L||N|28.0|27|87.0|260.0|264.0|1|1
-statement_rental|31.0|C|D|L|Branch:|courier|10|Y|N|N|L||N|87.0|7|104.0|260.0|264.0|0.0|ctm_b_ibt|courier|10|N|N|N|L||N|104.0|8|123.0|260.0|264.0|1|1
-statement_rental|32.0|C|D|L|Account:|courier|10|Y|N|N|L||N|123.0|8|142.0|260.0|264.0|0.0|ctm_b_acno|courier|10|N|N|N|L|R|N|142.0|16|178.0|260.0|264.0|1|1
-statement_rental|33.0|T|D||BLANK|courier|10|Y|N|N|L|LR|N|15.0|76|178.0|264.0|266.0|0.0|||0|||||||0.0|0|0.0|0.0|0.0|0|0
-statement_rental|34.0|C|D|L|Property:|courier|10|Y|N|N|L|LB|N|15.0|9|36.0|266.0|272.0|0.0|rtp_desc|courier|10|N|N|N|L|B|N|36.0|43|129.0|266.0|272.0|1|1
-statement_rental|35.0|C|D|L|VAT-Number:|courier|10|Y|N|N|L|B|N|129.0|11|154.0|266.0|272.0|0.0|rtm_vatnum|courier|10|N|N|N|L|RB|N|154.0|10|178.0|266.0|272.0|1|1
-statement_rental|36.0|C|D|H|Message:|courier|10|Y|N|N|L|TLRB|Y|15.0|76|178.0|274.0|279.0|0.0|message|courier|10|N|N|N|L|TLRB|N|15.0|76|178.0|279.0|283.0|2|1
+statement_rental|1.0|I|A||||0|#000000|||||||10.0|0|130.0|15.0|35.0|0.0|ctm_logo||0|#000000|||||||0.0|0|0.0|0.0|0.0|0|0
+statement_rental|2.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_name|courier|18|#000000|Y|N|N|L||N|10.0|30|129.0|15.0|20.0|1|1
+statement_rental|3.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add1|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|21.0|25.0|1|1
+statement_rental|4.0|C|A|L|RegNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|21.0|25.0|0.0|ctm_regno|courier|10|#000000|Y|N|N|L||N|100.0|20|142.0|21.0|25.0|1|1
+statement_rental|5.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add2|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|25.0|28.0|1|1
+statement_rental|6.0|C|A|L|TaxNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|25.0|29.0|0.0|ctm_taxno|courier|10|#000000|Y|N|N|L||N|100.0|20|142.0|25.0|29.0|1|1
+statement_rental|7.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add3|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|29.0|33.0|1|1
+statement_rental|8.0|C|A|L|TelNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|29.0|33.0|0.0|ctm_tel|courier|10|#000000|Y|N|N|L||N|100.0|10|132.0|29.0|33.0|1|1
+statement_rental|9.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_pcode|courier|10|#000000|Y|N|N|L||N|10.0|4|23.0|33.0|37.0|1|1
+statement_rental|10.0|C|A|L|FaxNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|33.0|37.0|0.0|ctm_fax|courier|10|#000000|Y|N|N|L||N|100.0|10|132.0|33.0|37.0|1|1
+statement_rental|11.0|T|A||STATEMENT|courier|14|#000000|Y|N|N|C|TLRB|N|168.0|11|204.0|15.0|20.0|0.0|||0||||||||0.0|0|0.0|0.0|0.0|0|0
+statement_rental|12.0|C|A|H|Account:|courier|10|#000000|Y|N|N|L|TLRB|Y|10.0|30|76.0|45.0|50.0|0.0|account_details|courier|10|#000000|N|N|N|L|TLRB|N|10.0|30|76.0|50.0|54.0|5|1
+statement_rental|13.0|C|A|H|Premises|courier|10|#000000|Y|N|N|C|TLRB|Y|179.0|11|204.0|56.0|61.0|0.0|rtm_code|courier|10|#000000|N|N|N|C|LRB|N|179.0|11|204.0|61.0|65.0|1|1
+statement_rental|14.0|C|A|H|Tenant|courier|10|#000000|Y|N|N|C|TLRB|Y|179.0|11|204.0|65.0|70.0|0.0|rtm_acno|courier|10|#000000|N|N|N|C|TLRB|N|179.0|11|204.0|70.0|74.0|1|1
+statement_rental|15.0|C|A|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|179.0|11|204.0|74.0|79.0|0.0|document_date|courier|10|#000000|N|N|N|C|TLRB|N|179.0|11|204.0|79.0|83.0|1|1
+statement_rental|16.0|C|B|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|10.0|10|33.0|85.0|90.0|0.0|rtt_trdt|courier|10|#000000|N|N|N|C|LR|N|10.0|10|33.0|90.0|94.0|1|38
+statement_rental|17.0|C|B|H|Reference|courier|10|#000000|Y|N|N|C|TLRB|Y|33.0|9|54.0|85.0|90.0|0.0|rtt_refno|courier|10|#000000|N|N|N|L|R|N|33.0|9|54.0|90.0|94.0|1|38
+statement_rental|18.0|C|B|H|Typ|courier|10|#000000|Y|N|N|C|TLRB|Y|54.0|3|62.0|85.0|90.0|0.0|type_code|courier|10|#000000|N|N|N|C|R|N|54.0|3|62.0|90.0|94.0|1|38
+statement_rental|19.0|C|B|H|Details|courier|10|#000000|Y|N|N|C|TLRB|Y|62.0|27|121.0|85.0|90.0|0.0|rtt_desc|courier|10|#000000|N|N|N|L|R|N|62.0|27|121.0|90.0|94.0|1|38
+statement_rental|20.0|C|B|H|CCC|courier|10|#000000|Y|N|N|C|TLRB|Y|121.0|3|129.0|85.0|90.0|0.0|rtt_cnum|courier|10|#000000|N|N|N|R|R|N|121.0|3|129.0|90.0|94.0|1|38
+statement_rental|21.0|C|B|H|Debit|courier|10|#000000|Y|N|N|R|TLRB|Y|129.0|11|154.0|85.0|90.0|0.0|line_debit|courier|10|#000000|N|N|N|R|R|N|129.0|11|154.0|90.0|94.0|1|38
+statement_rental|22.0|C|B|H|Credit|courier|10|#000000|Y|N|N|R|TLRB|Y|154.0|11|179.0|85.0|90.0|0.0|line_credit|courier|10|#000000|N|N|N|R|R|N|154.0|11|179.0|90.0|94.0|1|38
+statement_rental|23.0|C|B|H|Balance|courier|10|#000000|Y|N|N|R|TLRB|Y|179.0|11|204.0|85.0|90.0|0.0|line_balance|courier|10|#000000|N|N|N|R|R|N|179.0|11|204.0|90.0|94.0|1|38
+statement_rental|24.0|C|C|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|carried_forward|courier|10|#000000|Y|N|N|R|LRB|N|129.0|22|178.0|244.0|249.0|1|1
+statement_rental|25.0|C|C|H|Rental|courier|10|#000000|Y|N|N|R|TLRB|Y|10.0|14|42.0|244.0|249.0|0.0|period_rental|courier|10|#000000|Y|N|N|R|LRB|N|10.0|14|42.0|249.0|253.0|1|1
+statement_rental|26.0|C|C|H|V.A.T.|courier|10|#000000|Y|N|N|R|TLRB|Y|42.0|14|74.0|244.0|249.0|0.0|period_vat|courier|10|#000000|Y|N|N|R|RB|N|42.0|14|74.0|249.0|253.0|1|1
+statement_rental|27.0|C|C|H|Tot-Rental|courier|10|#000000|Y|N|N|R|TLRB|Y|74.0|14|106.0|244.0|249.0|0.0|total_rental|courier|10|#000000|Y|N|N|R|RB|N|74.0|14|106.0|249.0|253.0|1|1
+statement_rental|28.0|C|C|H|Arrears|courier|10|#000000|Y|N|N|R|TLRB|Y|106.0|14|138.0|244.0|249.0|0.0|total_arrears|courier|10|#000000|Y|N|N|R|RB|N|106.0|14|138.0|249.0|253.0|1|1
+statement_rental|29.0|C|C|H|Interest|courier|10|#000000|Y|N|N|R|TLRB|Y|138.0|14|170.0|244.0|249.0|0.0|interest|courier|10|#000000|Y|N|N|R|RB|N|138.0|14|170.0|249.0|253.0|1|1
+statement_rental|30.0|C|C|H|Total Due|courier|10|#000000|Y|N|N|R|TLRB|Y|170.0|15|204.0|244.0|249.0|0.0|total_balance|courier|10|#000000|Y|N|N|R|RB|N|170.0|15|204.0|249.0|253.0|1|1
+statement_rental|31.0|T|D||Property and Banking Details:|courier|10|#000000|Y|N|N|L|TLRB|Y|10.0|90|204.0|255.0|260.0|0.0|||0||||||||0.0|0|0.0|0.0|0.0|0|0
+statement_rental|32.0|C|D|L|Bank:|courier|10|#000000|Y|N|N|L|L|N|10.0|5|28.0|260.0|264.0|0.0|ctm_b_name|courier|10|#000000|N|N|N|L||N|28.0|27|87.0|260.0|264.0|1|1
+statement_rental|33.0|C|D|L|Branch:|courier|10|#000000|Y|N|N|L||N|87.0|7|104.0|260.0|264.0|0.0|ctm_b_ibt|courier|10|#000000|N|N|N|L||N|104.0|8|123.0|260.0|264.0|1|1
+statement_rental|34.0|C|D|L|Account:|courier|10|#000000|Y|N|N|L||N|123.0|8|142.0|260.0|264.0|0.0|ctm_b_acno|courier|10|#000000|N|N|N|L|R|N|142.0|16|204.0|260.0|264.0|1|1
+statement_rental|35.0|T|D||BLANK|courier|10|#000000|Y|N|N|L|LR|N|10.0|76|204.0|264.0|266.0|0.0|||0||||||||0.0|0|0.0|0.0|0.0|0|0
+statement_rental|36.0|C|D|L|Property:|courier|10|#000000|Y|N|N|L|LB|N|10.0|9|36.0|266.0|272.0|0.0|rtp_desc|courier|10|#000000|N|N|N|L|B|N|36.0|43|129.0|266.0|272.0|1|1
+statement_rental|37.0|C|D|L|VAT-Number:|courier|10|#000000|Y|N|N|L|B|N|129.0|11|154.0|266.0|272.0|0.0|rtm_vatnum|courier|10|#000000|N|N|N|L|RB|N|154.0|10|204.0|266.0|272.0|1|1
+statement_rental|38.0|C|D|H|Message:|courier|10|#000000|Y|N|N|L|TLRB|Y|10.0|76|204.0|274.0|279.0|0.0|message|courier|10|#000000|N|N|N|L|TLRB|N|10.0|76|204.0|279.0|283.0|2|1
 statement_tenant|1.0|I|A||||0|||||||15.0|0|130.0|15.0|35.0|0.0|ctm_logo||0|||||||0.0|0|0.0|0.0|0.0|0|0
 statement_tenant|2.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_name|courier|18|Y|N|N|L||N|15.0|30|129.0|15.0|20.0|1|1
 statement_tenant|3.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add1|courier|10|Y|N|N|L||N|15.0|30|78.0|21.0|25.0|1|1

=== modified file 'csv/tpldet_rne.dat'
--- csv/tpldet_rne.dat	2014-04-29 19:57:51 +0000
+++ csv/tpldet_rne.dat	2015-12-01 08:33:05 +0000
@@ -72,6 +72,35 @@
 sales_document|41.0|C|D|L|Code:|courier|10|Y|N|N|L|L|N|111.0|8|130.0|176.0|180.0|0.0|ctm_b_ibt|courier|10|N|N|N|L|R|N|130.0|30|196.0|176.0|180.0|1|1
 sales_document|42.0|C|D|L|Account:|courier|10|Y|N|N|L|LB|N|111.0|8|130.0|180.0|184.0|0.0|ctm_b_acno|courier|10|N|N|N|L|RB|N|130.0|30|196.0|180.0|184.0|1|1
 sales_document|43.0|C|D|H|Terms and Conditions:|courier|10|Y|N|N|L|TLRB|Y|212.0|30|278.0|163.0|168.0|0.0|terms|courier|10|N|N|N|L|LRB|N|212.0|30|278.0|168.0|172.0|5|1
+statement_loan|1.0|I|A||||0|#000000|||||||10.0|0|130.0|15.0|35.0|0.0|ctm_logo||0|#000000|||||||0.0|0|0.0|0.0|0.0|0|0
+statement_loan|2.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_name|courier|18|#000000|Y|N|N|L||N|10.0|30|129.0|15.0|20.0|1|1
+statement_loan|3.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add1|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|21.0|25.0|1|1
+statement_loan|4.0|C|A|L|RegNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|21.0|25.0|0.0|ctm_regno|courier|10|#000000|Y|N|N|L||N|100.0|20|142.0|21.0|25.0|1|1
+statement_loan|5.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add2|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|25.0|28.0|1|1
+statement_loan|6.0|C|A|L|TaxNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|25.0|29.0|0.0|ctm_taxno|courier|10|#000000|Y|N|N|L||N|100.0|20|142.0|25.0|29.0|1|1
+statement_loan|7.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add3|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|29.0|33.0|1|1
+statement_loan|8.0|C|A|L|TelNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|29.0|33.0|0.0|ctm_tel|courier|10|#000000|Y|N|N|L||N|100.0|10|132.0|29.0|33.0|1|1
+statement_loan|9.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_pcode|courier|10|#000000|Y|N|N|L||N|10.0|4|23.0|33.0|37.0|1|1
+statement_loan|10.0|C|A|L|FaxNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|33.0|37.0|0.0|ctm_fax|courier|10|#000000|Y|N|N|L||N|100.0|10|132.0|33.0|37.0|1|1
+statement_loan|11.0|T|A||STATEMENT & INVOICE|courier|14|#000000|Y|N|N|R|TLRB|N|173.0|9|203.0|10.0|20.0|0.0|||0||||||||0.0|0|0.0|0.0|0.0|0|0
+statement_loan|12.0|C|A|H|Account:|courier|10|#000000|Y|N|N|L|TLRB|Y|10.0|30|76.0|45.0|50.0|0.0|account_details|courier|10|#000000|N|N|N|L|TLRB|N|10.0|30|76.0|50.0|54.0|5|1
+statement_loan|13.0|C|A|H|Acc-Num|courier|10|#000000|Y|N|N|C|TLRB|Y|178.0|11|203.0|47.0|52.0|0.0|lm1_acno|courier|10|#000000|N|N|N|C|TLRB|N|178.0|11|203.0|52.0|56.0|1|1
+statement_loan|14.0|C|A|H|Loan|courier|10|#000000|Y|N|N|C|TLRB|Y|178.0|11|203.0|56.0|61.0|0.0|lm2_loan|courier|10|#000000|N|N|N|C|TLRB|N|178.0|11|203.0|61.0|65.0|1|1
+statement_loan|15.0|C|A|H|Page|courier|10|#000000|Y|N|N|C|TLRB|Y|178.0|11|203.0|65.0|70.0|0.0|page_number|courier|10|#000000|N|N|N|C|TLRB|N|178.0|11|203.0|70.0|74.0|1|1
+statement_loan|16.0|C|A|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|178.0|11|203.0|74.0|79.0|0.0|document_date|courier|10|#000000|N|N|N|C|TLRB|N|178.0|11|203.0|79.0|83.0|1|1
+statement_loan|17.0|C|B|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|10.0|10|33.0|85.0|90.0|0.0|lnt_trdt|courier|10|#000000|N|N|N|C|LR|N|10.0|10|33.0|90.0|94.0|1|38
+statement_loan|18.0|C|B|H|Reference|courier|10|#000000|Y|N|N|C|TLRB|Y|33.0|9|54.0|85.0|90.0|0.0|lnt_refno|courier|10|#000000|N|N|N|L|R|N|33.0|9|54.0|90.0|94.0|1|38
+statement_loan|19.0|C|B|H|Typ|courier|10|#000000|Y|N|N|C|TLRB|Y|54.0|3|62.0|85.0|90.0|0.0|type_code|courier|10|#000000|N|N|N|C|R|N|54.0|3|62.0|90.0|94.0|1|38
+statement_loan|20.0|C|B|H|Details|courier|10|#000000|Y|N|N|C|TLRB|Y|62.0|30|128.0|85.0|90.0|0.0|lnt_desc|courier|10|#000000|N|N|N|L|R|N|62.0|30|128.0|90.0|94.0|1|38
+statement_loan|21.0|C|B|H|Debit|courier|10|#000000|Y|N|N|R|TLRB|Y|128.0|11|153.0|85.0|90.0|0.0|line_debit|courier|10|#000000|N|N|N|R|R|N|128.0|11|153.0|90.0|94.0|1|38
+statement_loan|22.0|C|B|H|Credit|courier|10|#000000|Y|N|N|R|TLRB|Y|153.0|11|178.0|85.0|90.0|0.0|line_credit|courier|10|#000000|N|N|N|R|R|N|153.0|11|178.0|90.0|94.0|1|38
+statement_loan|23.0|C|B|H|Balance|courier|10|#000000|Y|N|N|R|TLRB|Y|178.0|11|203.0|85.0|90.0|0.0|line_balance|courier|10|#000000|N|N|N|R|R|N|178.0|11|203.0|90.0|94.0|1|38
+statement_loan|24.0|C|C|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|carried_forward|courier|10|#000000|Y|N|N|R|LRB|N|153.0|22|203.0|242.0|247.0|1|1
+statement_loan|25.0|C|C|H|Balance|courier|10|#000000|Y|N|N|R|TLRB|Y|178.0|11|203.0|244.0|249.0|0.0|total_balance|courier|10|#000000|Y|N|N|R|TLRB|N|178.0|11|203.0|249.0|253.0|1|1
+statement_loan|26.0|T|D||Banking Details:|courier|10|#000000|Y|N|N|L|TLRB|Y|10.0|90|203.0|255.0|260.0|0.0|||0||||||||0.0|0|0.0|0.0|0.0|0|0
+statement_loan|27.0|C|D|L|Bank:|courier|10|#000000|Y|N|N|L|LB|N|10.0|6|25.0|260.0|264.0|0.0|ctm_b_name|courier|10|#000000|N|N|N|L|B|N|25.0|35|101.0|260.0|264.0|1|1
+statement_loan|28.0|C|D|L|Branch:|courier|10|#000000|Y|N|N|L|B|N|101.0|8|120.0|260.0|264.0|0.0|ctm_b_ibt|courier|10|#000000|N|N|N|L|B|N|120.0|12|148.0|260.0|264.0|1|1
+statement_loan|29.0|C|D|L|Account:|courier|10|#000000|Y|N|N|L|B|N|148.0|8|167.0|260.0|264.0|0.0|ctm_b_acno|courier|10|#000000|N|N|N|L|RB|N|167.0|16|203.0|260.0|264.0|1|1
 statement_normal|1.0|I|A||||0|||||||15.0|0|130.0|15.0|35.0|0.0|ctm_logo||0|||||||0.0|0|0.0|0.0|0.0|0|0
 statement_normal|2.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_name|courier|18|Y|N|N|L||N|15.0|30|129.0|15.0|20.0|1|1
 statement_normal|3.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add1|courier|10|Y|N|N|L||N|15.0|30|78.0|21.0|25.0|1|1
@@ -138,39 +167,41 @@
 statement_other|29.0|C|D|L|Branch:|courier|10|Y|N|N|L|B|N|87.0|7|104.0|260.0|264.0|0.0|ctm_b_ibt|courier|10|N|N|N|L|B|N|104.0|8|123.0|260.0|264.0|1|1
 statement_other|30.0|C|D|L|Account:|courier|10|Y|N|N|L|B|N|123.0|8|142.0|260.0|264.0|0.0|ctm_b_acno|courier|10|N|N|N|L|RB|N|142.0|16|178.0|260.0|264.0|1|1
 statement_other|31.0|C|D|H|Message:|courier|10|Y|N|N|L|TLRB|Y|15.0|76|178.0|266.0|271.0|0.0|message|courier|10|N|N|N|L|TLRB|N|15.0|76|178.0|271.0|275.0|2|1
-statement_rental|1.0|I|A||||0|||||||15.0|0|130.0|15.0|35.0|0.0|ctm_logo||0|||||||0.0|0|0.0|0.0|0.0|0|0
-statement_rental|2.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_name|courier|18|Y|N|N|L||N|15.0|30|129.0|15.0|20.0|1|1
-statement_rental|3.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add1|courier|10|Y|N|N|L||N|15.0|30|78.0|21.0|25.0|1|1
-statement_rental|4.0|C|A|L|RegNo:|courier|10|Y|N|N|L||N|85.0|7|100.0|21.0|25.0|0.0|ctm_regno|courier|10|Y|N|N|L||N|100.0|20|142.0|21.0|25.0|1|1
-statement_rental|5.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add2|courier|10|Y|N|N|L||N|15.0|30|78.0|25.0|28.0|1|1
-statement_rental|6.0|C|A|L|TaxNo:|courier|10|Y|N|N|L||N|85.0|7|100.0|25.0|29.0|0.0|ctm_taxno|courier|10|Y|N|N|L||N|100.0|20|142.0|25.0|29.0|1|1
-statement_rental|7.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add3|courier|10|Y|N|N|L||N|15.0|30|78.0|29.0|33.0|1|1
-statement_rental|8.0|C|A|L|TelNo:|courier|10|Y|N|N|L||N|85.0|7|100.0|29.0|33.0|0.0|ctm_tel|courier|10|Y|N|N|L||N|100.0|15|132.0|29.0|33.0|1|1
-statement_rental|9.0|C|A|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_pcode|courier|10|Y|N|N|L||N|15.0|4|23.0|33.0|37.0|1|1
-statement_rental|10.0|C|A|L|FaxNo:|courier|10|Y|N|N|L||N|85.0|7|100.0|33.0|37.0|0.0|ctm_fax|courier|10|Y|N|N|L||N|100.0|15|132.0|33.0|37.0|1|1
-statement_rental|11.0|T|A||STATEMENT|courier|14|Y|N|N|R|TLRB|N|148.0|9|178.0|15.0|20.0|0.0|||0|||||||0.0|0|0.0|0.0|0.0|0|0
-statement_rental|12.0|C|A|H|Account:|courier|10|Y|N|N|L|TLRB|Y|15.0|30|81.0|45.0|50.0|0.0|account_details|courier|10|N|N|N|L|TLRB|N|15.0|30|81.0|50.0|54.0|5|1
-statement_rental|13.0|C|A|H|Premises|courier|10|Y|N|N|C|TLRB|Y|148.0|13|178.0|56.0|61.0|0.0|rtm_code|courier|10|N|N|N|C|LRB|N|148.0|13|178.0|61.0|65.0|1|1
-statement_rental|14.0|C|A|H|Tenant|courier|10|Y|N|N|C|TLRB|Y|148.0|13|178.0|65.0|70.0|0.0|rtm_acno|courier|10|N|N|N|C|TLRB|N|148.0|13|178.0|70.0|74.0|1|1
-statement_rental|15.0|C|A|H|Date|courier|10|Y|N|N|C|TLRB|Y|148.0|13|178.0|74.0|79.0|0.0|document_date|courier|10|N|N|N|C|TLRB|N|148.0|13|178.0|79.0|83.0|1|1
-statement_rental|16.0|C|B|H|Date|courier|10|Y|N|N|C|TLRB|Y|15.0|10|38.0|85.0|90.0|0.0|rtt_trdt|courier|10|N|N|N|C|LR|N|15.0|10|38.0|90.0|94.0|1|38
-statement_rental|17.0|C|B|H|Reference|courier|10|Y|N|N|C|TLRB|Y|38.0|9|59.0|85.0|90.0|0.0|rtt_refno|courier|10|N|N|N|L|R|N|38.0|9|59.0|90.0|94.0|1|38
-statement_rental|18.0|C|B|H|Typ|courier|10|Y|N|N|C|TLRB|Y|59.0|3|67.0|85.0|90.0|0.0|type_code|courier|10|N|N|N|C|R|N|59.0|3|67.0|90.0|94.0|1|38
-statement_rental|19.0|C|B|H|Details|courier|10|Y|N|N|C|TLRB|Y|67.0|30|140.0|85.0|90.0|0.0|rtt_desc|courier|10|N|N|N|L|R|N|67.0|30|140.0|90.0|94.0|1|38
-statement_rental|20.0|C|B|H|CCC|courier|10|Y|N|N|C|TLRB|Y|140.0|3|148.0|85.0|90.0|0.0|rtt_cnum|courier|10|N|N|N|R|R|N|140.0|3|148.0|90.0|94.0|1|38
-statement_rental|21.0|C|B|H|Amount|courier|10|Y|N|N|R|TLRB|Y|148.0|13|178.0|85.0|90.0|0.0|rtt_tramt|courier|10|N|N|N|R|R|N|148.0|13|178.0|90.0|94.0|1|38
-statement_rental|22.0|C|C|N|||0|||||||0.0|0|0.0|0.0|0.0|0.0|carried_forward|courier|10|Y|N|N|R|LRB|N|129.0|22|178.0|244.0|249.0|1|1
-statement_rental|23.0|C|C|H|Rental|courier|10|Y|N|N|R|TLRB|Y|15.0|11|40.0|244.0|249.0|0.0|period_rental|courier|10|Y|N|N|R|LRB|N|15.0|11|40.0|249.0|253.0|1|1
-statement_rental|24.0|C|C|H|V.A.T.|courier|10|Y|N|N|R|TLRB|Y|40.0|11|65.0|244.0|249.0|0.0|period_vat|courier|10|Y|N|N|R|RB|N|40.0|11|65.0|249.0|253.0|1|1
-statement_rental|25.0|C|C|H|Tot-Rental|courier|10|Y|N|N|R|TLRB|Y|65.0|11|90.0|244.0|249.0|0.0|total_rental|courier|10|Y|N|N|R|RB|N|65.0|11|90.0|249.0|253.0|1|1
-statement_rental|26.0|C|C|H|Arrears|courier|10|Y|N|N|R|TLRB|Y|90.0|12|118.0|244.0|249.0|0.0|total_arrears|courier|10|Y|N|N|R|RB|N|90.0|12|118.0|249.0|253.0|1|1
-statement_rental|27.0|C|C|H|Interest|courier|10|Y|N|N|R|TLRB|Y|118.0|13|148.0|244.0|249.0|0.0|interest|courier|10|Y|N|N|R|RB|N|118.0|13|148.0|249.0|253.0|1|1
-statement_rental|28.0|C|C|H|Total Due|courier|10|Y|N|N|R|TLRB|Y|148.0|13|178.0|244.0|249.0|0.0|total_balance|courier|10|Y|N|N|R|RB|N|148.0|13|178.0|249.0|253.0|1|1
-statement_rental|29.0|T|D||Property and Banking Details:|courier|10|Y|N|N|L|TLRB|Y|15.0|76|178.0|255.0|260.0|0.0|||0|||||||0.0|0|0.0|0.0|0.0|0|0
-statement_rental|30.0|C|D|L|Bank:|courier|10|Y|N|N|L|L|N|15.0|5|28.0|260.0|264.0|0.0|ctm_b_name|courier|10|N|N|N|L||N|28.0|27|87.0|260.0|264.0|1|1
-statement_rental|31.0|C|D|L|Branch:|courier|10|Y|N|N|L||N|87.0|7|104.0|260.0|264.0|0.0|ctm_b_ibt|courier|10|N|N|N|L||N|104.0|8|123.0|260.0|264.0|1|1
-statement_rental|32.0|C|D|L|Account:|courier|10|Y|N|N|L||N|123.0|8|142.0|260.0|264.0|0.0|ctm_b_acno|courier|10|N|N|N|L|R|N|142.0|16|178.0|260.0|264.0|1|1
-statement_rental|33.0|T|D||BLANK|courier|10|Y|N|N|L|LR|N|15.0|76|178.0|264.0|266.0|0.0|||0|||||||0.0|0|0.0|0.0|0.0|0|0
-statement_rental|34.0|C|D|L|Property:|courier|10|Y|N|N|L|LB|N|15.0|9|36.0|266.0|272.0|0.0|rtp_desc|courier|10|N|N|N|L|B|N|36.0|43|129.0|266.0|272.0|1|1
-statement_rental|35.0|C|D|L|VAT-Number:|courier|10|Y|N|N|L|B|N|129.0|11|154.0|266.0|272.0|0.0|rtm_vatnum|courier|10|N|N|N|L|RB|N|154.0|10|178.0|266.0|272.0|1|1
-statement_rental|36.0|C|D|H|Message:|courier|10|Y|N|N|L|TLRB|Y|15.0|76|178.0|274.0|279.0|0.0|message|courier|10|N|N|N|L|TLRB|N|15.0|76|178.0|279.0|283.0|2|1
+statement_rental|1.0|I|A||||0|#000000|||||||10.0|0|130.0|15.0|35.0|0.0|ctm_logo||0|#000000|||||||0.0|0|0.0|0.0|0.0|0|0
+statement_rental|2.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_name|courier|18|#000000|Y|N|N|L||N|10.0|30|129.0|15.0|20.0|1|1
+statement_rental|3.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add1|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|21.0|25.0|1|1
+statement_rental|4.0|C|A|L|RegNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|21.0|25.0|0.0|ctm_regno|courier|10|#000000|Y|N|N|L||N|100.0|20|142.0|21.0|25.0|1|1
+statement_rental|5.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add2|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|25.0|28.0|1|1
+statement_rental|6.0|C|A|L|TaxNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|25.0|29.0|0.0|ctm_taxno|courier|10|#000000|Y|N|N|L||N|100.0|20|142.0|25.0|29.0|1|1
+statement_rental|7.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_add3|courier|10|#000000|Y|N|N|L||N|10.0|30|78.0|29.0|33.0|1|1
+statement_rental|8.0|C|A|L|TelNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|29.0|33.0|0.0|ctm_tel|courier|10|#000000|Y|N|N|L||N|100.0|10|132.0|29.0|33.0|1|1
+statement_rental|9.0|C|A|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|ctm_pcode|courier|10|#000000|Y|N|N|L||N|10.0|4|23.0|33.0|37.0|1|1
+statement_rental|10.0|C|A|L|FaxNo:|courier|10|#000000|Y|N|N|L||N|85.0|7|100.0|33.0|37.0|0.0|ctm_fax|courier|10|#000000|Y|N|N|L||N|100.0|10|132.0|33.0|37.0|1|1
+statement_rental|11.0|T|A||STATEMENT|courier|14|#000000|Y|N|N|C|TLRB|N|168.0|11|204.0|15.0|20.0|0.0|||0||||||||0.0|0|0.0|0.0|0.0|0|0
+statement_rental|12.0|C|A|H|Account:|courier|10|#000000|Y|N|N|L|TLRB|Y|10.0|30|76.0|45.0|50.0|0.0|account_details|courier|10|#000000|N|N|N|L|TLRB|N|10.0|30|76.0|50.0|54.0|5|1
+statement_rental|13.0|C|A|H|Premises|courier|10|#000000|Y|N|N|C|TLRB|Y|179.0|11|204.0|56.0|61.0|0.0|rtm_code|courier|10|#000000|N|N|N|C|LRB|N|179.0|11|204.0|61.0|65.0|1|1
+statement_rental|14.0|C|A|H|Tenant|courier|10|#000000|Y|N|N|C|TLRB|Y|179.0|11|204.0|65.0|70.0|0.0|rtm_acno|courier|10|#000000|N|N|N|C|TLRB|N|179.0|11|204.0|70.0|74.0|1|1
+statement_rental|15.0|C|A|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|179.0|11|204.0|74.0|79.0|0.0|document_date|courier|10|#000000|N|N|N|C|TLRB|N|179.0|11|204.0|79.0|83.0|1|1
+statement_rental|16.0|C|B|H|Date|courier|10|#000000|Y|N|N|C|TLRB|Y|10.0|10|33.0|85.0|90.0|0.0|rtt_trdt|courier|10|#000000|N|N|N|C|LR|N|10.0|10|33.0|90.0|94.0|1|38
+statement_rental|17.0|C|B|H|Reference|courier|10|#000000|Y|N|N|C|TLRB|Y|33.0|9|54.0|85.0|90.0|0.0|rtt_refno|courier|10|#000000|N|N|N|L|R|N|33.0|9|54.0|90.0|94.0|1|38
+statement_rental|18.0|C|B|H|Typ|courier|10|#000000|Y|N|N|C|TLRB|Y|54.0|3|62.0|85.0|90.0|0.0|type_code|courier|10|#000000|N|N|N|C|R|N|54.0|3|62.0|90.0|94.0|1|38
+statement_rental|19.0|C|B|H|Details|courier|10|#000000|Y|N|N|C|TLRB|Y|62.0|27|121.0|85.0|90.0|0.0|rtt_desc|courier|10|#000000|N|N|N|L|R|N|62.0|27|121.0|90.0|94.0|1|38
+statement_rental|20.0|C|B|H|CCC|courier|10|#000000|Y|N|N|C|TLRB|Y|121.0|3|129.0|85.0|90.0|0.0|rtt_cnum|courier|10|#000000|N|N|N|R|R|N|121.0|3|129.0|90.0|94.0|1|38
+statement_rental|21.0|C|B|H|Debit|courier|10|#000000|Y|N|N|R|TLRB|Y|129.0|11|154.0|85.0|90.0|0.0|line_debit|courier|10|#000000|N|N|N|R|R|N|129.0|11|154.0|90.0|94.0|1|38
+statement_rental|22.0|C|B|H|Credit|courier|10|#000000|Y|N|N|R|TLRB|Y|154.0|11|179.0|85.0|90.0|0.0|line_credit|courier|10|#000000|N|N|N|R|R|N|154.0|11|179.0|90.0|94.0|1|38
+statement_rental|23.0|C|B|H|Balance|courier|10|#000000|Y|N|N|R|TLRB|Y|179.0|11|204.0|85.0|90.0|0.0|line_balance|courier|10|#000000|N|N|N|R|R|N|179.0|11|204.0|90.0|94.0|1|38
+statement_rental|24.0|C|C|N|||0|#000000|||||||0.0|0|0.0|0.0|0.0|0.0|carried_forward|courier|10|#000000|Y|N|N|R|LRB|N|129.0|22|178.0|244.0|249.0|1|1
+statement_rental|25.0|C|C|H|Rental|courier|10|#000000|Y|N|N|R|TLRB|Y|10.0|14|42.0|244.0|249.0|0.0|period_rental|courier|10|#000000|Y|N|N|R|LRB|N|10.0|14|42.0|249.0|253.0|1|1
+statement_rental|26.0|C|C|H|V.A.T.|courier|10|#000000|Y|N|N|R|TLRB|Y|42.0|14|74.0|244.0|249.0|0.0|period_vat|courier|10|#000000|Y|N|N|R|RB|N|42.0|14|74.0|249.0|253.0|1|1
+statement_rental|27.0|C|C|H|Tot-Rental|courier|10|#000000|Y|N|N|R|TLRB|Y|74.0|14|106.0|244.0|249.0|0.0|total_rental|courier|10|#000000|Y|N|N|R|RB|N|74.0|14|106.0|249.0|253.0|1|1
+statement_rental|28.0|C|C|H|Arrears|courier|10|#000000|Y|N|N|R|TLRB|Y|106.0|14|138.0|244.0|249.0|0.0|total_arrears|courier|10|#000000|Y|N|N|R|RB|N|106.0|14|138.0|249.0|253.0|1|1
+statement_rental|29.0|C|C|H|Interest|courier|10|#000000|Y|N|N|R|TLRB|Y|138.0|14|170.0|244.0|249.0|0.0|interest|courier|10|#000000|Y|N|N|R|RB|N|138.0|14|170.0|249.0|253.0|1|1
+statement_rental|30.0|C|C|H|Total Due|courier|10|#000000|Y|N|N|R|TLRB|Y|170.0|15|204.0|244.0|249.0|0.0|total_balance|courier|10|#000000|Y|N|N|R|RB|N|170.0|15|204.0|249.0|253.0|1|1
+statement_rental|31.0|T|D||Property and Banking Details:|courier|10|#000000|Y|N|N|L|TLRB|Y|10.0|90|204.0|255.0|260.0|0.0|||0||||||||0.0|0|0.0|0.0|0.0|0|0
+statement_rental|32.0|C|D|L|Bank:|courier|10|#000000|Y|N|N|L|L|N|10.0|5|28.0|260.0|264.0|0.0|ctm_b_name|courier|10|#000000|N|N|N|L||N|28.0|27|87.0|260.0|264.0|1|1
+statement_rental|33.0|C|D|L|Branch:|courier|10|#000000|Y|N|N|L||N|87.0|7|104.0|260.0|264.0|0.0|ctm_b_ibt|courier|10|#000000|N|N|N|L||N|104.0|8|123.0|260.0|264.0|1|1
+statement_rental|34.0|C|D|L|Account:|courier|10|#000000|Y|N|N|L||N|123.0|8|142.0|260.0|264.0|0.0|ctm_b_acno|courier|10|#000000|N|N|N|L|R|N|142.0|16|204.0|260.0|264.0|1|1
+statement_rental|35.0|T|D||BLANK|courier|10|#000000|Y|N|N|L|LR|N|10.0|76|204.0|264.0|266.0|0.0|||0||||||||0.0|0|0.0|0.0|0.0|0|0
+statement_rental|36.0|C|D|L|Property:|courier|10|#000000|Y|N|N|L|LB|N|10.0|9|36.0|266.0|272.0|0.0|rtp_desc|courier|10|#000000|N|N|N|L|B|N|36.0|43|129.0|266.0|272.0|1|1
+statement_rental|37.0|C|D|L|VAT-Number:|courier|10|#000000|Y|N|N|L|B|N|129.0|11|154.0|266.0|272.0|0.0|rtm_vatnum|courier|10|#000000|N|N|N|L|RB|N|154.0|10|204.0|266.0|272.0|1|1
+statement_rental|38.0|C|D|H|Message:|courier|10|#000000|Y|N|N|L|TLRB|Y|10.0|76|204.0|274.0|279.0|0.0|message|courier|10|#000000|N|N|N|L|TLRB|N|10.0|76|204.0|279.0|283.0|2|1

=== modified file 'csv/tplmst_rne.dat'
--- csv/tplmst_rne.dat	2014-03-28 07:32:49 +0000
+++ csv/tplmst_rne.dat	2015-11-22 08:54:58 +0000
@@ -1,5 +1,6 @@
 remittance_rnehol|Remittance Advice (RNE)|R|CRS||A4|P
 sales_document|Sales Document|I|INV||A4|L
+statement_loan|Statement (Loan)|S|LON|O|A4|P
 statement_normal|Statement (Normal)|S|DRS|N|A4|P
 statement_other|Statement (Other)|S|DRS|O|A4|P
 statement_rental|Statement (Rental)|S|RTL|O|A4|P

=== modified file 'doc/BC.rst'
--- doc/BC.rst	2015-08-25 15:02:35 +0000
+++ doc/BC.rst	2015-12-05 05:45:41 +0000
@@ -107,15 +107,17 @@
 + **Retain Percentage** - What percentage of the shots of the games, not expunged, must be retained when split into groups.
 + **Number of Drawn Games** - The number of games which are randomly drawn. Enter 99 for a Round Robin.
 + **Strict S v S** - Whether the competition is strictly strength versus strength i.e. teams could play each other again before the last game.
-+ **Skins** - Whether or not to have skins.
-+ **Number of Ends per Skin** - If skins were selected then enter the number of games per skin.
-+ **Points Only** - Only points are to be captured i.e. no shots.
-+ **Points per End** - Number of points per end won.
-+ **Points per Skin** - If skins were selected then enter the number of points allocated per skin.
-+ **Points per Game** - Number of points for the game.
-+ **Bonus Points** - Whether to allocated a bonus point.
-+ **Win by More Than** - If bonus points are allocated enter the number of points which the winning margin must be more than.
-+ **Lose by Less Than** - If bonus points are allocated enter the number of points which the losing margin must be less than.
++ **Drawn Games Scoring** - Whether or not drawn games have a different scoring format from strength versus strength games.
++ **Points Format** - The formats for Drawn and Strength V Strength games.
+    + **Skins** - Whether or not to have skins.
+    + **Number of Ends per Skin** - If skins were selected then enter the number of games per skin.
+    + **Points Only** - Only points are to be captured i.e. no shots.
+    + **Points per End** - Number of points per end won.
+    + **Points per Skin** - If skins were selected then enter the number of points allocated per skin.
+    + **Points per Game** - Number of points for the game.
+    + **Bonus Points** - Whether to allocated a bonus point.
+    + **Win by More Than** - If bonus points are allocated enter the number of points which the winning margin must be more than.
+    + **Lose by Less Than** - If bonus points are allocated enter the number of points which the losing margin must be less than.
 
 Tabs Draw
 .........

=== modified file 'doc/Downloads.rst'
--- doc/Downloads.rst	2015-10-25 09:33:02 +0000
+++ doc/Downloads.rst	2015-12-12 09:12:07 +0000
@@ -11,23 +11,23 @@
 
 |tartan| Version
 ================
-The latest version of Tartan is 5.1.3 and was released on the 25th October, 2015.
+The latest version of Tartan is 5.1.4 and was released on the 12th December, 2015.
 
 Backup and restore functions must only be done with the  same version of Tartan i.e. the version used to restore a backup must be the same as the one used to make the backup.
 
 .. _Documentation: http://www.tartan.co.za/cgi-bin/simple_web.py/Documentation
-.. _Tartan-5-lnx: ftp://tartan.co.za/Tartan_5.1.3.tar.gz
+.. _Tartan-5-lnx: ftp://tartan.co.za/Tartan_5.1.4.tar.gz
 .. _Tartan-4-lnx: ftp://tartan.co.za/Tartan_4.1.14.tar.gz
 .. _Tartan-3-lnx: ftp://tartan.co.za/Tartan_3.4.51.tar.gz
 .. _Tartan-2-lnx: ftp://tartan.co.za/Tartan_2.5.29.tar.gz
-.. _Tartan-5-win: ftp://tartan.co.za/Tartan_5.1.3.exe
+.. _Tartan-5-win: ftp://tartan.co.za/Tartan_5.1.4.exe
 .. _Tartan-4-win: ftp://tartan.co.za/Tartan_4.1.14.exe
 .. _Tartan-3-win: ftp://tartan.co.za/Tartan_3.4.51.exe
 .. _Tartan-2-win: ftp://tartan.co.za/Tartan_2.5.29.exe
-.. _Bwlclb-5-lnx: ftp://tartan.co.za/Bwlclb_5.1.3.tar.gz
-.. _Bwlclb-5-win: ftp://tartan.co.za/Bwlclb_5.1.3.exe
-.. _Seccmp-5-lnx: ftp://tartan.co.za/Seccmp_5.1.3.tar.gz
-.. _Seccmp-5-win: ftp://tartan.co.za/Seccmp_5.1.3.exe
+.. _Bwlclb-5-lnx: ftp://tartan.co.za/Bwlclb_5.1.4.tar.gz
+.. _Bwlclb-5-win: ftp://tartan.co.za/Bwlclb_5.1.4.exe
+.. _Seccmp-5-lnx: ftp://tartan.co.za/Seccmp_5.1.4.tar.gz
+.. _Seccmp-5-win: ftp://tartan.co.za/Seccmp_5.1.4.exe
 
 |linux| Linux
 =============

=== modified file 'doc/LN.rst'
--- doc/LN.rst	2015-10-25 09:33:02 +0000
+++ doc/LN.rst	2015-11-23 05:59:11 +0000
@@ -99,15 +99,16 @@
 + **Batch-Number** - The batch number or blank for all.
 + **Totals Only** - Yes or No.
 
-Balances Listing
-++++++++++++++++
+Balances Listing (LN)
++++++++++++++++++++++
 Use this routine to list all existing loans.
 
 + **Sort Order** - Select whether to sort by Number or Name.
-+ **Ignore Zero Balances** - Select whether to exclude loans with zero balances.
++ **Include Zero Balances** - Select whether to include zero balance loans.
++ **Include Pending Interest** - Select whether to include pending interest.
 
-Statements
-++++++++++
+Statements (LN)
++++++++++++++++
 Use this routine to print loan statements as follows:
 
 + **Template Name** - The template to use.
@@ -115,6 +116,7 @@
 + **Whole File** - Select whether to print all statements or only selected ones.
 + **Sort Order** - Select the order in which to print the statements.
 + **Include Zero Balances** - Select whether to include zero balance loans.
++ **Include Pending Interest** - Select whether to include pending interest.
 + **Statement Date** - The statement date.
 
 Notes Listing (LN)

=== modified file 'doc/MB.rst'
--- doc/MB.rst	2015-10-25 09:33:02 +0000
+++ doc/MB.rst	2015-12-12 09:12:07 +0000
@@ -2,7 +2,7 @@
  TARTAN SYSTEMS - Bowling Clubs
 ================================
 
-:Version:   5.1.3
+:Version:   5.1.4
 :Author:    Paul Malherbe
 :Contact:   paul@tartan.co.za
 :Home:      http://www.tartan.co.za

=== modified file 'doc/MD.rst'
--- doc/MD.rst	2015-10-25 09:33:02 +0000
+++ doc/MD.rst	2015-12-12 09:12:07 +0000
@@ -2,7 +2,7 @@
  Tartan Systems - User Manual
 ==============================
 
-:Version:   5.1.3
+:Version:   5.1.4
 :Author:    Paul Malherbe
 :Contact:   paul@tartan.co.za
 :Home:      http://www.tartan.co.za

=== modified file 'drs/dr3080.py'
--- drs/dr3080.py	2015-10-25 09:33:02 +0000
+++ drs/dr3080.py	2015-11-25 10:37:01 +0000
@@ -178,19 +178,19 @@
             where=[("chm_chain", "=", w)], limit=1)
         if not chk:
             return "Invalid Chain Store"
-        if c == 4:
+        if c == 5:
             self.schn = w
         else:
             self.echn = w
 
     def doAcc(self, frt, pag, r, c, p, i, w):
-        if self.chains == "Y" and c == 5:
+        if self.chains == "Y" and c == 6:
             chk = self.schn
             self.sacc = w
-        elif self.chains == "Y" and c == 7:
+        elif self.chains == "Y" and c == 8:
             chk = self.echn
             self.eacc = w
-        elif c == 4:
+        elif c == 5:
             chk = self.schn
             self.sacc = w
         else:
@@ -406,7 +406,7 @@
             ext="pdf")
         self.form.output(pdfnam, "F")
         doPrinter(mf=self.opts["mf"], conum=self.opts["conum"], pdfnam=pdfnam,
-            head="%s STATEMENT at %s" % (self.opts["conam"], self.dated),
+            head="%s Statement at %s" % (self.opts["conam"], self.dated),
             repprt=self.df.repprt, repeml=self.df.repeml)
         if self.df.repeml[1] == "Y":
             self.form = DrawForm(self.opts["mf"].dbm, self.tname,

=== modified file 'drs/dr6010.py'
--- drs/dr6010.py	2014-12-30 15:37:38 +0000
+++ drs/dr6010.py	2015-10-26 06:17:14 +0000
@@ -76,7 +76,7 @@
         fld = [
             (("T",0,0,0),"I@drm_chain",0,"Old Chain","Old Chain Number",
                 "","Y",self.doOldChn,chn,None,("efld",)),
-            (["T",0,0,12],"I@drm_acno",0,"Old Account","Old Account Number",
+            (["T",0,0,12],"IRW",7,"Old Account","Old Account Number",
                 "","Y",self.doOldAcc,drm,None,("notblank",)),
             (["T",0,0,30],"O@drm_name",0,""),
             (("T",0,1,0),"I@drm_chain",0,"New Chain","New Chain Number",

=== modified file 'gen/gl3050.py'
--- gen/gl3050.py	2015-10-03 07:36:56 +0000
+++ gen/gl3050.py	2015-12-09 20:27:11 +0000
@@ -333,24 +333,26 @@
                     if not self.num:
                         self.num = "Y"
                     if not rep[col.index("gls_prnt")]:
-                        self.view = "N"
+                        self.repprt[1] = "N"
                         self.repprt[2] = ""
                         self.pdfnam = getModName(self.opts["mf"].
                             rcdic["wrkdir"], __name__, "%s_%s" %
                             (self.opts["conum"], seq), ext="pdf")
                     elif rep[col.index("gls_prnt")] == "Export":
-                        self.view = "X"
+                        self.repprt[1] = "X"
                         self.repprt[2] = "export"
                         self.pdfnam = getModName(self.opts["mf"].
                             rcdic["wrkdir"], __name__, "%s_%s" %
                             (self.opts["conum"], seq))
                     else:
-                        self.view = "N"
+                        self.repprt[1] = "N"
                         self.repprt[2] = rep[col.index("gls_prnt")]
                         self.pdfnam = getModName(self.opts["mf"].
                             rcdic["wrkdir"], __name__, "%s_%s" %
                             (self.opts["conum"], seq), ext="pdf")
-                    self.mail = rep[col.index("gls_mail")]
+                    if rep[col.index("gls_mail")]:
+                        self.repeml[1] = "Y"
+                        self.repeml[2] = rep[col.index("gls_mail")]
                     if self.typ == "C":
                         if self.doReadCustomReport("stream") or not self.cols:
                             continue
@@ -811,7 +813,7 @@
         if self.typ in ("C", "L", "S"):
             rtype = "Y"
         else:
-            rtype = "M"
+            rtype = "Y"
         ####################################################################
         self.allfields = []
         for dep in self.dpl:

=== modified file 'gen/gl3100_rne.py'
--- gen/gl3100_rne.py	2015-10-03 07:36:56 +0000
+++ gen/gl3100_rne.py	2015-12-04 11:02:34 +0000
@@ -81,7 +81,7 @@
         cnd = ((self.doEnd,"n"),)
         cxt = (self.doExit,)
         self.df = TartanDialog(self.opts["mf"], tops=False, title=tit,
-            rows=[10], eflds=fld, butt=but, tend=tnd, txit=txt, cend=cnd,
+            rows=[12], eflds=fld, butt=but, tend=tnd, txit=txt, cend=cnd,
             cxit=cxt, view=("Y","V"), mail=("Y","N"))
 
     def doFP(self, frt, pag, r, c, p, i, w):
@@ -110,7 +110,7 @@
 
     def doTBG(self, frt, pag, r, c, p, i, w):
         self.seqdic = {}
-        for x in range(1, 11):
+        for x in range(1, 13):
             self.seqdic[x] = [0, "", ""]
         if w:
             acc = self.sql.getRec(tables="ctlgrp",
@@ -145,7 +145,7 @@
         self.tbh = w
 
     def doSeq(self, frt, pag, r, c, p, i, w):
-        if not w or w > 10:
+        if not w or w > 12:
             return "Invalid Sequence Number"
         self.seq = w
 
@@ -170,12 +170,12 @@
         olddic = copy.deepcopy(self.seqdic)
         self.seqdic = {}
         seq = 1
-        for x in range(1, 11):
+        for x in range(1, 13):
             if x == self.seq:
                 continue
             self.seqdic[seq] = olddic[x]
             seq += 1
-        for x in range(seq, 11):
+        for x in range(seq, 13):
             self.seqdic[x] = [0, "", ""]
         self.df.focusField("C", 0, self.doReload() + 1)
 
@@ -201,7 +201,7 @@
     def doReload(self):
         self.df.clearFrame("C", 0)
         idx = 0
-        for x in range(1, 11):
+        for x in range(1, 13):
             if not self.seqdic[x][0]:
                 continue
             self.df.loadEntry("C", 0, idx, data=x)
@@ -209,7 +209,7 @@
             self.df.loadEntry("C", 0, idx+2, data=self.seqdic[x][1])
             self.df.loadEntry("C", 0, idx+3, data=self.seqdic[x][2])
             idx += 4
-        if idx == 40:
+        if idx == 48:
             idx -= 4
         return idx
 
@@ -223,7 +223,7 @@
                 data = [self.grp, self.tbh]
             coys = []
             coyd = ""
-            for x in range(1, 11):
+            for x in range(1, 13):
                 if self.grp:
                     data.extend([self.seqdic[x][0], self.seqdic[x][2]])
                 if not self.seqdic[x][0]:

=== modified file 'gen/gl3110_rne.py'
--- gen/gl3110_rne.py	2015-10-03 07:36:56 +0000
+++ gen/gl3110_rne.py	2015-11-23 08:32:44 +0000
@@ -167,11 +167,10 @@
             for coy in coys:
                 callModule(self.opts["mf"], None, "gl3040", coy=(coy[0],
                     coy[1]), period=self.c_per, args=(self.ep, self.iz,
-                    self.df.repprt, self.fpdf))
+                    self.df.repprt, self.repeml, self.fpdf))
             self.fpdf.output(pdfnam, "F")
             doPrinter(mf=self.opts["mf"], pdfnam=pdfnam, head=tit,
-                repprt=self.df.repprt,
-                repeml=self.df.repeml)
+                repprt=self.df.repprt, repeml=self.df.repeml)
         if self.fs == "Y":
             tit = "Financial Statements as at %s for Companies %s" % (self.epd,
                 coyd)
@@ -187,11 +186,11 @@
             for coy in coys:
                 callModule(self.opts["mf"], None, "gl3050", coy=(coy[0],
                     coy[1]), period=self.c_per, args=(self.ep, self.rt,
-                    self.rn, self.rv, "P", self.iz, self.df.repprt, self.fpdf))
+                    self.rn, self.rv, "P", self.iz, self.df.repprt,
+                    self.df.repeml, self.fpdf))
             self.fpdf.output(pdfnam, "F")
             doPrinter(mf=self.opts["mf"], pdfnam=pdfnam, head=tit,
-                repprt=self.df.repprt,
-                repeml=self.df.repeml)
+                repprt=self.df.repprt, repeml=self.df.repeml)
         self.opts["mf"].closeLoop()
 
     def doExit(self):

=== modified file 'gen/gl6060.py'
--- gen/gl6060.py	2015-10-25 09:33:02 +0000
+++ gen/gl6060.py	2015-11-22 07:44:36 +0000
@@ -20,8 +20,14 @@
     def __init__(self, **opts):
         self.opts = opts
         if self.setVariables():
-            self.mainProcess()
-            self.opts["mf"].startLoop()
+            if "args" in self.opts:
+                self.gtype = "B"
+                self.ctlacc = self.opts["args"][0]
+                for rec in self.opts["args"][1]:
+                    self.doMerge(rec)
+            else:
+                self.mainProcess()
+                self.opts["mf"].startLoop()
 
     def setVariables(self):
         sql = Sql(self.opts["mf"].dbm, "ftable", prog=__name__)

=== modified file 'lon/ln1010.py'
--- lon/ln1010.py	2015-10-03 07:36:56 +0000
+++ lon/ln1010.py	2015-12-11 07:03:08 +0000
@@ -66,7 +66,7 @@
                 "","N",None,None,None,("efld",)),
             (("T",0,4,0),"ITX",30,"Address Line 3","",
                 "","N",None,None,None,("efld",)),
-            (("T",0,5,0),"IUI",4,"Postal Code","",
+            (("T",0,5,0),"ITX",4,"Postal Code","",
                 "","N",None,None,None,("efld",)),
             (("T",0,6,0),"ITX",20,"Telephone Number","",
                 "","N",None,None,None,("efld",)),
@@ -98,17 +98,18 @@
                 "=", self.opts["conum"]), ("lm1_acno", "=", w)], limit=1)
             if not self.oldacc:
                 return "Invalid Account Number"
-            self.newacc = False
             self.acno = w
             self.name = self.oldacc[self.sql.lonmf1_col.index("lm1_name")]
             self.email = self.oldacc[self.sql.lonmf1_col.index("lm1_email")]
             for num, dat in enumerate(self.oldacc[1:]):
                 self.df.loadEntry("T", 0, num, data=dat)
+            self.newacc = False
         else:
             yn = askQuestion(self.opts["mf"].body, "New Account",
                 "Is This a New Loan Account?", default="no")
             if yn == "no":
                 return "Invalid Account Number"
+            self.newacc = True
 
     def doName(self, frt, pag, r, c, p, i, w):
         if self.newacc:

=== modified file 'lon/ln3030.py'
--- lon/ln3030.py	2015-10-25 09:33:02 +0000
+++ lon/ln3030.py	2015-11-24 09:05:57 +0000
@@ -47,8 +47,10 @@
                 self.sysdtw,"Y",self.doDate,None,None,("efld",)),
             (("T",0,1,0),("IRB",r1s),1,"Sort Order","",
                 "N","Y",self.doSort,None,None,None),
-            (("T",0,2,0),("IRB",r2s),1,"Ignore Zero Balances","",
-                "Y","Y",self.doZero,None,None,None))
+            (("T",0,2,0),("IRB",r2s),1,"Include Zero Balances","",
+                "N","Y",self.doZero,None,None,None),
+            (("T",0,3,0),("IRB",r2s),1,"Include Pending Interest","",
+                "N","Y",self.doPend,None,None,None))
         tnd = ((self.doEnd,"Y"), )
         txt = (self.doExit, )
         self.df = TartanDialog(self.opts["mf"], title=self.tit, eflds=fld,
@@ -64,6 +66,9 @@
     def doZero(self, frt, pag, r, c, p, i, w):
         self.zero = w
 
+    def doPend(self, frt, pag, r, c, p, i, w):
+        self.pend = w
+
     def doEnd(self):
         self.df.closeProcess()
         if self.sort == "N":
@@ -81,10 +86,16 @@
 
     def printReport(self, recs):
         p = ProgressBar(self.opts["mf"].body, mxs=len(recs), esc=True)
-        self.head = ("%03u %-30s %52s %6s" % \
-            (self.opts["conum"], self.opts["conam"], self.sysdttm, __name__))
+        if self.pend == "Y":
+            self.head = ("%03u %-30s %80s %6s" % (self.opts["conum"],
+                self.opts["conam"], self.sysdttm, __name__))
+        else:
+            self.head = ("%03u %-30s %52s %6s" % (self.opts["conum"],
+                self.opts["conam"], self.sysdttm, __name__))
         self.fpdf = MyFpdf(name=__name__, head=self.head)
-        tots = 0
+        ltot = 0
+        itot = 0
+        ntot = 0
         self.pgnum = 0
         self.pglin = 999
         for num, rec in enumerate(recs):
@@ -100,25 +111,46 @@
                 lon = CCD(dat[self.sql.lonmf2_col.index("lm2_loan")], "UI", 2)
                 des = CCD(dat[self.sql.lonmf2_col.index("lm2_desc")], "NA", 30)
                 dte = CCD(dat[self.sql.lonmf2_col.index("lm2_start")], "d1", 10)
-                LoanInterest("L", self.opts["mf"].dbm, dat, update="Y",
-                    tdate=self.date, batch="Pending", curdt=self.date / 100)
-                lbal = self.sql.getRec(tables="lontrn", cols=["sum(lnt_tramt)"],
-                    where=[("lnt_cono", "=", self.opts["conum"]), ("lnt_acno",
-                    "=", acc.work), ("lnt_loan", "=", lon.work)], limit=1)
-                bal = CCD(lbal[0], "SD", 13.2)
-                if self.zero == "Y" and not bal.work:
+                col = ["sum(lnt_tramt)"]
+                whr = [
+                    ("lnt_cono", "=", self.opts["conum"]),
+                    ("lnt_acno", "=", acc.work),
+                    ("lnt_loan", "=", lon.work)]
+                lbal = self.sql.getRec(tables="lontrn", cols=col, where=whr,
+                    limit=1)
+                lbal = CCD(lbal[0], "SD", 13.2)
+                if self.zero == "N" and not lbal.work:
                     continue
-                tots = float(ASD(tots) + ASD(bal.work))
                 if self.pglin > self.fpdf.lpp:
                     self.pageHeading()
-                self.fpdf.drawText("%s %s %s %s %s %s" % (acc.disp,
-                    nam.disp, lon.disp, des.disp, dte.disp, bal.disp))
+                ltot = float(ASD(ltot) + ASD(lbal.work))
+                if self.pend == "Y":
+                    LoanInterest("L", self.opts["mf"].dbm, dat, update="Y",
+                        tdate=self.date, batch="Pending", curdt=self.date / 100)
+                    nbal = self.sql.getRec(tables="lontrn", cols=col,
+                        where=whr, limit=1)
+                    nbal = CCD(nbal[0], "SD", 13.2)
+                    ntot = float(ASD(ntot) + ASD(nbal.work))
+                    ibal = CCD(nbal.work - lbal.work, "SD", 13.2)
+                    itot = float(ASD(itot) + ASD(ibal.work))
+                    self.fpdf.drawText("%s %s %s %s %s %s %s %s" % (acc.disp,
+                        nam.disp, lon.disp, des.disp, dte.disp, lbal.disp,
+                        ibal.disp, nbal.disp))
+                else:
+                    self.fpdf.drawText("%s %s %s %s %s %s" % (acc.disp,
+                        nam.disp, lon.disp, des.disp, dte.disp, lbal.disp))
                 self.pglin += 1
         p.closeProgress()
         if self.fpdf.page and not p.quit:
-            tots = CCD(tots, "SD", 13.2)
             self.fpdf.underLine(txt=self.head)
-            self.fpdf.drawText("%8s%-74s%13s" % ("", "Totals", tots.disp))
+            ltot = CCD(ltot, "SD", 13.2)
+            if self.pend == "Y":
+                itot = CCD(itot, "SD", 13.2)
+                ntot = CCD(ntot, "SD", 13.2)
+                self.fpdf.drawText("%8s%-74s%13s %13s %13s" % ("", "Totals",
+                    ltot.disp, itot.disp, ntot.disp))
+            else:
+                self.fpdf.drawText("%8s%-74s%13s" % ("", "Totals", ltot.disp))
             pdfnam = getModName(self.opts["mf"].rcdic["wrkdir"], __name__,
                 self.opts["conum"], ext="pdf")
             self.fpdf.output(pdfnam, "F")
@@ -132,14 +164,25 @@
         self.pgnum += 1
         self.fpdf.drawText(self.head)
         self.fpdf.drawText()
-        self.fpdf.drawText("%-29s %-10s %47s %5s" % \
-            ("Loans Balances Listing as at", self.sysdtd, "Page", self.pgnum))
+        if self.pend == "Y":
+            txt = "%-29s %-10s %75s %5s" % ("Loans Balances Listing as at",
+                self.sysdtd, "Page", self.pgnum)
+        else:
+            txt = "%-29s %-10s %47s %5s" % ("Loans Balances Listing as at",
+                self.sysdtd, "Page", self.pgnum)
+        self.fpdf.drawText(txt=txt)
         self.fpdf.drawText()
         self.fpdf.drawText("%s %s  %s %s)" % \
-            ("(Options: Sort:", self.sort, "Ignore-Zero-Bal:", self.zero))
+            ("(Options: Sort:", self.sort, "Include-Zero-Bal:", self.zero))
         self.fpdf.drawText()
-        self.fpdf.drawText("%-7s %-28s %-2s %-30s %-10s %13s" % \
-            ("Acc-Num", "Name", "Ln", "Description", "Start-Date", "Balance "))
+        txt = "%-7s %-28s %-2s %-30s %-10s" % \
+            ("Acc-Num", "Name", "Ln", "Description", "Start-Date")
+        if self.pend == "Y":
+            txt = "%s %13s %13s %13s" % \
+                (txt, "Ledger-Bal ", "Interest ", "Balance ")
+        else:
+            txt = "%s %13s" % (txt, "Balance ")
+        self.fpdf.drawText(txt=txt)
         self.fpdf.underLine(txt=self.head)
         self.fpdf.setFont()
         self.pglin = 8

=== modified file 'lon/ln3040.py'
--- lon/ln3040.py	2015-10-25 09:33:02 +0000
+++ lon/ln3040.py	2015-12-02 11:22:47 +0000
@@ -14,10 +14,10 @@
 """
 
 import time
-from TartanClasses import ASD, DrawForm, GetCtl, LoanInterest, ProgressBar
+from TartanClasses import ASD, CCD, DrawForm, GetCtl, LoanInterest, ProgressBar
 from TartanClasses import Sql, TartanDialog
-from tartanFunctions import doPrinter, getModName, getSingleRecords, copyList
-from tartanFunctions import showError
+from tartanFunctions import copyList, doPrinter, getModName, getSingleRecords
+from tartanFunctions import mthendDate, showError
 from tartanWork import lntrtp
 
 class ln3040:
@@ -32,14 +32,14 @@
         lonctl = gc.getCtl("lonctl", self.opts["conum"])
         if not lonctl:
             return
+        self.stpl = lonctl["cln_tplnam"]
         t = time.localtime()
         self.sysdtw = (t[0] * 10000) + (t[1] * 100) + t[2]
+        self.curdt = self.sysdtw / 100
         self.sql = Sql(self.opts["mf"].dbm, ["ctlmes", "ctlmst", "lonmf1",
             "lonmf2", "lontrn", "tplmst"], prog=__name__)
         if self.sql.error:
             return
-        #self.stpl = lonctl["ctd_tplnam"]
-        self.stpl = "statement_loan"
         return True
 
     def mainProcess(self):
@@ -60,16 +60,18 @@
         fld = (
             (("T",0,0,0),"INA",20,"Template Name","",
                 self.stpl,"Y",self.doTplNam,tpm,None,None),
-            (("T",0,1,0),"IUI",2,"Maximum Pages","",
-                1,"Y",self.doPages,None,None,None),
-            (("T",0,2,0),("IRB",r1s),0,"Whole File","",
-                "N","Y",self.doWhole,None,None,None),
-            (("T",0,3,0),("IRB",r2s),0,"Sort Order","",
-                "A","Y",self.doSort,None,None,None),
-            (("T",0,4,0),("IRB",r1s),0,"Include Zero Balances","",
-                "N","Y",self.doZeros,None,None,None),
-            (("T",0,5,0),"ID1",10,"Statement Date","",
-                self.sysdtw,"Y",self.doDate,None,None,("efld",)))
+            (("T",0,1,0),"Id2",7,"Start Period","",
+                0,"N",self.doSPer,None,None,None),
+            (("T",0,2,0),"ID2",7,"End Period","",
+                self.curdt,"N",self.doEPer,None,None,None),
+            (("T",0,3,0),("IRB",r1s),0,"Whole File","",
+                "N","N",self.doWhole,None,None,None),
+            (("T",0,4,0),("IRB",r2s),0,"Sort Order","",
+                "A","N",self.doSort,None,None,None),
+            (("T",0,5,0),("IRB",r1s),0,"Include Zero Balances","",
+                "N","N",self.doZeros,None,None,None),
+            (("T",0,6,0),("IRB",r1s),0,"Include Pending Interest","",
+                "N","N",self.doPend,None,None,None))
         tnd = ((self.doEnd,"Y"), )
         txt = (self.doExit, )
         self.df = TartanDialog(self.opts["mf"], title=tit, eflds=fld,
@@ -82,8 +84,14 @@
             return "Invalid Template Name"
         self.tname = w
 
-    def doPages(self, frt, pag, r, c, p, i, w):
-        self.pages = w
+    def doSPer(self, frt, pag, r, c, p, i, w):
+        self.sperw = w
+        self.sperd = self.df.t_disp[pag][0][p]
+
+    def doEPer(self, frt, pag, r, c, p, i, w):
+        self.eperw = w
+        self.eperd = self.df.t_disp[pag][0][p]
+        self.date = CCD(mthendDate((w * 100) + 1), "D1", 10)
 
     def doWhole(self, frt, pag, r, c, p, i, w):
         self.whole = w
@@ -94,10 +102,8 @@
     def doZeros(self, frt, pag, r, c, p, i, w):
         self.zeros = w
 
-    def doDate(self, frt, pag, r, c, p, i, w):
-        self.datew = w
-        self.dated = self.df.t_disp[pag][0][p]
-        self.curdt = w / 100
+    def doPend(self, frt, pag, r, c, p, i, w):
+        self.pend = w
 
     def doEnd(self):
         self.df.closeProcess()
@@ -148,7 +154,7 @@
                 self.form.tptp[fld][1] = dat
         if "letterhead" in self.form.tptp:
             self.form.letterhead(cmc, ctm, "letterhead", None)
-        self.form.document_date(self.dated)
+        self.form.document_date(self.date.disp)
         self.form.bank_details(cmc, ctm, 0)
 
     def doProcess(self, lm1):
@@ -170,55 +176,63 @@
 
     def doStatement(self, tdc, lm2):
         l2c = self.sql.lonmf2_col
-        ltc = self.sql.lontrn_col
+        ltc = copyList(self.sql.lontrn_col)
         self.loan = lm2[l2c.index("lm2_loan")]
         for col in l2c:
             d = "%s_C00" % col
             if d in self.form.newdic:
                 dat = lm2[l2c.index(col)]
                 self.form.newdic[d][tdc.index("tpd_text")] = dat
-        # Raise Interest
-        LoanInterest("L", self.opts["mf"].dbm, lm2, update="Y",
-            tdate=self.datew, batch="Pending", curdt=self.curdt, capnm="")
+        if self.pend == "Y":
+            # Raise Pending Interest
+            LoanInterest("L", self.opts["mf"].dbm, lm2, update="Y",
+                tdate=self.date.work, batch="Pending", curdt=self.curdt,
+                capnm="")
         # Get Transactions
         whr = [
             ("lnt_cono", "=", self.opts["conum"]),
             ("lnt_acno", "=", self.acno),
-            ("lnt_loan", "=", self.loan)]
-        odr = "lnt_trdt, lnt_type, lnt_refno"
+            ("lnt_loan", "=", self.loan),
+            ("lnt_curdt", "<=", self.eperw)]
+        odr = "lnt_curdt, lnt_trdt, lnt_type, lnt_refno"
         trns = self.sql.getRec(tables="lontrn", where=whr, order=odr)
         if not trns:
             return
+        self.bal = 0
         self.tots = 0
-        for t in trns:
-            self.tots = float(ASD(self.tots) + ASD(t[ltc.index("lnt_tramt")]))
+        if self.sperw:
+            obal = 0
+            trans = copyList(trns)
+            for trn in trans:
+                tramt = trn[self.sql.lontrn_col.index("lnt_tramt")]
+                if trn[self.sql.lontrn_col.index("lnt_curdt")] < self.sperw:
+                    obal = float(ASD(obal) + ASD(tramt))
+                    trns.remove(trn)
+            trn[ltc.index("lnt_type")] = 3
+            trn[ltc.index("lnt_trdt")] = (self.sperw * 100) + 1
+            trn[ltc.index("lnt_refno")] = "O/Bal"
+            trn[ltc.index("lnt_batch")] = ""
+            trn[ltc.index("lnt_tramt")] = obal
+            trn[ltc.index("lnt_desc")] = "Opening Balance"
+            trn[ltc.index("lnt_batind")] = ""
+            trns.insert(0, trn)
+        trans = []
+        for trn in trns:
+            tramt = trn[ltc.index("lnt_tramt")]
+            self.tots = float(ASD(self.tots) + ASD(tramt))
+            if tramt < 0:
+                trn.extend([0, tramt])
+            else:
+                trn.extend([tramt, 0])
+            trans.append(trn)
+        ltc.extend(["line_debit", "line_credit"])
         if self.zeros == "N" and not self.tots:
             return
-        if not len(trns) > self.form.maxlines:
-            self.doBody(ltc, trns, tdc)
-        else:
-            pages = len(trns) / self.form.maxlines
-            if len(trns) % self.form.maxlines:
-                pages += 1
-            if not pages > self.pages:
-                self.doBody(ltc, trns, tdc)
-            else:
-                bal = 0
-                lines = len(trns) - (self.pages * self.form.maxlines) + 1
-                for _ in xrange(lines):
-                    trn = trns.pop(0)
-                    bal = float(ASD(bal) + ASD(trn[ltc.index("lnt_tramt")]))
-                trn[ltc.index("lnt_type")] = 3
-                trn[ltc.index("lnt_refno")] = "B/FWD"
-                trn[ltc.index("lnt_batch")] = ""
-                trn[ltc.index("lnt_tramt")] = bal
-                trn[ltc.index("lnt_desc")] = "Balance Brought Forward"
-                trn[ltc.index("lnt_batind")] = ""
-                trns.insert(0, trn)
-                self.doBody(ltc, trns, tdc)
+        self.doBody(ltc, trans, tdc)
         self.doTotal(tdc)
         self.doTail(tdc)
-        self.opts["mf"].dbm.rollbackDbase()
+        if self.pend == "Y":
+            self.opts["mf"].dbm.rollbackDbase()
         if self.df.repeml[1] == "Y" and not self.emadd:
             self.df.repeml[2] = self.emlto
             self.doPrint()
@@ -232,7 +246,7 @@
             ext="pdf")
         self.form.output(pdfnam, "F")
         doPrinter(mf=self.opts["mf"], conum=self.opts["conum"], pdfnam=pdfnam,
-            head="%s STATEMENT at %s" % (self.opts["conam"], self.dated),
+            head="%s Statement at %s" % (self.opts["conam"], self.date.disp),
             repprt=self.df.repprt, repeml=self.df.repeml)
         if self.df.repeml[1] == "Y":
             self.form = DrawForm(self.opts["mf"].dbm, self.tname,
@@ -256,14 +270,18 @@
                     c = "lnt_type"
                 elif cod == "line_paid":
                     c = "paid"
-                elif cod == "line_balance":
-                    c = "balance"
                 else:
                     c = cod
                 d = "%s_C%02i" % (cod, count)
                 if cod == "type_code":
                     ttyp = trans[ltc.index(c)]
                     self.form.newdic[d][text] = lntrtp[ttyp - 1][0]
+                elif c in ("line_debit", "line_credit"):
+                    tramt = trans[ltc.index(c)]
+                    self.bal = float(ASD(self.bal) + ASD(tramt))
+                    self.form.newdic[d][text] = trans[ltc.index(c)]
+                elif c == "line_balance":
+                    self.form.newdic[d][text] = self.bal
                 else:
                     self.form.newdic[d][text] = trans[ltc.index(c)]
                 self.form.doDrawDetail(self.form.newdic[d])

=== modified file 'lon/ln4010.py'
--- lon/ln4010.py	2015-10-04 09:29:52 +0000
+++ lon/ln4010.py	2015-11-23 06:37:44 +0000
@@ -106,6 +106,15 @@
         self.name = acc[0]
         self.history = "Y"
         self.df.loadEntry("T", pag, p+1, data=self.name)
+        chk = self.sql.getRec(tables="lonmf2", cols=["lm2_loan"],
+            where=[("lm2_cono", "=", self.opts["conum"]),
+            ("lm2_acno", "=", self.acno)])
+        if not chk:
+            return "No Loans"
+        if len(chk) == 1:
+            self.df.loadEntry(frt, pag, p+2, data=chk[0][0])
+            self.df.doKeyPressed(frt, pag, p+2, chk[0][0])
+            return "nd"
 
     def doLoan(self, frt, pag, r, c, p, i, w):
         lonmf2 = self.sql.getRec(tables="lonmf2", where=[("lm2_cono", "=",
@@ -209,6 +218,7 @@
         self.df.enableButtonsTags(state=state)
 
     def doClear(self, widget=None):
+        self.opts["mf"].dbm.rollbackDbase()
         self.df.selPage("General")
         self.df.focusField("T", 0, 1)
 

=== modified file 'lon/ln6010.py'
--- lon/ln6010.py	2015-10-03 07:36:56 +0000
+++ lon/ln6010.py	2015-10-26 06:30:26 +0000
@@ -55,7 +55,7 @@
                 ("lm1_addr1", "", 0, "Address Line 1")],
             "where": [("lm1_cono", "=", self.opts["conum"])]}
         fld = (
-            (("T",0,0,0),"I@lm1_acno",0,"Old Account","Old Account Number",
+            (("T",0,0,0),"IRW",7,"Old Account","Old Account Number",
                 "","Y",self.doOldAcc,lm1,None,("notblank",)),
             (("T",0,0,0),"O@lm1_name",0,""),
             (("T",0,1,0),"I@lm1_acno",0,"New Account","New Account Number",

=== modified file 'lon/lnc110.py'
--- lon/lnc110.py	2015-10-03 07:36:56 +0000
+++ lon/lnc110.py	2015-11-28 15:09:46 +0000
@@ -32,7 +32,7 @@
             if mods[x:x + 2] == "GL":
                 self.genleg = True
                 break
-        tabs = ["lonctl", "chglog"]
+        tabs = ["lonctl", "tplmst", "chglog"]
         if self.genleg:
             tabs.extend(["ctlctl", "genmst"])
         self.sql = Sql(self.opts["mf"].dbm, tabs, prog=__name__)
@@ -42,7 +42,8 @@
             self.opts["conum"])], limit=1)
         if not self.acc:
             self.new = True
-            self.acc = [self.opts["conum"], "N", "D", "A", "A", 0, 0, 0]
+            self.acc = [self.opts["conum"], "N", "D", "A", "A", 0, 0, 0,
+                "statement_loan"]
         else:
             self.new = False
         if self.genleg:
@@ -59,6 +60,17 @@
     def drawDialog(self):
         tit = ("%03i %s" % (self.opts["conum"], self.opts["conam"]),
                 "Loans Control File Maintenance (%s)" % __name__)
+        tpm = {
+            "stype": "R",
+            "tables": ("tplmst",),
+            "cols": (
+                ("tpm_tname", "", 0, "Template"),
+                ("tpm_title", "", 0, "Title"),
+                ("tpm_type", "", 0, "T")),
+            "where": [
+                ("tpm_type", "=", "S"),
+                ("tpm_system", "=", "LON")],
+            "order": "tpm_tname"}
         r1s = (("Yes","Y"),("No","N"))
         r2s = (("Daily","D"),("Monthly","M"))
         r3s = (("Anniversary","A"),("Financial","F"))
@@ -100,7 +112,9 @@
             (("T",0,seq + 4,0),"IUD",6.2,"Credit Rate","",
                 self.acc[6],"N",None,None,None,("efld",)),
             (("T",0,seq + 5,0),"Id1",10.0,"Last Interest Date","",
-                self.acc[7],"N",None,None,None,("efld",))])
+                self.acc[7],"N",None,None,None,("efld",)),
+            (("T",0,seq + 6,0),"INA",20,"Statement Template","",
+                self.acc[8],"N",self.doTplNam,tpm,None,("efld",))])
         but = (
             ("Accept",None,self.doAccept,0,("T",0,1),("T",0,0)),
             ("Quit",None,self.doExit,1,None,None))
@@ -144,6 +158,12 @@
         else:
             return ""
 
+    def doTplNam(self, frt, pag, r, c, p, i, w):
+        acc = self.sql.getRec(tables="tplmst", where=[("tpm_tname", "=", w),
+            ("tpm_type", "=", "S"), ("tpm_system", "=", "LON")], limit=1)
+        if not acc:
+            return "Invalid Template"
+
     def doEnd(self):
         data = [self.opts["conum"]]
         if not self.genleg:

=== modified file 'mem/ml3040.py'
--- mem/ml3040.py	2015-10-03 07:36:56 +0000
+++ mem/ml3040.py	2015-11-25 10:38:01 +0000
@@ -725,7 +725,7 @@
             key, ext="pdf")
         self.form.output(pdfnam, "F")
         doPrinter(mf=self.opts["mf"], conum=self.opts["conum"], pdfnam=pdfnam,
-            head="%s STATEMENT at %s" % (self.opts["conam"], self.dated),
+            head="%s Statement at %s" % (self.opts["conam"], self.dated),
             repprt=self.repprt, repeml=self.repeml)
         if self.repeml[1] == "Y":
             self.form = DrawForm(self.opts["mf"].dbm, self.tname,

=== modified file 'men/rnemen.py'
--- men/rnemen.py	2015-10-25 09:33:02 +0000
+++ men/rnemen.py	2015-11-22 05:25:28 +0000
@@ -31,6 +31,7 @@
     ["gl", "General Ledger"],
     ["cr", "Creditor's Ledger"],
     ["ar", "Asset's Register"],
+    ["ln", "Loan's Ledger"],
     ["rt", "Rental's Ledger"],
     ["dr", "Debtor's Ledger"],
     ["st", "Store's Ledger"],
@@ -45,6 +46,7 @@
     ["MM","mm_gl", "General Ledger"],
     ["MM","mm_cr", "Creditor's Ledger"],
     ["MM","mm_ar", "Asset's Register"],
+    ["MM","mm_ln","Loan's Ledger"],
     ["MM","mm_rt", "Rental's Ledger"],
     ["MM","mm_dr", "Debtor's Ledger"],
     ["MM","mm_st", "Stores's Ledger"],
@@ -188,6 +190,29 @@
     ["PNNN","ar_tb","ar6030",5,"Un-Sell an Asset"],
     ["PYYY","mm_ar","ar4010",0,"Interrogation"]]
 
+# Loan's Ledger
+lnmen = [
+    ["CM","mm_ln","ln_fm","File Maintenance"],
+    ["CM","mm_ln","ln_dc","Data Capture"],
+    ["CM","mm_ln","ln_rp","Reporting"],
+    ["CM","mm_ln","ln_tb","Toolbox"]]
+lnmod = [
+    ["PYNY","ln_fm","lnc110",5,"Control Record"],
+    ["PYNY","ln_fm","ln1010",3,"Loans Masterfile"],
+    ["PYYY","ln_dc","ln2010",2,"Payments",1],
+    ["PYYY","ln_dc","ln2010",2,"Receipts",2],
+    ["PYYY","ln_dc","ln2010",2,"Journals",3],
+    ["PYYY","ln_dc","ln2010",2,"Interest Adjustments",4],
+    ["PYYY","ln_dc","ln2020",2,"Raise Interest",0],
+    ["PYYY","ln_dc","ln2030",2,"Rate Change",0],
+    ["PYNN","ln_rp","ln3010",1,"Batch Error Listing"],
+    ["PYYN","ln_rp","ln3020",1,"Transaction Audit Trail"],
+    ["PYNN","ln_rp","ln3030",1,"Balances Listing"],
+    ["PYNN","ln_rp","ln3040",1,"Statements"],
+    ["PYNN","ln_rp","ln3050",1,"Notes Listing"],
+    ["PYNN","ln_tb","ln6010",5,"Change Account Numbers"],
+    ["PYLY","mm_ln","ln4010",0,"Interrogation"]]
+
 # Rental's System
 rtmen = [
     ["CM","mm_rt","rt_fm","File Maintenance"],

=== modified file 'men/stdmen.py'
--- men/stdmen.py	2015-10-25 09:33:02 +0000
+++ men/stdmen.py	2015-11-22 05:25:20 +0000
@@ -34,6 +34,7 @@
     ["st", "Store's Ledger"],
     ["si", "Sales Invoicing"],
     ["ar", "Asset's Register"],
+    ["bk", "Booking's Manager"],
     ["ln", "Loan's Ledger"],
     ["ml", "Member's Ledger"],
     ["rt", "Rental's Ledger (Basic)"],
@@ -41,7 +42,6 @@
     ["wg", "Salaries & Wages"],
     ["sl", "Staff Loans"],
     ["bc", "Bowling Clubs"],
-    ["bk", "Booking's Manager"],
     ["rp", "Reporting Tools"],
     ["td", "Telephone Directory"]]
 

=== modified file 'mst/ms0000.py'
--- mst/ms0000.py	2015-10-25 09:33:02 +0000
+++ mst/ms0000.py	2015-12-12 09:12:07 +0000
@@ -1,3 +1,5 @@
+#! /usr/bin/env python
+
 """
 SYNOPSIS
     This file is part of Tartan Systems (TARTAN).
@@ -34,7 +36,7 @@
     temp = tuple(os.environ["TARVER"].split("."))
     VERSION = (int(temp[0]), int(temp[1]), int(temp[2]))
 else:
-    VERSION = (5, 1, 3)
+    VERSION = (5, 1, 4)
 if __name__ == "__main__":
     # Run Tartan
     try:

=== modified file 'mst/ms1010.py'
--- mst/ms1010.py	2015-10-03 07:36:56 +0000
+++ mst/ms1010.py	2015-11-07 08:34:29 +0000
@@ -150,7 +150,7 @@
             self.df.focusField("T", 1, 2)
 
     def doClick(self, *opts):
-        if self.df.pag == 0:
+        if self.df.pag == 1 and self.df.col == 1:
             return
         if self.click:
             self.df.loadEntry("T", self.click[0], self.click[1],

=== modified file 'mst/ms1010_rne.py'
--- mst/ms1010_rne.py	2015-08-25 15:02:35 +0000
+++ mst/ms1010_rne.py	2015-11-22 05:10:56 +0000
@@ -34,7 +34,7 @@
             self.first = True
         else:
             self.first = False
-        self.sys = ["GL", "CR", "DR", "ST", "SI", "AR", "RT"]
+        self.sys = ["GL", "CR", "DR", "ST", "SI", "AR", "LN", "RT"]
         self.img = None
         return True
 
@@ -113,8 +113,10 @@
                 "N","N",None,None,None,None),
             (("T",3,5,0),("IRB",r1s),0,"Asset's Register","",
                 "N","N",None,None,None,None),
-            (("T",3,6,0),("IRB",r1s),0,"Rental's Ledger","",
-                "N","N",self.doSys,None,None,None),
+            (("T",3,6,0),("IRB",r1s),0,"Loans Ledger","",
+                "N","N",None,None,None,None),
+            (("T",3,7,0),("IRB",r1s),0,"Rental's Ledger","",
+                "N","N",None,None,None,None),
             (("T",4,0,0),"IFF",75,"Letterhead Image","",
                 "","N",self.doLogo,log,None,("fle","blank")))
         but = (

=== modified file 'mst/msc000.py'
--- mst/msc000.py	2015-10-25 12:48:08 +0000
+++ mst/msc000.py	2015-11-30 07:55:01 +0000
@@ -293,7 +293,10 @@
         if self.db.err:
             self.doExit(dbm=False)
         self.mf.dbm = self.db
-        if not self.db.checkDbase():
+        err = self.db.checkDbase()
+        if not err in (True, False):
+            self.doExit()
+        elif err is False:
             ok = askQuestion(self.mf.window, "Database",
                 "Create the Database Now?")
             if ok == "no":
@@ -323,8 +326,7 @@
                 err = self.doCheckMst()
             # Close the database
             if err:
-                self.db.closeDbase()
-                self.doExit(dbm=True)
+                self.doExit()
             if not self.reg:
                 self.doAskRegister()
             self.db.closeDbase()
@@ -891,8 +893,8 @@
                 rtn = 0
             sql = Sql(self.mf.dbm, ["ffield", "ctllog"], prog="msc000")
             if not sql.error:
-                chk = sql.getRec(tables="ffield", where=[("ff_tabl", "=",
-                    "ctllog")])
+                chk = sql.getRec(tables="ffield",
+                    where=[("ff_tabl", "=", "ctllog")])
             if not sql.error and len(chk) == 7:
                 if not self.user:
                     name = "admin"
@@ -1170,9 +1172,9 @@
                 self.su.loadEntry("T", 0, 2, data=self.nvtxt)
                 return
         if sys.platform == "win32":
-            ftype = [("Upgrade Files", "%s_*.exe" % self.upgsys)]
+            ftype = [("Upgrade Files", "%s_5.*.exe" % self.upgsys)]
         else:
-            ftype = [("Upgrade Files", "%s_*.tgz" % self.upgsys)]
+            ftype = [("Upgrade Files", "%s_5.*.tgz" % self.upgsys)]
         dialog = FileDialog(**{"title": "Select Upgrade File",
             "initd": self.rcdic["upgdir"], "ftype": ftype})
         self.updfle = dialog.askopenfilename()
@@ -1221,10 +1223,9 @@
                 elif self.newver[1] == self.current[0][1]:
                     if self.newver[2] > self.current[0][2]:
                         return
-            return ("Upgrade", "No Upgrade Available")
+            return ("Upgrade Error", "No Upgrade Available")
         except:
-            return ("Connection Error", """Please Ensure that You Are
-Connected to the Internet.
+            return ("Connection Error", """Please Ensure that You Are Connected to the Internet.
 
 
 "If Not, Please Connect and then Try Again!""")
@@ -1256,11 +1257,12 @@
         try:
             if self.updtyp == "I":
                 if sys.platform == "win32":
-                    fnam = self.upgsys + "_%s.%s.%s.exe" % self.newver
+                    ext = "exe"
                 else:
-                    fnam = self.upgsys + "_%s.%s.%s.tgz" % self.newver
-                fle = os.path.join(self.mf.rcdic["wrkdir"], fnam)
-                error = ftpDownload("ftp.tartan.co.za", fnam, word=self.emadd,
+                    ext = "tgz"
+                nam = self.upgsys + "_%s.%s.%s.%s" % (self.newver, ext)
+                fle = os.path.join(self.mf.rcdic["upgdir"], nam)
+                error = ftpDownload("tartan.co.za", nam, word=self.emadd,
                     dest=fle)
                 if error:
                     raise Exception
@@ -1319,8 +1321,8 @@
         if not self.xdisplay:
             return
         try:
-            urllib2.urlopen("http://tartan.co.za", timeout=2)
-        except urllib2.URLError:
+            urllib2.urlopen("http://tartan.co.za", timeout=5)
+        except:
             return
         tit = ("User Registration",)
         r1s = (("Yes","Y"), ("Not-Now","N"), ("Never","X"))
@@ -1346,15 +1348,15 @@
 
     def endReg(self):
         sql = Sql(self.db, "ctlmst", prog="msc000")
-        coy = sql.getRec(tables="ctlmst", cols=["ctm_name"],
-            where=[("ctm_cono=1",)], limit=1)[0]
+        coy = sql.getRec(tables="ctlmst", cols=["ctm_name", "ctm_email"],
+            where=[("ctm_cono=1",)], limit=1)
         if self.newreg == "Y":
             nam = self.rg.t_work[0][0][1]
             eml = self.rg.t_work[0][0][2]
         else:
             nam = "Unknown"
-            eml = "anonymous@unknown.org"
-        mes = "%s - %s - %s" % (coy, nam, eml)
+            eml = coy[1]
+        mes = "%s - %s - %s" % (coy[0], nam, eml)
         svr = ["smtp.gmail.com", 587, 1, 1, "tartansys@gmail.com", "tarpwd09"]
         err = sendMail(svr, eml, "register@tartan.co.za", mes)
         if not err or self.newreg == "X":
@@ -1515,27 +1517,18 @@
                 showError(self.mf.window, "Error", "Browser Not Found.")
 
     def doHousekeeping(self):
-        files = glob.glob(os.path.join(self.rcdic["wrkdir"], "*.ps"))
-        for flenam in files:
-            try:
-                os.remove(flenam)
-            except:
-                pass
-        files = glob.glob(os.path.join(self.rcdic["wrkdir"], "*.pdf"))
-        files.extend(glob.glob(os.path.join(self.rcdic["wrkdir"], "*.gif")))
-        files.extend(glob.glob(os.path.join(self.rcdic["wrkdir"], "*.jpg")))
-        files.extend(glob.glob(os.path.join(self.rcdic["wrkdir"], "*.png")))
-        files.extend(glob.glob(os.path.join(self.rcdic["wrkdir"], "*.odt")))
-        files.extend(glob.glob(os.path.join(self.rcdic["wrkdir"], "*.csv")))
-        files.extend(glob.glob(os.path.join(self.rcdic["wrkdir"], "*.xls")))
-        if files:
-            ask = askQuestion(self.mf.body, "Report Files",
-                "Do you want to Keep the .pdf, .csv and .xls "\
-                "Report Files in the wrk Directory?", default="no")
+        fles = []
+        for tp in ("csv", "gif", "jpg", "odt", "pdf", "png", "ps", "xls"):
+            fles.extend(glob.glob(os.path.join(self.rcdic["wrkdir"],
+                "*.%s" % tp)))
+        if fles:
+            ask = askQuestion(self.mf.body, "Temporary Files",
+                "Do you wish to Keep the Temporary Report Files "\
+                "in the wrk Directory?", default="no")
             if ask == "no":
-                for flenam in files:
+                for fle in fles:
                     try:
-                        os.remove(flenam)
+                        os.remove(fle)
                     except:
                         pass
 

=== modified file 'mst/msy010.py'
--- mst/msy010.py	2015-10-03 07:36:56 +0000
+++ mst/msy010.py	2015-11-22 09:12:17 +0000
@@ -83,7 +83,7 @@
             cols=["cye_last", "cye_final"], where=[("cye_cono", "=",
             self.opts["conum"]), ("cye_period", "=", self.opts["period"][0])],
             limit=1)[:2]
-        if self.oldf == "Y":
+        if self.oldf == "Y" and not "args" in self.opts:
             cf = PwdConfirm(self.opts["mf"], conum=0, system="MST",
                 code="YearEnd")
             if cf.pwd and cf.flag == "ok":

=== modified file 'rca/rc3050.py'
--- rca/rc3050.py	2015-10-03 07:36:56 +0000
+++ rca/rc3050.py	2015-11-25 10:42:09 +0000
@@ -264,7 +264,7 @@
             key, ext="pdf")
         self.form.output(pdfnam, "F")
         doPrinter(mf=self.opts["mf"], conum=self.opts["conum"], pdfnam=pdfnam,
-            head="%s STATEMENT at %s" % (self.opts["conam"], self.dated),
+            head="%s Statement at %s" % (self.opts["conam"], self.dated),
             repprt=self.repprt, repeml=self.repeml)
         if self.repeml[1] == "Y":
             self.form = DrawForm(self.opts["mf"].dbm, self.tname,

=== modified file 'rca/rc3060.py'
--- rca/rc3060.py	2015-10-03 07:36:56 +0000
+++ rca/rc3060.py	2015-11-25 10:42:21 +0000
@@ -317,7 +317,7 @@
             key, ext="pdf")
         self.form.output(pdfnam, "F")
         doPrinter(mf=self.opts["mf"], conum=self.opts["conum"], pdfnam=pdfnam,
-            head="%s STATEMENT at %s" % (self.opts["conam"], self.dated),
+            head="%s Statement at %s" % (self.opts["conam"], self.dated),
             repprt=self.repprt, repeml=self.repeml)
         if self.repeml[1] == "Y":
             self.form = DrawForm(self.opts["mf"].dbm, self.tname,

=== modified file 'rtl/rt3040.py'
--- rtl/rt3040.py	2015-10-03 07:36:56 +0000
+++ rtl/rt3040.py	2015-12-02 11:24:38 +0000
@@ -15,7 +15,7 @@
 
 import time
 from TartanClasses import ASD, DrawForm, GetCtl, ProgressBar, Sql, TartanDialog
-from tartanFunctions import doPrinter,  getModName, getSingleRecords, copyList
+from tartanFunctions import copyList, doPrinter,  getModName, getSingleRecords
 from tartanFunctions import showError
 from tartanWork import rttrtp
 
@@ -163,7 +163,7 @@
 
     def doProcess(self, rtm):
         rmc = self.sql.rtlmst_col
-        rtc = self.sql.rtltrn_col
+        rtc = copyList(self.sql.rtltrn_col)
         tdc = self.form.sql.tpldet_col
         self.code = rtm[rmc.index("rtm_code")]
         self.acno = rtm[rmc.index("rtm_acno")]
@@ -227,21 +227,34 @@
             order="rtt_trdt, rtt_cnum, rtt_refno")
         if not rtt:
             rtt = []
+        trans = []
+        for trn in rtt:
+            tramt = trn[rtc.index("rtt_tramt")]
+            if tramt < 0:
+                trn.extend([0, tramt])
+            else:
+                trn.extend([tramt, 0])
+            trans.append(trn)
+        rtc.extend(["line_debit", "line_credit"])
         self.doHeader(rtm, rmc, prm, prc, tdc)
-        if not len(rtt) > self.form.maxlines:
-            self.doBody(rtc, rtt, tdc)
+        if not len(trans) > self.form.maxlines:
+            self.doBody(rtc, trans, tdc)
         else:
             bal = 0
-            lines = len(rtt) - self.form.maxlines + 1
+            lines = len(trans) - self.form.maxlines + 1
             for _ in xrange(lines):
-                trn = rtt.pop(0)
+                trn = trans.pop(0)
                 bal = float(ASD(bal) + ASD(trn[5]))
             trn[rtc.index("rtt_refno")] = "B/FWD"
             trn[rtc.index("rtt_type")] = 3
             trn[rtc.index("rtt_desc")] = "Balance Brought Forward"
             trn[rtc.index("rtt_tramt")] = bal
-            rtt.insert(0, trn)
-            self.doBody(rtc, rtt, tdc)
+            if bal < 0:
+                trn[rtc.index("line_credit")] = bal
+            else:
+                trn[rtc.index("line_debit")] = bal
+            trans.insert(0, trn)
+            self.doBody(rtc, trans, tdc)
         self.doTotal(tdc)
         self.doTail(tdc)
         if self.df.repeml[1] == "Y" and not self.emadd:
@@ -278,6 +291,7 @@
     def doBody(self, rtc, rtt, tdc):
         text = self.form.sql.tpldet_col.index("tpd_text")
         count = 0
+        bal = 0
         for trans in rtt:
             for cod in self.form.body:
                 if cod == "type_code":
@@ -288,6 +302,12 @@
                 if cod == "type_code":
                     ttyp = trans[rtc.index(c)]
                     self.form.newdic[d][text] = rttrtp[ttyp - 1][0]
+                elif cod in ("line_debit", "line_credit"):
+                    tramt = trans[rtc.index(c)]
+                    bal = float(ASD(bal) + ASD(tramt))
+                    self.form.newdic[d][text] = trans[rtc.index(c)]
+                elif c == "line_balance":
+                    self.form.newdic[d][text] = bal
                 else:
                     self.form.newdic[d][text] = trans[rtc.index(c)]
                 self.form.doDrawDetail(self.form.newdic[d])
@@ -349,7 +369,7 @@
             ext="pdf")
         self.form.output(pdfnam, "F")
         doPrinter(mf=self.opts["mf"], conum=self.opts["conum"], pdfnam=pdfnam,
-            head="%s STATEMENT at %s" % (self.opts["conam"], self.dated),
+            head="%s Statement at %s" % (self.opts["conam"], self.dated),
             repprt=self.df.repprt, repeml=self.df.repeml)
         if self.df.repeml[1] == "Y":
             self.form = DrawForm(self.opts["mf"].dbm, self.tname,

=== modified file 'rtl/rt6010.py'
--- rtl/rt6010.py	2015-08-25 15:02:35 +0000
+++ rtl/rt6010.py	2015-10-26 06:31:48 +0000
@@ -62,10 +62,10 @@
             "whera": [["T", "rtm_code", 0]],
             "index": 1}
         fld = [
-            (("T",0,0,0),"I@rtp_code",0,"Old Code","Old Premises Code",
+            (("T",0,0,0),"IRW",7,"Old Code","Old Premises Code",
                 "","Y",self.doOldCod,prm,None,("notblank",)),
             (("T",0,0,0),"O@rtp_desc",0,""),
-            (("T",0,1,0),"I@rtm_acno",0,"Old Account","Old Account Number",
+            (("T",0,1,0),"IRW",7,"Old Account","Old Account Number",
                 "","Y",self.doOldAcc,rtm,None,("notblank",)),
             (("T",0,1,0),"O@rtm_name",0,""),
             (("T",0,2,0),"I@rtp_code",0,"New Code","New Premises Code",

=== modified file 'sls/si2010.py'
--- sls/si2010.py	2015-10-25 09:33:02 +0000
+++ sls/si2010.py	2015-11-14 07:30:27 +0000
@@ -221,10 +221,10 @@
                 "","N",self.doChn,chn,None,None),
             (("T",0,2,0),"ONA",30,""),
             [["T",0,3,0],"INA",7,"Acc-Num","Account Number",
-                "","Y",self.doAcc,drm,None,None],
+                "","N",self.doAcc,drm,None,None],
             [["T",0,3,0],"ONA",30,""],
             [["T",0,4,0],"INa",3,"Rep","Rep Number",
-                "","Y",self.doRep,rep,None,None],
+                "","N",self.doRep,rep,None,None],
             [["T",0,4,0],"ONA",30,""]]
         if self.chns == "N":
             self.chain = 0
@@ -328,11 +328,13 @@
         self.acttyp = None
         # Action
         if self.typs in ("O", "W", "Q"):
+            # Sales Order, Works Order or Query
             self.doAction()
             if self.actxit:
                 # Refocus on type field
                 return "rf"
             if self.acttyp in ("A", "D"):
+                # Amend or Despatch
                 err = self.doReadLoadDrs()
                 if err:
                     return err
@@ -359,7 +361,7 @@
                 self.df.loadEntry("T", 0, num+4, data=str(self.opts["level"]))
                 return "nd"
             elif self.acttyp == "C":
-                # Force focus to field 1
+                # Cancellation, Force focus to field 1
                 return "ff1"
 
     def doAction(self):
@@ -465,18 +467,17 @@
             self.bal = 0
             self.chain = 0
             self.acno = "CASHSLS"
+            self.repno = ""
             self.drsmst = None
-            while not self.drsmst:
-                err = self.doReadLoadDrs()
-                if not self.drsmst:
-                    data = [self.opts["conum"], self.chain, self.acno,
-                        "Cash Sales Account", "", "", "", "", "", "", "",
-                        "", "", "", "", "", 0, 0, "", "", "", "", "", "",
-                        0, 0, 0, 0, 0, 0, "N", 0, 0, ""]
-                    self.sql.insRec("drsmst", data=data)
-                elif err:
-                    break
-                    return err
+            err = self.doReadLoadDrs()
+            if not self.drsmst:
+                data = [self.opts["conum"], self.chain, self.acno,
+                    "Cash Sales Account", "", "", "", "", "", "", "",
+                    "", "", "", "", "", 0, 0, "", "", "", "", "", 0,
+                    0, 0, 0, 0, 0, "N", 0, 0, ""]
+                self.sql.insRec("drsmst", data=data)
+            elif err:
+                return err
             self.name = self.drsmst[self.sql.drsmst_col.index("drm_name")]
             if self.chns == "Y":
                 idx = p + 3
@@ -484,6 +485,7 @@
                 idx = p + 1
             self.df.loadEntry("T", 0, idx, data=self.acno)
             self.df.loadEntry("T", 0, idx+1, data=self.name)
+            self.df.loadEntry("T", 0, idx+2, data=self.repno)
             if self.chns == "Y":
                 return "sk4"
             else:
@@ -505,10 +507,11 @@
         if err:
             return err
         self.df.loadEntry(frt, pag, p+1, data=self.name)
-        if self.chns == "Y":
-            self.df.topf[0][6][5] = self.repno
-        else:
-            self.df.topf[0][4][5] = self.repno
+        self.df.loadEntry(frt, pag, p+2, data=self.repno)
+        #if self.chns == "Y":
+        #    self.df.topf[0][6][5] = self.repno
+        #else:
+        #    self.df.topf[0][4][5] = self.repno
 
     def doReadLoadDrs(self):
         self.drsmst = self.sql.getRec(tables="drsmst", where=[("drm_cono", "=",

=== modified file 'sls/si2020.py'
--- sls/si2020.py	2015-10-03 07:36:56 +0000
+++ sls/si2020.py	2015-11-07 09:17:29 +0000
@@ -203,49 +203,50 @@
             dfs += 1
         self.font = (dft, dfs)
         rsz = int(round(dfs * 1.5, 0))
+        # Create rounded border image
+        self.img = tk.PhotoImage("frameBorder", data="""
+            R0lGODlhQABAAPcAAHx+fMTCxKSipOTi5JSSlNTS1LSytPTy9IyKjMzKzKyq
+            rOzq7JyanNza3Ly6vPz6/ISChMTGxKSmpOTm5JSWlNTW1LS2tPT29IyOjMzO
+            zKyurOzu7JyenNze3Ly+vPz+/OkAKOUA5IEAEnwAAACuQACUAAFBAAB+AFYd
+            QAC0AABBAAB+AIjMAuEEABINAAAAAHMgAQAAAAAAAAAAAKjSxOIEJBIIpQAA
+            sRgBMO4AAJAAAHwCAHAAAAUAAJEAAHwAAP+eEP8CZ/8Aif8AAG0BDAUAAJEA
+            AHwAAIXYAOfxAIESAHwAAABAMQAbMBZGMAAAIEggJQMAIAAAAAAAfqgaXESI
+            5BdBEgB+AGgALGEAABYAAAAAAACsNwAEAAAMLwAAAH61MQBIAABCM8B+AAAU
+            AAAAAAAApQAAsf8Brv8AlP8AQf8Afv8AzP8A1P8AQf8AfgAArAAABAAADAAA
+            AACQDADjAAASAAAAAACAAADVABZBAAB+ALjMwOIEhxINUAAAANIgAOYAAIEA
+            AHwAAGjSAGEEABYIAAAAAEoBB+MAAIEAAHwCACABAJsAAFAAAAAAAGjJAGGL
+            AAFBFgB+AGmIAAAQAABHAAB+APQoAOE/ABIAAAAAAADQAADjAAASAAAAAPiF
+            APcrABKDAAB8ABgAGO4AAJAAqXwAAHAAAAUAAJEAAHwAAP8AAP8AAP8AAP8A
+            AG0pIwW3AJGSAHx8AEocI/QAAICpAHwAAAA0SABk6xaDEgB8AAD//wD//wD/
+            /wD//2gAAGEAABYAAAAAAAC0/AHj5AASEgAAAAA01gBkWACDTAB8AFf43PT3
+            5IASEnwAAOAYd+PuMBKQTwB8AGgAEGG35RaSEgB8AOj/NOL/ZBL/gwD/fMkc
+            q4sA5UGpEn4AAIg02xBk/0eD/358fx/4iADk5QASEgAAAALnHABkAACDqQB8
+            AMyINARkZA2DgwB8fBABHL0AAEUAqQAAAIAxKOMAPxIwAAAAAIScAOPxABIS
+            AAAAAIIAnQwA/0IAR3cAACwAAAAAQABAAAAI/wA/CBxIsKDBgwgTKlzIsKFD
+            gxceNnxAsaLFixgzUrzAsWPFCw8kDgy5EeQDkBxPolypsmXKlx1hXnS48UEH
+            CwooMCDAgIJOCjx99gz6k+jQnkWR9lRgYYDJkAk/DlAgIMICkVgHLoggQIPT
+            ighVJqBQIKvZghkoZDgA8uDJAwk4bDhLd+ABBmvbjnzbgMKBuoA/bKDQgC1F
+            gW8XKMgQOHABBQsMI76wIIOExo0FZIhM8sKGCQYCYA4cwcCEDSYPLOgg4Oro
+            uhMEdOB84cCAChReB2ZQYcGGkxsGFGCgGzCFCh1QH5jQIW3xugwSzD4QvIIH
+            4s/PUgiQYcCG4BkC5P/ObpaBhwreq18nb3Z79+8Dwo9nL9I8evjWsdOX6D59
+            fPH71Xeef/kFyB93/sln4EP2Ebjegg31B5+CEDLUIH4PVqiQhOABqKFCF6qn
+            34cHcfjffCQaFOJtGaZYkIkUuljQigXK+CKCE3po40A0trgjjDru+EGPI/6I
+            Y4co7kikkAMBmaSNSzL5gZNSDjkghkXaaGIBHjwpY4gThJeljFt2WSWYMQpZ
+            5pguUnClehS4tuMEDARQgH8FBMBBBExGwIGdAxywXAUBKHCZkAIoEEAFp33W
+            QGl47ZgBAwZEwKigE1SQgAUCUDCXiwtQIIAFCTQwgaCrZeCABAzIleIGHDD/
+            oIAHGUznmXABGMABT4xpmBYBHGgAKGq1ZbppThgAG8EEAW61KwYMSOBAApdy
+            pNp/BkhAAQLcEqCTt+ACJW645I5rLrgEeOsTBtwiQIEElRZg61sTNBBethSw
+            CwEA/Pbr778ABywwABBAgAAG7xpAq6mGUUTdAPZ6YIACsRKAAbvtZqzxxhxn
+            jDG3ybbKFHf36ZVYpuE5oIGhHMTqcqswvyxzzDS/HDMHEiiggQMLDxCZXh8k
+            BnEBCQTggAUGGKCB0ktr0PTTTEfttNRQT22ABR4EkEABDXgnGUEn31ZABglE
+            EEAAWaeN9tpqt832221HEEECW6M3wc+Hga3SBgtMODBABw00UEEBgxdO+OGG
+            J4744oZzXUEDHQxwN7F5G7QRdXxPoPkAnHfu+eeghw665n1vIKhJBQUEADs=
+            """)
         # Set Styles
         self.style = ttk.Style()
         if not "RoundedFrame" in self.style.element_names():
-            self.img = tk.PhotoImage("frameBorder", data="""
-                R0lGODlhQABAAPcAAHx+fMTCxKSipOTi5JSSlNTS1LSytPTy9IyKjMzKzKyq
-                rOzq7JyanNza3Ly6vPz6/ISChMTGxKSmpOTm5JSWlNTW1LS2tPT29IyOjMzO
-                zKyurOzu7JyenNze3Ly+vPz+/OkAKOUA5IEAEnwAAACuQACUAAFBAAB+AFYd
-                QAC0AABBAAB+AIjMAuEEABINAAAAAHMgAQAAAAAAAAAAAKjSxOIEJBIIpQAA
-                sRgBMO4AAJAAAHwCAHAAAAUAAJEAAHwAAP+eEP8CZ/8Aif8AAG0BDAUAAJEA
-                AHwAAIXYAOfxAIESAHwAAABAMQAbMBZGMAAAIEggJQMAIAAAAAAAfqgaXESI
-                5BdBEgB+AGgALGEAABYAAAAAAACsNwAEAAAMLwAAAH61MQBIAABCM8B+AAAU
-                AAAAAAAApQAAsf8Brv8AlP8AQf8Afv8AzP8A1P8AQf8AfgAArAAABAAADAAA
-                AACQDADjAAASAAAAAACAAADVABZBAAB+ALjMwOIEhxINUAAAANIgAOYAAIEA
-                AHwAAGjSAGEEABYIAAAAAEoBB+MAAIEAAHwCACABAJsAAFAAAAAAAGjJAGGL
-                AAFBFgB+AGmIAAAQAABHAAB+APQoAOE/ABIAAAAAAADQAADjAAASAAAAAPiF
-                APcrABKDAAB8ABgAGO4AAJAAqXwAAHAAAAUAAJEAAHwAAP8AAP8AAP8AAP8A
-                AG0pIwW3AJGSAHx8AEocI/QAAICpAHwAAAA0SABk6xaDEgB8AAD//wD//wD/
-                /wD//2gAAGEAABYAAAAAAAC0/AHj5AASEgAAAAA01gBkWACDTAB8AFf43PT3
-                5IASEnwAAOAYd+PuMBKQTwB8AGgAEGG35RaSEgB8AOj/NOL/ZBL/gwD/fMkc
-                q4sA5UGpEn4AAIg02xBk/0eD/358fx/4iADk5QASEgAAAALnHABkAACDqQB8
-                AMyINARkZA2DgwB8fBABHL0AAEUAqQAAAIAxKOMAPxIwAAAAAIScAOPxABIS
-                AAAAAIIAnQwA/0IAR3cAACwAAAAAQABAAAAI/wA/CBxIsKDBgwgTKlzIsKFD
-                gxceNnxAsaLFixgzUrzAsWPFCw8kDgy5EeQDkBxPolypsmXKlx1hXnS48UEH
-                CwooMCDAgIJOCjx99gz6k+jQnkWR9lRgYYDJkAk/DlAgIMICkVgHLoggQIPT
-                ighVJqBQIKvZghkoZDgA8uDJAwk4bDhLd+ABBmvbjnzbgMKBuoA/bKDQgC1F
-                gW8XKMgQOHABBQsMI76wIIOExo0FZIhM8sKGCQYCYA4cwcCEDSYPLOgg4Oro
-                uhMEdOB84cCAChReB2ZQYcGGkxsGFGCgGzCFCh1QH5jQIW3xugwSzD4QvIIH
-                4s/PUgiQYcCG4BkC5P/ObpaBhwreq18nb3Z79+8Dwo9nL9I8evjWsdOX6D59
-                fPH71Xeef/kFyB93/sln4EP2Ebjegg31B5+CEDLUIH4PVqiQhOABqKFCF6qn
-                34cHcfjffCQaFOJtGaZYkIkUuljQigXK+CKCE3po40A0trgjjDru+EGPI/6I
-                Y4co7kikkAMBmaSNSzL5gZNSDjkghkXaaGIBHjwpY4gThJeljFt2WSWYMQpZ
-                5pguUnClehS4tuMEDARQgH8FBMBBBExGwIGdAxywXAUBKHCZkAIoEEAFp33W
-                QGl47ZgBAwZEwKigE1SQgAUCUDCXiwtQIIAFCTQwgaCrZeCABAzIleIGHDD/
-                oIAHGUznmXABGMABT4xpmBYBHGgAKGq1ZbppThgAG8EEAW61KwYMSOBAApdy
-                pNp/BkhAAQLcEqCTt+ACJW645I5rLrgEeOsTBtwiQIEElRZg61sTNBBethSw
-                CwEA/Pbr778ABywwABBAgAAG7xpAq6mGUUTdAPZ6YIACsRKAAbvtZqzxxhxn
-                jDG3ybbKFHf36ZVYpuE5oIGhHMTqcqswvyxzzDS/HDMHEiiggQMLDxCZXh8k
-                BnEBCQTggAUGGKCB0ktr0PTTTEfttNRQT22ABR4EkEABDXgnGUEn31ZABglE
-                EEAAWaeN9tpqt832221HEEECW6M3wc+Hga3SBgtMODBABw00UEEBgxdO+OGG
-                J4744oZzXUEDHQxwN7F5G7QRdXxPoPkAnHfu+eeghw665n1vIKhJBQUEADs=
-                """)
-            self.style.element_create("RoundedFrame", "image", "frameBorder",
-                border=16, sticky="nsew")
+            self.style.element_create("RoundedFrame",
+                "image", "frameBorder", border=16, sticky="nsew")
             self.style.layout("RoundedFrame",
                 [("RoundedFrame", {"sticky": "nsew"})])
         self.style.configure("Heading",
@@ -705,8 +706,8 @@
                 acno)], limit=1)
             if not acc:
                 data = [self.opts["conum"], 0, acno, name, "", "", "", "", "",
-                    "", "", "", "", "", "", "", 0, 0, "", "", "", "", "", "",
-                    0, 0, 0, 0, 0, 0, "N", 0, 0, ""]
+                    "", "", "", "", "", "", 0, 0, "", "", "", "", "", "", 0, 0,
+                    0, 0, 0, 0, "N", 0, 0, ""]
                 self.sql.insRec("drsmst", data=data)
         else:
             name = self.host

=== modified file 'std/TartanClasses.py'
--- std/TartanClasses.py	2015-10-25 10:31:24 +0000
+++ std/TartanClasses.py	2015-12-12 03:13:57 +0000
@@ -2117,18 +2117,18 @@
         "Check to see if a database exists"
         exists = False
         if self.dbase == "FBird":
-            self.openDbase(err=False)
+            err = self.openDbase(err=False)
             if self.db:
                 exists = True
         elif self.dbase == "MySQL":
-            self.openDbase(dbname="mysql", err=False)
+            err = self.openDbase(dbname="mysql", err=False)
             if self.db:
                 self.cu.execute("Select count(*) from information_schema."
                     "tables where table_schema='%s'" % self.dbname)
                 if self.cu.fetchone()[0]:
                     exists = True
         elif self.dbase == "PgSQL":
-            self.openDbase(dbname="postgres", err=False)
+            err = self.openDbase(dbname="postgres", err=False)
             if self.db:
                 self.cu.execute("Select count(*) from pg_catalog."
                     "pg_database where datname='%s'" % self.dbname)
@@ -2136,17 +2136,26 @@
                     exists = True
         elif self.dbase == "SQLite":
             if os.path.exists(self.dbdsn):
-                self.openDbase(err=False)
+                err = self.openDbase(err=False)
                 if self.db:
                     exists = True
-        if exists:
+            else:
+                err = None
+        try:
             self.closeDbase()
+        except:
+            pass
+        if err:
+            return err
         return exists
 
     def createDbase(self):
         "Create a database if it does not exist"
         try:
-            if self.checkDbase():
+            err = self.checkDbase()
+            if not err in (True, False):
+                raise Exception(err)
+            elif err is True:
                 raise Exception("Database Already Exists")
             if self.dbase == "FBird":
                 if not self.dbhost == "localhost":
@@ -2245,18 +2254,13 @@
                 except:
                     pass
             self.dbopen = True
-        except:
+        except Exception, e:
             self.db = self.cu = None
             self.dbopen = False
-            if not err and not "TARTANDB" in os.environ:
-                return False
-            path = True
             mess = "Database: %s" % dbname
-            if path:
-                mess += "\n\nPATH:"
-                for pth in os.environ["PATH"].split(os.pathsep):
-                    mess = mess + "	" + pth + "\n"
             showException(self.screen, self.wrkdir, mess)
+            if not err:
+                return e
             sys.exit()
 
     def commitDbase(self, ask=False, rback=True, mess=None, default="yes"):
@@ -3106,6 +3110,13 @@
         if len(types) == 3:
             types = types[1:]
         #=======================================================================
+        # Check, Radio Button Boxes, Raw Data Types and Timestamp
+        #=======================================================================
+        if types in ("CB", "RB", "RW", "TS"):
+            self.err = ""
+            self.work = self.disp = self.data = data
+            return
+        #=======================================================================
         # Work around for None
         #=======================================================================
         if data is None:
@@ -3114,24 +3125,10 @@
             else:
                 self.data = "0"
         #=======================================================================
-        # Check, Radio Button Boxes and Raw Data Types
-        #=======================================================================
-        if types in ("CB", "RB", "RW"):
-            self.err = ""
-            self.work = self.disp = self.data = data
-            return
-        #=======================================================================
-        # Timestamp
-        #=======================================================================
-        if types == "TS":
-            self.err = ""
-            self.work = self.disp = self.data = data
-            return
-        #=======================================================================
         # Work around for previous format error
         #=======================================================================
-        elif not types[0] == "T" and not types[1].upper() == "A" and \
-                data == "None":
+        elif not types[0] == "T" and not types[1].upper() == "A" \
+                and data == "None":
             self.data = "0"
         #=======================================================================
         elif types[1].lower() in ("a", "v", "x"):
@@ -3694,7 +3691,10 @@
     def doCreate(self):
         self.setVariables()
         if self.put == "i":
-            if self.dbm.checkDbase():
+            err = self.dbm.checkDbase()
+            if not err in (True, False):
+                os._exit(1)
+            elif err is True:
                 answer = askQuestion(self.spl, "Drop Database?",
                     "The database already exists, do you want to Drop it?",
                     default="no")
@@ -3866,7 +3866,7 @@
                                       text
                                       prompt
                           OR
-                            ("[I,O]CB","xyz") for Radiobutton where:
+                            ("[I,O]CB","xyz") for Checkbutton where:
                                 I,O = (I)nput or (O)utput
                                 CB  = Checkbutton indicator
                                 xyz = the text of the button
@@ -5004,7 +5004,7 @@
                                     ("cols" or "typs" in f1):
             if "autoc" in f1:
                 return f1["autoc"]
-            if typ in ("INA", "INa", "IUA"):
+            if typ in ("INA", "INa", "IUA", "IRW"):
                 return True
 
     def chgFieldSize(self, frt, pag, pos, siz):
@@ -7652,6 +7652,7 @@
                 setattr(self, nam, defaults[nam])
                 if nam == "typ":
                     text = ""
+        #self.esc = False
         if not self.mxs:
             self.typ = "G"
         if self.typ == "G":
@@ -7717,7 +7718,6 @@
 
     def quitProgress(self):
         self.quit = True
-        self.closeProgress()
 
 class ShowEmail:
     def __init__(self, window=False, message=None, embed=None, attach=None):
@@ -8449,7 +8449,7 @@
         themes = self.style.theme_names()
         self.thm = []
         for theme in themes:
-            if theme in ("default", "alt", "clam", "classic"):
+            if theme in ("alt", "clam", "classic", "default"):
                 self.thm.append(theme)
         self.thm.sort()
 
@@ -9792,7 +9792,7 @@
         else:
             self.d_per = 0
             self.s_per = self.i_per
-        if self.period[0] > 0:
+        if self.period[0]:
             self.s_lyr, e_lyr, fin = getPeriods(self.mf, self.conum,
                 (self.period[0] - 1))
             self.i_pyr = self.s_lyr.work / 100
@@ -9811,6 +9811,9 @@
             else:
                 self.d_pyr = 0
                 self.s_pyr = self.i_pyr
+        else:
+            self.d_pyr = 0
+            self.s_pyr = 0
         self.cmth = self.curdt % 100
         self.lines = 1
         self.count = 0
@@ -10357,12 +10360,8 @@
                     "=", self.period[1][0])], limit=1)[0]
         if not lyr:
             lyr = 0
-        else:
-            lyr = float(lyr)
         if not cyr:
             cyr = 0
-        else:
-            cyr = float(cyr)
         return (lyr, cyr)
 
     def getMbal(self, curdt):
@@ -10435,16 +10434,10 @@
                     self.s_acno), ("glb_curdt", "=", curdt)], limit=1)[0]
         if not lyr:
             lyr = 0
-        else:
-            lyr = float(lyr)
         if not cyr:
             cyr = 0
-        else:
-            cyr = float(cyr)
         if not bud:
             bud = 0
-        else:
-            bud = int(bud)
         return (lyr, cyr, bud)
 
     def printLine(self):
@@ -11199,7 +11192,8 @@
             "tname": "purchase_order",
             "repprt": ["N", "V", "view"],
             "repeml": ["N", "N", "", "", "Y"],
-            "copy": "n"}
+            "copy": "n",
+            "splash": True}
         for nam in args:
             if nam in ("repprt", "repeml"):
                 defaults[nam] = copyList(args[nam])
@@ -11222,7 +11216,6 @@
         return True
 
     def doProcess(self):
-        sp = SplashScreen(self.mf.body, "Generating Forms\n\n   Please Wait...")
         pmc = self.sql.strpom_col
         ptc = self.sql.strpot_col
         cmc = self.sql.crsmst_col
@@ -11238,6 +11231,9 @@
                 self.conum), ("pom_ordno", "=", self.docno.work)], limit=1)
             if not pom:
                 continue
+            if self.splash:
+                sp = SplashScreen(self.mf.body,
+                    "Generating Forms\n\n   Please Wait...")
             for fld in pmc:
                 if fld in self.form.tptp:
                     self.form.tptp[fld][1] = pom[pmc.index(fld)]
@@ -11277,11 +11273,11 @@
             self.doBody(ptc, pot, tdc)
             self.doTotal(tdc)
             self.doTail(tdc)
+            if self.splash:
+                sp.closeSplash()
             if self.repeml[1] == "Y" and not self.emadd:
                 self.repeml[2] = eml
                 self.doPrint()
-                sp.refreshSplash()
-        sp.closeSplash()
         if self.repeml[1] == "N" or self.emadd:
             self.repeml[2] = self.emadd
             self.doPrint()
@@ -11400,7 +11396,7 @@
 
     def doPrint(self):
         pfx = "PurOrd"
-        head = "%s PURCHASE ORDER" % self.conam.upper()
+        head = "%s Purchase Order" % self.conam.upper()
         if self.repeml[1] == "Y" and not self.emadd:
             head = "%s %s" % (head, self.docno.work)
             pdfnam = getModName(self.mf.rcdic["wrkdir"], pfx,
@@ -11532,9 +11528,6 @@
         return True
 
     def doProcess(self):
-        if self.splash:
-            sp = SplashScreen(self.mf.body,
-                "Generating Forms\n\n   Please Wait...")
         s1c = self.sql.slsiv1_col
         s2c = self.sql.slsiv2_col
         dmc = self.sql.drsmst_col
@@ -11554,6 +11547,9 @@
                 self.docno.work)], order="si2_seq")
             if not si1 or not si2:
                 continue
+            if self.splash:
+                sp = SplashScreen(self.mf.body,
+                    "Generating Forms\n\n   Please Wait...")
             for fld in s1c:
                 if fld in self.form.tptp:
                     self.form.tptp[fld][1] = si1[s1c.index(fld)]
@@ -11607,13 +11603,11 @@
                 self.doTail(tdc)
                 if "document_type" in self.form.tptp:
                     self.form.tptp["document_type"][1] = dat
+            if self.splash:
+                sp.closeSplash()
             if self.repeml[1] == "Y" and not self.emadd:
                 self.repeml[2] = eml
                 self.doPrint()
-                if self.splash:
-                    sp.refreshSplash()
-        if self.splash:
-            sp.closeSplash()
         if self.repeml[1] == "N" or self.emadd:
             self.repeml[2] = self.emadd
             self.doPrint()
@@ -11753,15 +11747,15 @@
         elif self.dtype == "Q":
             pfx = "SlsQte"
         if self.dtype == "I":
-            head = "%s INVOICE" % self.conam.upper()
+            head = "%s Invoice" % self.conam.upper()
         elif self.dtype == "C":
-            head = "%s CREDIT NOTE" % self.conam.upper()
+            head = "%s Credit Note" % self.conam.upper()
         elif self.dtype == "O":
-            head = "%s SALES ORDER" % self.conam.upper()
+            head = "%s Sales Order" % self.conam.upper()
         elif self.dtype == "W":
-            head = "%s WORKS ORDER" % self.conam.upper()
+            head = "%s Works Order" % self.conam.upper()
         elif self.dtype == "Q":
-            head = "%s QUOTATION" % self.conam.upper()
+            head = "%s Quotation" % self.conam.upper()
         if self.repeml[1] == "Y" and not self.emadd:
             head = "%s %s" % (head, self.docno.work)
             pdfnam = getModName(self.mf.rcdic["wrkdir"], pfx,
@@ -11918,9 +11912,6 @@
         return True
 
     def doProcess(self):
-        if self.splash:
-            sp = SplashScreen(self.mf.body,
-                "Generating Forms\n\n   Please Wait...")
         mcc = self.sql.bkmmst_col
         ccc = self.sql.bkmcon_col
         ttc = self.sql.bkmrtt_col
@@ -11930,6 +11921,9 @@
         self.doLoadStatic()
         self.form.doNewDetail()
         for docno in self.docs:
+            if self.splash:
+                sp = SplashScreen(self.mf.body,
+                    "Generating Forms\n\n   Please Wait...")
             self.docno = CCD(docno, "UI", 9)
             if self.dtype == "I":
                 rtn = 2
@@ -11993,13 +11987,11 @@
             self.doTotal(tdc)
             if self.dtype == "I":
                 self.doTail(tdc)
+            if self.splash:
+                sp.closeSplash()
             if self.repeml[1] == "Y" and not self.emadd:
                 self.repeml[2] = eml
                 self.doPrint()
-                if self.splash:
-                    sp.refreshSplash()
-        if self.splash:
-            sp.closeSplash()
         if self.repeml[1] == "N" or self.emadd:
             self.repeml[2] = self.emadd
             self.doPrint()
@@ -12115,9 +12107,9 @@
     def doPrint(self):
         pfx = "InvCrn"
         if self.dtype == "I":
-            head = "%s - INVOICE" % self.conam.upper()
+            head = "%s - Invoice" % self.conam.upper()
         elif self.dtype == "C":
-            head = "%s - CREDIT NOTE" % self.conam.upper()
+            head = "%s - Credit Note" % self.conam.upper()
         if self.repeml[1] == "Y" and not self.emadd:
             pdfnam = getModName(self.mf.rcdic["wrkdir"], pfx,
                 "%s_%s" % (self.conum, self.docno.work), ext="pdf")
@@ -12240,7 +12232,8 @@
             "repeml": ["N", "N", "", "", "Y"],
             "message": None,
             "export": None,
-            "bestac": None}
+            "bestac": None,
+            "splash": True}
         for nam in args:
             if nam in ("repprt", "repeml"):
                 defaults[nam] = copyList(args[nam])
@@ -12272,13 +12265,11 @@
         return True
 
     def doProcess(self):
-        sp = SplashScreen(self.mf.body, "Generating Forms\n\n   Please Wait...")
         self.form = DrawForm(self.mf.dbm, self.tname)
         self.doLoadStatic()
         self.form.doNewDetail()
         for emp in self.empnos:
             self.doPayslip(emp)
-        sp.closeSplash()
         if self.repeml[1] == "N" or self.emadd:
             self.repeml[2] = self.emadd
             self.doPrint()
@@ -12318,6 +12309,9 @@
             self.rundt.work)], limit=1)
         if not wt1:
             return
+        if self.splash:
+            sp = SplashScreen(self.mf.body,
+                "Generating Forms\n\n   Please Wait...")
         if "employee_name" in self.form.tptp:
             dat = wgm[wmc.index("wgm_fname")]
             dat = "%s %s" % (dat, wgm[wmc.index("wgm_sname")])
@@ -12383,6 +12377,8 @@
                 int(self.empno), int(self.bacno), "", self.btype,
                 value, self.bname, "", self.conam[:15], ""))
             self.etotal = float(ASD(self.etotal) + ASD(self.total))
+        if self.splash:
+            sp.closeSplash()
         if self.repeml[1] == "Y" and not self.emadd:
             self.repeml[2] = eml
             self.doPrint()
@@ -12433,7 +12429,7 @@
         return wt2
 
     def doPrint(self):
-        head = "%s PAYSLIP" % self.conam.upper()
+        head = "%s Payslip" % self.conam.upper()
         if self.repeml[1] == "Y" and not self.emadd:
             key = "%s_%s" % (self.conum, self.empno)
         else:
@@ -16625,6 +16621,7 @@
                 dsp = chk.disp
             self.ents[fld].insert(0, dsp)
             if fld == len(self.cols) - 1:
+                # Last field
                 for num, ent in enumerate(self.ents):
                     self.data.append(CCD(ent.get(), self.cols[num][3],
                         self.cols[num][2]).work)

=== modified file 'std/tartanFunctions.py'
--- std/tartanFunctions.py	2015-10-25 09:33:02 +0000
+++ std/tartanFunctions.py	2015-12-11 13:47:54 +0000
@@ -261,7 +261,7 @@
                 cmd.append("-%s" % x.strip())
     return exe, cmd
 
-def showException(scrn, path, mess, maxTBlevel=0, xits=None, dbm=None):
+def showException(scrn, path, mess, maxTB=None, xits=None, dbm=None):
     """
     Display an exception
 
@@ -333,8 +333,8 @@
             excArgs = exc.__dict__["args"]
         except KeyError:
             excArgs = "<no args>"
-    if maxTBlevel:
-        excTb = traceback.format_tb(trbk, maxTBlevel)
+    if maxTB:
+        excTb = traceback.format_tb(trbk, maxTB)
     else:
         excTb = traceback.format_tb(trbk)
     excMess = ""
@@ -706,8 +706,14 @@
         int(subj[:3])
         subj = subj[4:]
     except:
-        pass
-    msgRoot["Subject"] = subj
+        subj = subj
+    subj = subj.replace("'", "").replace("(", " ").replace(")", " ").title()
+    if not mess:
+        if attach:
+            mess = "Attached please find:\n\n%s" % subj
+        else:
+            mess = subj
+    msgRoot["Subject"] = subj.replace("'", "").title()
     msgRelated = MIMEMultipart("related")
     msgRoot.attach(msgRelated)
     msgAlternative = MIMEMultipart("alternative")

=== modified file 'std/tartanWork.py'
--- std/tartanWork.py	2015-10-03 07:36:56 +0000
+++ std/tartanWork.py	2015-11-28 08:34:22 +0000
@@ -22,7 +22,7 @@
     "DRS": ["Debtors Ledger", "DR", "Y"],
     "GEN": ["General Ledger", "GL", "Y"],
     "INV": ["Sales Invoicing", "SI", "Y"],
-    "LON": ["Loans", "LN", "Y"],
+    "LON": ["Loans Ledger", "LN", "Y"],
     "MEM": ["Members Ledger", "ML", "Y"],
     "MST": ["Master Control", "MS", "Y"],
     "RCA": ["Rentals Ledger (Extended)", "RC", "Y"],
@@ -309,6 +309,8 @@
             "contact_details": [["", "RW", 30, "Contact Name & Address"], []],
             "type_code": [["", "NA", 3, "Transaction Type Code"], []],
             "line_paid": [["", "SD", 11.2, "Line Paid Amount"], []],
+            "line_debit": [["", "SD", 11.2, "Line Debit Amount"], []],
+            "line_credit": [["", "SD", 11.2, "Line Credit Amount"], []],
             "line_balance": [["", "SD", 11.2, "Line Balance"], []],
             "carried_forward": [["", "NA", 22, "Carried Forward"], []],
             "brought_forward": [["", "NA", 22, "Brought Forward"], []],

=== modified file 'std/tartanWork_rne.py'
--- std/tartanWork_rne.py	2015-08-25 15:02:35 +0000
+++ std/tartanWork_rne.py	2015-11-29 15:41:54 +0000
@@ -20,6 +20,7 @@
     "DRS": ["Debtors Ledger", "DR", "Y"],
     "GEN": ["General Ledger", "GL", "Y"],
     "INV": ["Sales Invoicing", "SI", "Y"],
+    "LON": ["Loans Ledger", "LN", "Y"],
     "MST": ["Master Control", "MS", "Y"],
     "RTL": ["Rentals Ledger", "RT", "Y"],
     "STR": ["Stores Ledger", "ST", "Y"],
@@ -76,6 +77,14 @@
     ("Pay", "Payment"),
     ("Dis", "Set-Discount")]
 #
+# Loans"s Ledger
+#---------------
+lntrtp = [
+    ("Pmt", "Payment"),
+    ("Rec", "Receipt"),
+    ("J/E", "Journal"),
+    ("Int", "Interest")]
+#
 # Stores Ledger
 #--------------
 sttrtp = [
@@ -115,6 +124,7 @@
 stdtpl = [
     "remittance_rnehol",
     "sales_document",
+    "statement_loan",
     "statement_normal",
     "statement_other",
     "statement_rental"]
@@ -178,11 +188,14 @@
     "S": {
         "tables": {
             "DRS": ["drschn", "drsmst", "drstrn"],
+            "LON": ["lonmf1", "lonmf2", "lontrn"],
             "RTL": ["rtlmst", "rtltrn", "rtlprm", "rtlcon"]},
         "codes": {
             "account_details": [["", "RW", 30, "Account Name & Address"], []],
             "type_code": [["", "NA", 3, "Transaction Type Code"], []],
             "line_paid": [["", "SD", 11.2, "Line Paid Amount"], []],
+            "line_debit": [["", "SD", 11.2, "Line Debit Amount"], []],
+            "line_credit": [["", "SD", 11.2, "Line Credit Amount"], []],
             "line_balance": [["", "SD", 11.2, "Line Balance"], []],
             "carried_forward": [["", "NA", 22, "Carried Forward"], []],
             "brought_forward": [["", "NA", 22, "Brought Forward"], []],

=== modified file 'str/st3070.py'
--- str/st3070.py	2015-10-03 07:36:56 +0000
+++ str/st3070.py	2015-11-24 16:57:57 +0000
@@ -14,7 +14,8 @@
 """
 
 import time
-from TartanClasses import CCD, GetCtl, MyFpdf, ProgressBar, Sql, TartanDialog
+from TartanClasses import ASD, CCD, GetCtl, MyFpdf, ProgressBar, Sql
+from TartanClasses import TartanDialog
 from tartanFunctions import getModName, doPrinter, showError
 
 class st3070:
@@ -61,6 +62,7 @@
                 ("pom_date", "", 0, "Order-Date")),
             "where": []}
         r1s = (("Yes", "Y"), ("No", "N"))
+        r2s = (("List", "L"), ("Detail", "D"))
         if self.locs == "N":
             fld = [
             (("T",0,0,0),"OUA",1,"Location","",
@@ -70,11 +72,13 @@
             (("T",0,0,0),"IUA",1,"Location","",
                 "","Y",self.doLoc,loc,None,None)]
         fld.extend([
-            (("T",0,1,0),("IRB",r1s),0,"Oustanding Only","Oustanding Only",
-                "Y","Y",self.doTyp,None,None,None),
-            (("T",0,2,0),"IUI",9,"From Order Number","From Order Number",
+            (("T",0,1,0),("IRB",r1s),0,"Oustanding Only","",
+                "Y","Y",self.doOut,None,None,None),
+            (("T",0,2,0),("IRB",r2s),0,"Oustanding Only","",
+                "L","Y",self.doTyp,None,None,None),
+            (("T",0,3,0),"IUI",9,"From Order Number","",
                 "","Y",self.doOrd1,self.orm,None,None),
-            (("T",0,3,0),"IUI",9,"To   Order Number","To Order Number",
+            (("T",0,4,0),"IUI",9,"To   Order Number","",
                 "","Y",self.doOrd2,self.orm,None,None)])
         tnd = ((self.doEnd,"y"), )
         txt = (self.doExit, )
@@ -93,7 +97,7 @@
                 return "Invalid Location"
             self.locd = self.locw
 
-    def doTyp(self, frt, pag, r, c, p, i, w):
+    def doOut(self, frt, pag, r, c, p, i, w):
         self.outs = w
         if self.outs == "Y":
             self.orm["where"] = [
@@ -103,6 +107,9 @@
             self.orm["where"] = [
                 ("pom_cono", "=", self.opts["conum"])]
 
+    def doTyp(self, frt, pag, r, c, p, i, w):
+        self.rtyp = w
+
     def doOrd1(self, frt, pag, r, c, p, i, w):
         self.ord1 = w
 
@@ -126,13 +133,16 @@
         whr.extend([("pom_ordno", ">=", self.ord1),
             ("pom_ordno", "<=", self.ord2)])
         recs = self.sql.getRec(tables="strpom", cols=["pom_ordno", "pom_loc",
-            "pom_date", "pom_acno", "pom_contact", "pom_deldt"], where=whr)
+            "pom_date", "pom_acno", "pom_deldt"], where=whr)
         if not recs:
             showError(self.opts["mf"].body, "Selection Error",
             "No Orders Selected")
         else:
             self.printSetup(recs)
-            self.processRecords(recs)
+            if self.rtyp == "D":
+                self.doDetail(recs)
+            else:
+                self.doList(recs)
             if self.fpdf.page and not self.p.quit:
                 pdfnam = getModName(self.opts["mf"].rcdic["wrkdir"], __name__,
                     self.opts["conum"], ext="pdf")
@@ -144,24 +154,27 @@
 
     def printSetup(self, recs):
         self.p = ProgressBar(self.opts["mf"].body, mxs=len(recs), esc=True)
-        self.head = ("%03u %-30s %46s %10s" % \
-            (self.opts["conum"], self.opts["conam"], self.sysdttm, __name__))
+        if self.rtyp == "D":
+            self.head = ("%03u %-30s %43s %10s" % (self.opts["conum"],
+                self.opts["conam"], self.sysdttm, __name__))
+        else:
+            self.head = ("%03u %-30s %65s %10s" % (self.opts["conum"],
+                self.opts["conam"], self.sysdttm, __name__))
         self.fpdf = MyFpdf(name=__name__, head=self.head)
         self.pgnum = 0
         self.pglin = 999
 
-    def processRecords(self, recs):
+    def doDetail(self, recs):
         for num, dat in enumerate(recs):
             self.p.displayProgress(num)
             if self.p.quit:
                 break
-            self.ord = CCD(dat[0], "Na", 9)
+            self.odr = CCD(dat[0], "Na", 9)
             self.pot = self.sql.getRec(tables="strpot", cols=["pot_group",
                 "pot_code", "pot_uoi", "pot_desc", "pot_qty", "pot_price",
                 "pot_disper"], where=[("pot_cono", "=", self.opts["conum"]),
-                ("pot_ordno", "=", self.ord.work)],
+                ("pot_ordno", "=", self.odr.work)],
                 order="pot_group, pot_code")
-            self.loc = CCD(dat[1], "UA", 1)
             self.dto = CCD(dat[2], "d1", 10)
             self.crs = CCD(dat[3], "NA", 7)
             acc = self.sql.getRec(tables="crsmst", cols=["crm_name"],
@@ -171,8 +184,7 @@
                 self.nam = ""
             else:
                 self.nam = acc[0]
-            self.per = CCD(dat[4], "NA", 20)
-            self.dte = CCD(dat[5], "d1", 10)
+            self.dte = CCD(dat[4], "d1", 10)
             self.printHeader()
             if self.pot:
                 self.printBody()
@@ -181,40 +193,91 @@
                     "Amend or Cancel the Order")
         self.p.closeProgress()
 
-    def pageHeading(self):
+    def doList(self, recs):
+        for num, dat in enumerate(recs):
+            self.p.displayProgress(num)
+            if self.p.quit:
+                break
+            if self.pglin > self.fpdf.lpp:
+                self.printHeader()
+            odr = CCD(dat[0], "Na", 9)
+            dto = CCD(dat[2], "d1", 10)
+            crs = CCD(dat[3], "NA", 7)
+            if dat[4]:
+                dte = CCD(dat[4], "d1", 10)
+            else:
+                dte = CCD("", "NA", 10)
+            acc = self.sql.getRec(tables="crsmst", cols=["crm_name"],
+                where=[("crm_cono", "=", self.opts["conum"]), ("crm_acno", "=",
+                crs.work)], limit=1)
+            if not acc:
+                nam = CCD("", "NA", 30)
+            else:
+                nam = CCD(acc[0], "NA", 30)
+            pots = self.sql.getRec(tables="strpot", cols=["pot_qty",
+                "pot_price", "pot_disper"], where=[("pot_cono", "=",
+                self.opts["conum"]), ("pot_ordno", "=", odr.work)])
+            prc = 0
+            dis = 0
+            val = 0
+            for pot in pots:
+                a = pot[0] * pot[1]
+                b = a * pot[2] / 100.0
+                prc = float(ASD(prc) + ASD(a))
+                dis = float(ASD(dis) + ASD(b))
+                val = float(ASD(val) + ASD(a) - ASD(b))
+            prc = CCD(prc, "SD", 13.2)
+            dis = CCD(dis, "SD", 13.2)
+            val = CCD(val, "SD", 13.2)
+            self.fpdf.drawText("%s %s %s %s %s %s %s %s" % (odr.disp, crs.disp,
+                nam.disp, dto.disp, dte.disp, prc.disp, dis.disp, val.disp))
+            self.pglin += 1
+        self.p.closeProgress()
+
+    def printHeader(self):
+        self.pgnum += 1
         self.fpdf.add_page()
         self.fpdf.setFont(style="B")
-        self.pgnum += 1
         self.fpdf.drawText(self.head)
         self.fpdf.drawText()
         if self.outs == "Y":
-            self.fpdf.drawText("%-39s %3s %-5s %-10s %25s %5s" % \
-            ("Outstanding Orders Report for Location", self.locd, "as at",
-            self.sysdtd, "Page", self.pgnum))
-        else:
-            self.fpdf.drawText("%-27s %3s %-5s %-10s %37s %5s" % \
-            ("Orders Report for Location", self.locd, "as at",
-            self.sysdtd, "Page", self.pgnum))
-        self.fpdf.setFont()
-        self.pglin = 3
-
-    def printHeader(self):
-        self.pageHeading()
-        self.fpdf.setFont(style="B")
-        self.fpdf.drawText()
-        text = "Order Number: %-9s%20sSupplier: %-7s %30s" % (self.ord.disp,
-            "", self.crs.disp, self.nam)
-        self.fpdf.drawText(text)
-        self.fpdf.drawText()
-        text = "Date Ordered: %s%42sDate Received: %s" % (self.dto.disp,
-            "", self.dte.disp)
-        self.fpdf.drawText(text)
-        self.fpdf.drawText()
-        self.fpdf.drawText("%-3s %-20s %-1s %-30s %-10s %11s %10s" % ("Grp",
-            "Product-Code", "L", "Description", "U.O.I", "U-Price", "Qty-Ord"))
+            txt = "%-39s %3s %-5s %-10s" % \
+                ("Outstanding Orders Report for Location", self.locd, "as at",
+                    self.sysdtd)
+            if self.rtyp == "D":
+                txt = "%s %22s %5s" % (txt, "Page", self.pgnum)
+            else:
+                txt = "%s %44s %5s" % (txt, "Page", self.pgnum)
+        else:
+            txt = "%-27s %3s %-5s %-10s" % \
+                ("Orders Report for Location", self.locd, "as at",
+                    self.sysdtd)
+            if self.rtyp == "D":
+                txt = "%s %34s %5s" % (txt, "Page", self.pgnum)
+            else:
+                txt = "%s %56s %5s" % (txt, "Page", self.pgnum)
+        self.fpdf.drawText(txt)
+        self.fpdf.drawText()
+        if self.rtyp == "D":
+            text = "Order Number: %-9s%20sSupplier: %-7s %-30s" % \
+                (self.odr.disp, "", self.crs.disp, self.nam)
+            self.fpdf.drawText(text)
+            self.fpdf.drawText()
+            text = "Date Ordered: %s%40sDate Received: %s" % \
+                (self.dto.disp, "", self.dte.disp)
+            self.fpdf.drawText(text)
+            self.fpdf.drawText()
+            self.fpdf.drawText("%-3s %-20s %-30s %-10s %11s %10s" % \
+                ("Grp", "Product-Code", "Description", "U.O.I", "U-Price",
+                "Qty-Ord"))
+            self.pglin = 10
+        else:
+            self.fpdf.drawText("%-9s %-7s %-30s %10s %10s %13s %13s %13s" % \
+                ("Order-Num", "Acc-Num", "Name", "Date-Order", "Date-Recvd",
+                    "Gross-Value ", "Discount ", "Net-Value "))
+            self.pglin = 6
         self.fpdf.underLine(txt=self.head)
         self.fpdf.setFont()
-        self.pglin += 7
 
     def printBody(self):
         for dat in self.pot:
@@ -226,8 +289,8 @@
             prc = CCD(dat[5], "UD", 11.2)
             if self.pglin > self.fpdf.lpp:
                 self.printHeader()
-            self.fpdf.drawText("%s %s %s %s %s %s %s" % (grp.disp, cod.disp,
-                self.loc.disp, des.disp, uoi.disp, prc.disp, qty.disp))
+            self.fpdf.drawText("%s %s %s %s %s %s" % (grp.disp, cod.disp,
+                des.disp, uoi.disp, prc.disp, qty.disp))
             self.pglin += 1
 
     def doExit(self):

=== modified file 'str/st6010.py'
--- str/st6010.py	2015-05-20 16:03:01 +0000
+++ str/st6010.py	2015-10-26 06:22:58 +0000
@@ -76,7 +76,7 @@
             (["T",0,1,31],"ONA",30,""),
             (["T",0,2,0],("IRB",r1s),0,"All Codes","All Codes",
                 "N","Y",self.doAllCod,None,None,None),
-            (["T",0,3,0],"INA",20,"Old Code","Old Product Code",
+            (["T",0,3,0],"IRW",20,"Old Code","Old Product Code",
                 "","Y",self.doOldCod,stm,None,("notblank",)),
             (["T",0,3,0],"ONA",30,""),
             (["T",0,4,0],"INA",20,"New Code","New Product Code",

=== modified file 'tab/tb1020.py'
--- tab/tb1020.py	2015-10-25 09:33:02 +0000
+++ tab/tb1020.py	2015-12-03 12:44:55 +0000
@@ -53,9 +53,10 @@
             self.doProcessTables()
             if self.oldver[0] and self.oldver[0] < 5:
                 self.doWagCal()
-            self.doBowls()
+            self.doBwlSkp()
             if self.opts["cln"]:
                 self.doCleanDatabase()
+            self.doBwlPts()
             if self.opts["ver"]:
                 sql = Sql(self.dbm, "verupd", prog=__name__)
                 if not sql.getRec(tables="verupd"):
@@ -190,6 +191,11 @@
                     mxs=len(self.tab))
         elif self.opts["bar"]:
             print txt
+        if "bwltyp" in self.tab:
+            sql = Sql(self.dbm, "bwltyp", prog=__name__)
+            self.bwltyp = sql.getRec(tables="bwltyp")
+        else:
+            self.bwltyp = None
         for num, self.table in enumerate(self.tab):
             if self.opts["bar"] and self.opts["mf"] and self.opts["mf"].window:
                 self.p1.displayProgress(num)
@@ -453,6 +459,8 @@
                         new = 10
                     elif self.table == "bwltyp" and csf[2] == "bct_strict":
                         new = "N"
+                    elif self.table == "bwltyp" and csf[2] == "bct_pdiff":
+                        new = "N"
                     elif self.table == "bwltyp" and csf[2] == "bct_p_only":
                         new = "N"
                     elif self.table == "crsctl" and csf[2] == "ctc_glinp":
@@ -465,6 +473,8 @@
                     elif self.table == "crsmst" and csf[2] in ("crm_mgr_email",
                             "crm_acc_email", "crm_ord_email"):
                         new = old[olddic["crm_email"][0]]
+                    elif self.table == "crsrmf" and csf[2] == "rmf_dbase":
+                        new = "F"
                     elif self.table == "crstrn" and csf[2] == "crt_capnm":
                         new = "Unknown"
                     elif self.table == "ctlsys" and csf[2] == "sys_msvr":
@@ -651,7 +661,7 @@
         if self.opts["mf"] and self.opts["mf"].window:
             spl.closeSplash()
 
-    def doBowls(self):
+    def doBwlSkp(self):
         if not self.dbm.checkTable("bwlskp"):
             return
         sql = Sql(self.dbm, ["bwlctl", "bwltab", "bwldrt", "bwlskp"],
@@ -674,6 +684,19 @@
                 sql.insRec("bwltab", data=data)
         self.dbm.commitDbase()
 
+    def doBwlPts(self):
+        if not self.bwltyp or len(self.bwltyp[0]) == 15:
+            return
+        sql = Sql(self.dbm, "bwlpts", prog=__name__)
+        for rec in self.bwltyp:
+            data = rec[:2]
+            data.append("D")
+            data.extend(rec[14:23])
+            sql.insRec("bwlpts", data=data)
+            data[2] = "S"
+            sql.insRec("bwlpts", data=data)
+        self.dbm.commitDbase()
+
     def doCleanDatabase(self):
         txt = "Cleaning Database ... Please Wait"
         if self.opts["mf"] and self.opts["mf"].window:

=== modified file 'uty/pkgprg.py'
--- uty/pkgprg.py	2015-10-25 09:33:02 +0000
+++ uty/pkgprg.py	2015-11-27 06:43:42 +0000
@@ -135,7 +135,7 @@
                "st3070", "st3080", "st3090", "st3100", "st3110", "st3120",
                "st4010", "st5010", "st5020", "st5030", "st5040", "st6010",
                "st6020", "stc220", "stc320", "stc410", "stc420", "tb1010",
-               "tb1030", "tb1040", "tb3010", "tdc110", "pm1010", "pw1010"]
+               "tb1030", "tb1040", "tb3010", "pm1010", "pw1010"]
 elif system == "c":
     system = "cshana"
     sysmod = "cshsys"
@@ -443,6 +443,7 @@
             "doc/AR.rst",
             "doc/CR_rne.rst",
             "doc/DR.rst",
+            "doc/LN.rst",
             "doc/RT.rst",
             "doc/SI.rst",
             "doc/ST.rst"])
@@ -581,9 +582,11 @@
             "admin@blueberry.co.za",
             "brt@volmoed.co.za",
             "chris@resinsolutions.co.za",
+            "galloway@awe.co.za",
             "johnv@wpcc.co.za",
             "keith@barrowdale.co.za",
             "lawrence@hawcweb.co.za",
+            "lorraine@agfin.co.za",
             "marindag@buildinn-el.co.za",
             "marlene@acsonline.co.za",
             "mel@acsaccounting.co.za",
@@ -591,7 +594,10 @@
             "no2pigstash@hotmail.com",
             "paul@tartan.co.za",
             "rene@hazeldean.co.za",
-            "tyron@i-volt.net"]
+            "rene@agfin.co.za",
+            "ruthmiles52@gmail.com",
+            "tyron@i-volt.net",
+            "yolande@acsaccounting.co.za"]
             #"avanhasselt@jadeworld.com"
             #"deonk@spargs.co.za",
             #"knorton@xsinet.co.za"

=== modified file 'wag/sl1010.py'
--- wag/sl1010.py	2015-10-03 07:36:56 +0000
+++ wag/sl1010.py	2015-11-23 15:22:28 +0000
@@ -100,8 +100,7 @@
         self.loan = w
         self.rec = self.sql.getRec(tables="waglmf", where=[("wlm_cono",
             "=", self.opts["conum"]), ("wlm_empno", "=", self.empno),
-            ("wlm_loan", "=", self.loan), ("wgm_cono=wlm_cono",),
-            ("wgm_empno=wlm_empno",)], limit=1)
+            ("wlm_loan", "=", self.loan)], limit=1)
         if not self.rec:
             return "Invalid Loan Number"
         wlc = self.sql.waglmf_col

=== modified file 'wag/sl3040.py'
--- wag/sl3040.py	2015-10-03 07:36:56 +0000
+++ wag/sl3040.py	2015-11-25 10:40:23 +0000
@@ -229,7 +229,7 @@
             self.opts["conum"], ext="pdf")
         self.fpdf.output(pdfnam, "F")
         doPrinter(mf=self.opts["mf"], conum=self.opts["conum"], pdfnam=pdfnam,
-            head="%s LOAN STATEMENT at %s" % (self.opts["conam"], self.dated),
+            head="%s Loan Statement at %s" % (self.opts["conam"], self.dated),
             repprt=self.df.repprt, repeml=self.df.repeml)
 
     def doExit(self):

